<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>项目篇-Vue3+TS实现后台管理系统 | Melon_Nie的月光橘海</title><meta name="author" content="Melon_Nie"><meta name="copyright" content="Melon_Nie"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Vue3+TS实现小聂后台管理系统">
<meta property="og:type" content="article">
<meta property="og:title" content="项目篇-Vue3+TS实现后台管理系统">
<meta property="og:url" content="http://example.com/2025/04/15/23-nievuets/index.html">
<meta property="og:site_name" content="Melon_Nie的月光橘海">
<meta property="og:description" content="Vue3+TS实现小聂后台管理系统">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/myimg/qingmei.png">
<meta property="article:published_time" content="2025-04-15T05:09:52.000Z">
<meta property="article:modified_time" content="2025-06-09T05:33:15.605Z">
<meta property="article:author" content="Melon_Nie">
<meta property="article:tag" content="vue">
<meta property="article:tag" content="项目">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/myimg/qingmei.png"><link rel="shortcut icon" href="/./myimg/cake.png"><link rel="canonical" href="http://example.com/2025/04/15/23-nievuets/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '项目篇-Vue3+TS实现后台管理系统',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/./myimg/avatar1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">55</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(./myimg/qingmei.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Melon_Nie的月光橘海</span></a><a class="nav-page-title" href="/"><span class="site-name">项目篇-Vue3+TS实现后台管理系统</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">项目篇-Vue3+TS实现后台管理系统</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-15T05:09:52.000Z" title="发表于 2025-04-15 13:09:52">2025-04-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-09T05:33:15.605Z" title="更新于 2025-06-09 13:33:15">2025-06-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/vue/">vue</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h1><h2 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h2><ul>
<li>Vue3 + TypeScript</li>
<li>Vite 构建工具</li>
<li>Element Plus UI框架</li>
<li>Pinia 状态管理</li>
<li>Vue Router 路由管理</li>
<li>Axios 网络请求</li>
</ul>
<h2 id="运行展示"><a href="#运行展示" class="headerlink" title="运行展示"></a>运行展示</h2><p><img src="/postImgs/nievtcms/zs.png" alt="登录组件"><br><img src="/postImgs/nievtcms/zs0.png" alt="登录组件"><br><img src="/postImgs/nievtcms/zs1.png" alt="登录组件"><br><img src="/postImgs/nievtcms/zs2.png" alt="登录组件"><br><img src="/postImgs/nievtcms/zs3.png" alt="登录组件"></p>
<h2 id="项目梳理"><a href="#项目梳理" class="headerlink" title="项目梳理"></a>项目梳理</h2><p><a target="_blank" rel="noopener" href="https://nie7-melon.github.io/2025/06/04/23-myselfUp/">项目梳理请见文章</a></p>
<h1 id="搭建和基础配置"><a href="#搭建和基础配置" class="headerlink" title="搭建和基础配置"></a>搭建和基础配置</h1><h2 id="项目搭建"><a href="#项目搭建" class="headerlink" title="项目搭建"></a>项目搭建</h2><p>使用vue3+pnpm搭建项目<br><img src="/postImgs/nievtcms/create1.png" alt="创建项目"><br>令人愉悦的绿色画面<br><img src="/postImgs/nievtcms/create2.png" alt="创建项目"></p>
<h2 id="原始目录"><a href="#原始目录" class="headerlink" title="原始目录"></a>原始目录</h2><p>.vscode\extensions.json：推荐安装的插件<br>package.json\安装的依赖和一些命令</p>
<h3 id="别名配置"><a href="#别名配置" class="headerlink" title="@别名配置"></a><code>@</code>别名配置</h3><p><strong>两个文件夹里的别名配置@作用不一样</strong><br>vite.config.ts：导出配置；别名配置（@指向src）打包的时候用<br>tsconig.json：自己添加放在带<code>app</code>的文件里，最终都会合并到tsconfig.json里<br>ts配置；别名配置（@指向src）供vscode读取写代码时候有提示</p>
<h3 id="让App被识别成组件-可选"><a href="#让App被识别成组件-可选" class="headerlink" title="让App被识别成组件(可选)"></a>让App被识别成组件(可选)</h3><p>main.ts中<code>import App from &#39;./App.vue&#39;</code><br>现在这里的App没有被识别成组件，在env.d.ts中加入代码</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&#x27;*.vue&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">import</span> &#123; <span class="title class_">DefineComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">component</span>: <span class="title class_">DefineComponent</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> component</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="目录调整"><a href="#目录调整" class="headerlink" title="目录调整"></a>目录调整</h3><p>把没用的删了建立新的文件夹</p>
<h2 id="代码规范配置"><a href="#代码规范配置" class="headerlink" title="代码规范配置"></a>代码规范配置</h2><h3 id="集成editorconfig配置"><a href="#集成editorconfig配置" class="headerlink" title="集成editorconfig配置"></a>集成editorconfig配置</h3><p><code>.editorconfig</code>文件配置：<br>用于解决不同IDE编译器开发同一项目时，维护一致的编码风格（避免乱码）<br>很多开源项目都有这个东西，下面的代码以后其他项目也能用<br>在我搭建项目时，这个文件自动给我配置了一些规则，原来的不全，我注释掉了<br>VSCode要安装一个插件：EditorConfig for VS Code（小老鼠头）</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://editorconfig.org</span></span><br><span class="line"></span><br><span class="line"><span class="string">root</span> <span class="string">=</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[<span class="string">*</span>] <span class="comment"># 表示所有文件适用</span></span><br><span class="line"><span class="string">charset</span> <span class="string">=</span> <span class="string">utf-8</span> <span class="comment"># 设置文件字符集为 utf-8</span></span><br><span class="line"><span class="string">indent_style</span> <span class="string">=</span> <span class="string">space</span> <span class="comment"># 缩进风格（tab | space）</span></span><br><span class="line"><span class="string">indent_size</span> <span class="string">=</span> <span class="number">2</span> <span class="comment"># 缩进大小</span></span><br><span class="line"><span class="string">end_of_line</span> <span class="string">=</span> <span class="string">lf</span> <span class="comment"># 控制换行类型(lf | cr | crlf)</span></span><br><span class="line"><span class="string">trim_trailing_whitespace</span> <span class="string">=</span> <span class="literal">true</span> <span class="comment"># 去除行尾的任意空白字符</span></span><br><span class="line"><span class="string">insert_final_newline</span> <span class="string">=</span> <span class="literal">true</span> <span class="comment"># 始终在文件末尾插入一个新行</span></span><br><span class="line"></span><br><span class="line">[<span class="string">*.md</span>] <span class="comment"># 表示仅 md 文件适用以下规则</span></span><br><span class="line"><span class="string">max_line_length</span> <span class="string">=</span> <span class="string">off</span></span><br><span class="line"><span class="string">trim_trailing_whitespace</span></span><br></pre></td></tr></table></figure>
<h3 id="prettier工具"><a href="#prettier工具" class="headerlink" title="prettier工具"></a>prettier工具</h3><p>Prettier 是一款强大的代码格式化工具，基本上前端能用到的文件格式它都可以搞定，是当下最流行的代码格式化工具</p>
<ol>
<li>安装prettier</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install prettier -D</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>配置.prettierrc文件：<br>在创建项目时我选择了这个，原来的不全，在文件夹里修改代码即可</li>
</ol>
<ul>
<li>useTabs：使用tab缩进还是空格缩进，选择false；</li>
<li>tabWidth：tab是空格的情况下，是几个空格，选择2个；</li>
<li>printWidth：当行字符的长度，推荐80，也有人喜欢100或者120；</li>
<li>singleQuote：使用单引号还是双引号，选择true，使用单引号；</li>
<li>trailingComma：在多行输入的尾逗号是否添加，设置为 <code>none</code>，比如对象类型的最后一个属性后面是否加一个，；</li>
<li>semi：语句末尾是否要加分号，默认值true，选择false表示不加；</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;useTabs&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tabWidth&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;printWidth&quot;</span><span class="punctuation">:</span> <span class="number">80</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;singleQuote&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;trailingComma&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;semi&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>创建.prettierignore忽略文件<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/dist/*</span><br><span class="line">.local</span><br><span class="line">.output.js</span><br><span class="line">/node_modules/**</span><br><span class="line"></span><br><span class="line">**/*.svg</span><br><span class="line">**/*.sh</span><br><span class="line"></span><br><span class="line">/public/*</span><br></pre></td></tr></table></figure></li>
<li>VSCode要安装prettier的插件，让ctrl+s即可生效</li>
<li>VSCode中修改配置</li>
</ol>
<ul>
<li>settings &#x3D;&gt;format on save &#x3D;&gt; 勾选上</li>
<li>settings &#x3D;&gt; editor default format &#x3D;&gt; 选择 prettier</li>
</ul>
<ol start="6">
<li>测试prettier是否生效</li>
</ol>
<ul>
<li>测试一：在代码中保存代码；</li>
<li>测试二：配置一次性修改的命令(如果没生效再做)<br>在package.json中配置一个scripts：<br>(我的文件中已经有<code>&quot;format&quot;: &quot;prettier --write src/&quot;</code>)<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;prettier&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prettier --write .&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="使用ESLint检测-我之前做过，这里没有按照配置说明配置"><a href="#使用ESLint检测-我之前做过，这里没有按照配置说明配置" class="headerlink" title="使用ESLint检测(我之前做过，这里没有按照配置说明配置)"></a>使用ESLint检测(我之前做过，这里没有按照配置说明配置)</h3><p>VSCode需要安装ESLint插件：<br>解决eslint和prettier冲突的问题：</p>
<ol>
<li>安装插件：<br>（vue在创建项目时，如果选择prettier，那么这两个插件会自动安装）</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install eslint-plugin-prettier eslint-config-prettier -D</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>添加prettier插件：<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">extends<span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="string">&quot;plugin:vue/vue3-essential&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;eslint:recommended&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;@vue/typescript/recommended&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;@vue/prettier&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;@vue/prettier/@typescript-eslint&quot;</span><span class="punctuation">,</span></span><br><span class="line">  &#x27;plugin<span class="punctuation">:</span>prettier/recommended&#x27;</span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure></li>
<li>VSCode中eslint的配置</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;eslint.lintTask.enable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;eslint.alwaysShowStatus&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;eslint.validate&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="string">&quot;javascript&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;javascriptreact&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;typescript&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;typescriptreact&quot;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;editor.codeActionsOnSave&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;source.fixAll.eslint&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<h2 id="css样式重置"><a href="#css样式重置" class="headerlink" title="css样式重置"></a>css样式重置</h2><p>assets文件夹下建css文件夹，放一些样式重置规则reset.less<br>（我复制的以前写过的规则）<br><code>pnpm install normalize.css</code><br><code>npm install less -D</code></p>
<h2 id="路由配置"><a href="#路由配置" class="headerlink" title="路由配置"></a>路由配置</h2><h3 id="创建路由实例"><a href="#创建路由实例" class="headerlink" title="创建路由实例"></a>创建路由实例</h3><p>先<code>pnpm add vue-router@4</code><br>router&#x2F;index.ts文件创建路由实例</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHashHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHashHistory</span>(),</span><br><span class="line">  <span class="attr">routes</span>: []</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>路由：管理单页应用（SPA）中不同URL路径与组件的映射关系</li>
<li>路由实例：通过createRouter创建，是Vue Router的核心对象，管理路由的配置和跳转</li>
<li>使用哈希模式通过URL的#符号来管理路由路径</li>
<li>哈希模式无需服务器配置，更适合开发环境或部署在静态服务器上</li>
<li><strong>别忘记最后将创建的路由实例导出并在main.ts中引入并挂载到Vue实例上</strong></li>
</ul>
<h3 id="创建组件"><a href="#创建组件" class="headerlink" title="创建组件"></a>创建组件</h3><p>路由最重要的映射关系path&#x3D;&gt;component,现在还没组件<br>在views（视图）文件夹下创建对应的组件</p>
<h4 id="解决组件单个单词命名警告问题"><a href="#解决组件单个单词命名警告问题" class="headerlink" title="解决组件单个单词命名警告问题"></a>解决组件单个单词命名警告问题</h4><p>默认的配置里面不让使用单个单词命名（login.vue），给我报了警告<br><img src="/postImgs/nievtcms/create3.png" alt="警告"><br>z这个里是eslint的配置，在tsconfig.json中添加</p>
<ol>
<li>只在某个文件中不适用该规则<br>在script部分顶部添加注解关闭规则<br>  <code>eslint-disable-next-line vue/multi-word-component-names</code><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">eslint-disable-next-line vue/multi-word-component-names</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">name</span>: <span class="string">&#x27;Button&#x27;</span> <span class="comment">// 单个单词命名</span></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>全局禁用该规则（我用的这个）<br>在eslint.config.js中最后添加：<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;vue/multi-word-component-names&#x27;</span>: <span class="string">&#x27;off&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="生成代码片段（借用网站）"><a href="#生成代码片段（借用网站）" class="headerlink" title="生成代码片段（借用网站）"></a>生成代码片段（借用网站）</h4><p>由于这些路由组件的代码类型高度重合，使用代码片段更方便开发，用这个网站生成代码片段：<code>https://snippet-generator.app</code></p>
<blockquote>
<p>Snippet Generator 是一个在线代码片段生成器，主要用于快速生成适用于 VS Code（或其他编辑器）的代码片段配置文件。它通过图形化界面简化了代码片段的创建过程，避免手动编写复杂的 JSON 配置。<br>可视化界面：无需手动编写 JSON，直接输入代码和触发前缀即可生成代码片段。<br>占位符自动处理：支持通过 $1、$2 等占位符定义光标跳转位置，提升代码填充效率</p>
</blockquote>
<p>我想我的每个组件都是这样的类似代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;login&quot;&gt;</span><br><span class="line">    &lt;h2&gt;login&lt;/h2&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">.login &#123;</span><br><span class="line">  color: orange;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>我用这个网站这样做，把右边的copy<br><img src="/postImgs/nievtcms/create4.png" alt="生成代码片段"><br>在vscode中配置<br><img src="/postImgs/nievtcms/create5.png" alt="vscode配置代码片段"><br><strong>点进去，跟着编译器指示，我选择的新建当前项目文件文件夹的代码片段文件</strong><br>新建一个文件名（我vue3ts），回车，出现一个空的<code>&#123;&#125;</code>和一堆注解，把注解换成网站上复制的代码，保存<br><img src="/postImgs/nievtcms/create5.png" alt="vscode配置代码片段"><br>试一下，新建.vue文件，输入tsvue回车,成功啦<br>创建login、main组件（<code>Login.vue</code>、<code>Main.vue</code>）</p>
<h3 id="配置路由"><a href="#配置路由" class="headerlink" title="配置路由"></a>配置路由</h3><p>回到router&#x2F;index.ts文件，配置路由</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHashHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHashHistory</span>(),</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">      <span class="attr">redirect</span>: <span class="string">&#x27;/main&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/main&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;main&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/main/Main.vue&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/login/Login.vue&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>
<h3 id="测试路由"><a href="#测试路由" class="headerlink" title="测试路由"></a>测试路由</h3><p>回到&#96;App.vue&#96;&#96;，在template中添加一个router-view标签，用来显示路由组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;Hello小聂同学&lt;/div&gt;</span><br><span class="line">  &lt;router-link to=&quot;/main&quot;&gt;去main页面&lt;/router-link&gt;</span><br><span class="line">  &lt;hr /&gt;</span><br><span class="line">  &lt;router-link to=&quot;/login&quot;&gt;去login页面&lt;/router-link&gt;</span><br><span class="line">  &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<p>运行，成功啦<br><img src="/postImgs/nievtcms/create7.png" alt="路由测试成功"></p>
<h3 id="完善–notfound页面"><a href="#完善–notfound页面" class="headerlink" title="完善–notfound页面"></a>完善–notfound页面</h3><p>如果用户输入一个不存在的路由，显示一个404页面<br>创建文件<code>view/not-found/NotFound.vue</code><br>配置路由<br><code>path: &#39;/:pathMatch(.*)&#39;</code>匹配所有未被其他路由规则捕获的路径<br><code>:pathMatch</code>：这是一个动态路由参数的名称（自定义的）<br><code>(.*)</code>：正则表达式，表示匹配任意字符（包括空字符串），捕获所有路径</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/:pathMatch(.*)&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;notFound&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/not-found/NotFound.vue&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>成功<img src="/postImgs/nievtcms/create8.png" alt="notfound页面"></p>
<h2 id="状态管理pinia"><a href="#状态管理pinia" class="headerlink" title="状态管理pinia"></a>状态管理pinia</h2><p>首先<code>pnpm install pinia</code><br>在main.ts中引入pinia并挂载到Vue实例上</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pinia <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line">app.<span class="title function_">use</span>(pinia)</span><br></pre></td></tr></table></figure>
<h3 id="写个例子测试"><a href="#写个例子测试" class="headerlink" title="写个例子测试"></a>写个例子测试</h3><p>store&#x2F;index.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> pinia</span><br></pre></td></tr></table></figure>
<p>数据放在仓库里，创建一个<code>counter.ts</code>文件测试</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;counter&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">counter</span>: <span class="number">100</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">getters</span>: &#123;</span><br><span class="line">    <span class="title function_">doubleCounter</span>(<span class="params">state</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.<span class="property">counter</span> * <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="title function_">changeCounterAction</span>(<span class="params"><span class="attr">newCounter</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">counter</span> = newCounter</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useCounterStore</span><br></pre></td></tr></table></figure>
<p>在<code>Main.vue</code>中引入pinia，并使用store</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;main&quot;&gt;</span><br><span class="line">    &lt;h2&gt;main: &#123;&#123; counterStore.counter &#125;&#125;-&#123;&#123; counterStore.doubleCounter &#125;&#125;&lt;/h2&gt;</span><br><span class="line">    &lt;button @click=&quot;changeCounter&quot;&gt;修改counter&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import useCounterStore from &#x27;@/store/counter&#x27;</span><br><span class="line"></span><br><span class="line">const counterStore = useCounterStore()</span><br><span class="line"></span><br><span class="line">function changeCounter() &#123;</span><br><span class="line">  counterStore.changeCounterAction(999)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>跑一跑，成功<img src="/postImgs/nievtcms/create9.png" alt="pinia应用"></p>
<h2 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h2><p>pnpm install axios<br>创建service文件夹，这里用的老师封装好的代码文件，cv进来直接使用的</p>
<h3 id="测试网络请求"><a href="#测试网络请求" class="headerlink" title="测试网络请求"></a>测试网络请求</h3><p>在login.vue中测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import hyRequest from &#x27;@/service&#x27;</span><br><span class="line"></span><br><span class="line">hyRequest</span><br><span class="line">  .get(&#123;</span><br><span class="line">    url: &#x27;/category/1&#x27;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then((res) =&gt; &#123;</span><br><span class="line">    console.log(res)</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;less&quot; scoped&gt;</span><br><span class="line">.login &#123;</span><br><span class="line">  color: orange;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="开发模式和生产模式"><a href="#开发模式和生产模式" class="headerlink" title="开发模式和生产模式"></a>开发模式和生产模式</h2><p>service&#x2F;config&#x2F;index.ts</p>
<ol>
<li>手动区分开发环境和牛产环境<br>用哪个留哪个，不用的注释掉<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">BASE_URL</span> =<span class="string">&#x27;http://coderwhy.dev:8008&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">BASE_URL</span> =<span class="string">&#x27;http://codercba.prod:806&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>代码逻辑判断当前环境<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//下面三行返回布尔值</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">DEV</span>)<span class="comment">//是否是开发环境</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">PROD</span>)<span class="comment">//是否生产环境</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">SSR</span>)<span class="comment">//是否是服务器端渲染</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable constant_">BASE</span> <span class="variable constant_">URL</span> =<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">PRoD</span>)&#123;</span><br><span class="line">  <span class="variable constant_">BASE</span> <span class="variable constant_">URL</span> =<span class="string">&#x27;http://codercba.prod:8000&#x27;</span></span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable constant_">BASE</span> <span class="variable constant_">URL</span> = <span class="string">&#x27;http://coderwhy.dev:8000&#x27;</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
代码笔记：<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.区分开发环境和生产环境</span></span><br><span class="line"><span class="comment">// export const BASE_URL = &#x27;http://coderwhy.dev:8000&#x27;</span></span><br><span class="line"><span class="comment">// export const BASE_URL = &#x27;http://codercba.prod:8000&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.代码逻辑判断, 判断当前环境</span></span><br><span class="line"><span class="comment">// vite默认提供的环境变量</span></span><br><span class="line"><span class="comment">// console.log(import.meta.env.MODE)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">DEV</span>) <span class="comment">// 是否开发环境</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">PROD</span>) <span class="comment">// 是否生产环境</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">SSR</span>) <span class="comment">// 是否是服务器端渲染(server side render)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable constant_">BASE_URL</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">PROD</span>) &#123;</span><br><span class="line">  <span class="comment">//BASE_URL = &#x27;http://localhost:8880&#x27;</span></span><br><span class="line">  <span class="variable constant_">BASE_URL</span> = <span class="string">&#x27;http://123.207.32.32:5000&#x27;</span></span><br><span class="line">  <span class="comment">//  BASE_URL = &#x27;http://codercba.prod:8000&#x27;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// BASE_URL = &#x27;http://localhost:8880&#x27;</span></span><br><span class="line">  <span class="variable constant_">BASE_URL</span> = <span class="string">&#x27;http://123.207.32.32:5000&#x27;</span></span><br><span class="line">  <span class="comment">//  BASE_URL = &#x27;http://coderwhy.dev:8000&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">BASE_URL</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.通过创建.env文件直接创建变量</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_URL</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">TIME_OUT</span> = <span class="number">10000</span></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="variable constant_">BASE_URL</span> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Element-Plus集成"><a href="#Element-Plus集成" class="headerlink" title="Element-Plus集成"></a>Element-Plus集成</h2><p>使用时一句话：用组件，调属性，不合适的再覆盖</p>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p>看官方文档，我使用按需导入-自动导入的方法<br><code>pnpm add -D unplugin-vue-components unplugin-auto-import</code><br>然后根据官方文档配置vite.config.ts文件<br><code>pnpm add element-plus</code><br>文件夹会多出两个文件：<code>auto-imports.d.ts和components.d.ts</code>，用来帮我们声明<br>用什么组件直接把<code>&lt;template&gt;&lt;/template&gt;</code>部分中的代码CV进来，ts部分会自动导入，不用CV<br>试试看，成功引用<img src="/postImgs/nievtcms/create10.png" alt="Element-Plus集成"></p>
<h3 id="在tsconfig-js文件中添加配置"><a href="#在tsconfig-js文件中添加配置" class="headerlink" title="在tsconfig,js文件中添加配置"></a>在tsconfig,js文件中添加配置</h3><p>我的项目中<code>tsconfig.app.json</code>文件夹中本来是<br><code>  &quot;include&quot;: [&quot;env.d.ts&quot;, &quot;src/**/*&quot;, &quot;src/**/*.vue&quot;],</code><br>把前面按需导入-自动导入配置生成的两个文件也放进去<br>变成</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;env.d.ts&quot;</span><span class="punctuation">,</span> <span class="string">&quot;src/**/*&quot;</span><span class="punctuation">,</span> <span class="string">&quot;src/**/*.vue&quot;</span><span class="punctuation">,</span> <span class="string">&quot;auto-imports.d.ts&quot;</span><span class="punctuation">,</span> <span class="string">&quot;components.d.ts&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><mark>为什么要这样做呢：</mark></p>
<ol>
<li><p>类型声明生效的必要条件<br>TypeScript编译器只会处理被include包含的文件（以及被files指定的文件）<br>auto-imports.d.ts和components.d.ts包含了全局类型声明<br>如果不包含它们，TS编译器会忽略这些声明，导致类型检查失效</p>
</li>
<li><p>自动生成的声明文件特性<br>这两个文件由unplugin-auto-import和unplugin-vue-components插件动态生成<br>默认位于项目根目录（或指定目录）的非源码位置<br>需要显式告知TS编译器这些声明文件的位置</p>
</li>
<li><p>回顾vite项目的配置结构<br>tsconfig.json：基础配置<br>tsconfig.app.json（通过extends继承）：应用代码的专属配置<br>tsconfig.node.json：Vite配置等Node端代码的配置</p>
</li>
</ol>
<h2 id="调整窗口大小"><a href="#调整窗口大小" class="headerlink" title="调整窗口大小"></a>调整窗口大小</h2><p>让App.vue中的大盒子填满整个屏幕<br><strong>不用关心父元素是否填满了屏幕，用下面两行代码</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.app</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100vw</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之前用来测试是否配置成功的无用代码清掉了，开始正式布局</p>
<h1 id="登录页"><a href="#登录页" class="headerlink" title="登录页"></a>登录页</h1><p>登录页login&#x2F;login.vue</p>
<h2 id="登录页布局"><a href="#登录页布局" class="headerlink" title="登录页布局"></a>登录页布局</h2><h3 id="登录框组件导入"><a href="#登录框组件导入" class="headerlink" title="登录框组件导入"></a>登录框组件导入</h3><p>组件思想：把登录框设置成一个组件<br>在login&#x2F;children-cpns（子组件）文件夹&#x2F;创建login-panel.vue(登录面板)<br>在login.vue中引入login-panel.vue，并使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;login&quot;&gt;</span><br><span class="line">    &lt;h2&gt;login&lt;/h2&gt;</span><br><span class="line">    &lt;login-panel&gt;&lt;/login-panel&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import LoginPanel from &#x27;./children-cpns/login-panel.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="登录框组件布局："><a href="#登录框组件布局：" class="headerlink" title="登录框组件布局："></a>登录框组件布局：</h3><ol>
<li>思路：<br>先把里面的元素都摆出来，然后再布局美化，从element-plus组件库找对应的组件进来替换掉原来的元素，再继续调整布局</li>
<li>居中调整<br>样式调整：flex布局，组件要居中，login.vue独占页面，里面内容要居中，在login.vue<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.login</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgb</span>(<span class="number">174</span>, <span class="number">119</span>, <span class="number">208</span>);</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">&#x27;../../assets/img/login-bg.svg&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>调整调整再调整<br>调整的细节不写笔记了，代码里有注释，一点一点慢慢搭建<br>登录组件一点点完善如图：<br><img src="/postImgs/nievtcms/login2.png" alt="登录组件"><br>在绑定v-model时，多去控制台看看数据有没有绑定成功，如图<br><img src="/postImgs/nievtcms/login3.png" alt="v-model绑定检查"></li>
</ol>
<h2 id="登录框组件逻辑"><a href="#登录框组件逻辑" class="headerlink" title="登录框组件逻辑"></a>登录框组件逻辑</h2><h3 id="绑定属性"><a href="#绑定属性" class="headerlink" title="绑定属性"></a>绑定属性</h3><p>目前只是做好了样式，没有给组件绑定属性<br>完善组件的属性和对应变量的声明，比如帐号密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- tab下帐号登录的表单部分 --&gt;</span><br><span class="line">  &lt;div class=&quot;pane-account&quot;&gt;</span><br><span class="line">    &lt;!--label-width调整宽度 --&gt;</span><br><span class="line">    &lt;!-- :model=&quot;account&quot;绑定表单，获取整个对象 --&gt;</span><br><span class="line">    &lt;el-form :model=&quot;account&quot; label-width=&quot;60px&quot; size=&quot;large&quot; status-icon ref=&quot;formRef&quot;&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;帐号&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;account.name&quot; /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;密码&quot; prop=&quot;password&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;account.password&quot; /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; reactive, ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const account = reactive(&#123;</span><br><span class="line">  name: &#x27;&#x27;,</span><br><span class="line">  password: &#x27;&#x27;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="登录表单校验"><a href="#登录表单校验" class="headerlink" title="登录表单校验"></a>登录表单校验</h3><p>   这部分在element组件库有，在form表单组件右侧导航栏中有，仔细阅读人家的代码<br>   校验规则一般写在el-form里面，给他添加属性和属性值，在ts中定义具体规则<br>   校验规则到底该怎么写，模仿人家代码的格式，官方文档组件下面有很长规则代码<br><makr>下面是我的账号密码表单组件和对应的校验规则，不难，要专心注意细节，官方文档一点一点读着写</mark></p>
<p><img src="/postImgs/nievtcms/login4.png" alt="登录表单校验"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- tab下帐号登录的表单部分 --&gt;</span><br><span class="line">  &lt;div class=&quot;pane-account&quot;&gt;</span><br><span class="line">    &lt;!--label-width调整宽度 --&gt;</span><br><span class="line">    &lt;!-- :model=&quot;account&quot;绑定表单，获取整个对象 --&gt;</span><br><span class="line">    &lt;el-form</span><br><span class="line">      :model=&quot;account&quot;</span><br><span class="line">      :rules=&quot;accountRules&quot;</span><br><span class="line">      label-width=&quot;60px&quot;</span><br><span class="line">      size=&quot;large&quot;</span><br><span class="line">      status-icon</span><br><span class="line">      ref=&quot;formRef&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!--prop=&quot;name&quot;目的：进行标识，方便校验规则找到对谁起作用  --&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;帐号&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;account.name&quot; /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;密码&quot; prop=&quot;password&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;account.password&quot; /&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot; name=&quot;account&quot;&gt;</span><br><span class="line">import &#123; reactive, ref &#125; from &#x27;vue&#x27;</span><br><span class="line">//FormRules校验规则，需要导入</span><br><span class="line">import type &#123; FormRules, FormInstance, ElMessage &#125; from &#x27;element-plus&#x27;</span><br><span class="line"></span><br><span class="line">// 定义accout数据</span><br><span class="line">const account = reactive(&#123;</span><br><span class="line">  name: &#x27;&#x27;,</span><br><span class="line">  password: &#x27;&#x27;</span><br><span class="line">&#125;)</span><br><span class="line">//定义校验规则，看官方文档，模仿人家的写法</span><br><span class="line">//数组类型：多个校验规则，一个表单可以放多个</span><br><span class="line">//required: true必须填，如果不填，那么trigger: &#x27;blur&#x27;，意思是失去焦点的时候触发</span><br><span class="line">//记得要绑定到表单上，给表单添加属性:rules=&quot;accountRules&quot;</span><br><span class="line">const accountRules: FormRules = &#123;</span><br><span class="line">  name: [</span><br><span class="line">    &#123; required: true, message: &#x27;必须输入帐号信息哦&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123; pattern: /^[a-z0-9]&#123;6,20&#125;$/, message: &#x27;帐号必须是6~20个字母或数字&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">  ],</span><br><span class="line">  password: [</span><br><span class="line">    &#123; required: true, message: &#x27;必须输入密码哦&#x27;, trigger: &#x27;blur&#x27; &#125;,</span><br><span class="line">    &#123; pattern: /^[a-z0-9]&#123;4,12&#125;$/, message: &#x27;密码必须是4~12个字母或数字&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="登录请求与表单校验"><a href="#登录请求与表单校验" class="headerlink" title="登录请求与表单校验"></a>登录请求与表单校验</h2><p>用户填写完帐号密码，点击登录，此时数据在pane-account组件中，而登录按钮在pane-account组件的父组件里<br>方法1：把子组件的数组传递给父组件（这里不用它）<br>方法2：父组件中的登录按钮触发后，传递给子组件，让子组件执行方法<br><strong>所以在子组件中写登录逻辑，注意必须暴露出去，父组件才能触发它</strong></p>
<h3 id="难点代码：-ref"><a href="#难点代码：-ref" class="headerlink" title="难点代码： ref&lt;InstanceType&lt;typeof xxx&gt;&gt;()"></a>难点代码：<code> ref&lt;InstanceType&lt;typeof xxx&gt;&gt;()</code></h3><p><code>const accountRef = ref&lt;InstanceType&lt;typeof PaneAccount&gt;&gt;()</code></p>
<blockquote>
<p>这里一知半解的感觉，没关系，记住用法就可以<br>获取子组件的实例accountRef，注意要把它绑定到子组件上<br>不能直接<code>ref&lt;PanelAccount&gt;</code>,accountRef是由PanelAccount创建的实例对象<br>构造器返回值的实例<br>PaneAccoun相当于一个类</p>
</blockquote>
<h3 id="表单校验"><a href="#表单校验" class="headerlink" title="表单校验"></a>表单校验</h3><p>在登录时，校验表单数据是否验证成功，组件库提供了相关方法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loginAction</span>(<span class="params"><span class="attr">isKeep</span>: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;当前账号数据:&#x27;</span>, account)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 是否通过了验证，这个isValid就是表单校验的结果,组件提供给我们的</span></span><br><span class="line">  formRef.<span class="property">value</span>?.<span class="title function_">validate</span>(<span class="function">(<span class="params">isValid</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;表单校验结果:&#x27;</span>, isValid)</span><br><span class="line">    <span class="keyword">if</span> (isValid) &#123;</span><br><span class="line">      <span class="keyword">const</span> name = account.<span class="property">name</span></span><br><span class="line">      <span class="keyword">const</span> password = account.<span class="property">password</span></span><br><span class="line">      <span class="comment">// 1.登录操作</span></span><br><span class="line">      loginStore.<span class="title function_">accountLoginAction</span>(&#123; name, password &#125;)</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//如果用户点击提交时输入内容不符合规则，弹窗提示用户</span></span><br><span class="line">      <span class="title class_">ElMessage</span>.<span class="title function_">warning</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;账号或密码输入的规则错误哦&#x27;</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="表单校验warning弹窗"><a href="#表单校验warning弹窗" class="headerlink" title="表单校验warning弹窗"></a>表单校验warning弹窗</h4><p>弹窗代码怎么用起来呢<br><code>ElMessage.warning(&#123; message: &#39;账号或密码输入的规则错误哦&#39; &#125;)</code><br>注意它是写在ts里面，不是template里面，要先导入它<br><code>import &#123; ElMessage &#125; from &#39;element-plus&#39;</code><br>此时还是用不了，因为它没有样式，要在main.ts引入样式文件<br>下面两行都能实现warning，但是第二种从哪儿找到有些难<br><code>import &#39;element-plus/dist/index.css&#39;</code>导入所有样式<br><code>import &#39;element-plus/theme-chalk/el-message.css&#39;</code>导入el-message样式</p>
<p><img src="/postImgs/nievtcms/login5.png" alt="登录表单校验"></p>
<h2 id="网络请求与token保存"><a href="#网络请求与token保存" class="headerlink" title="网络请求与token保存"></a>网络请求与token保存</h2><p>网络请求的东西直接写在组件下的ts业务逻辑里不好，一般要单独封装，所以在service文件夹下建login文件夹，里面放登录相关的网络请求</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">accountLoginRequest</span>(<span class="params"><span class="attr">account</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> nieRequest.<span class="title function_">post</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: account</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>组件中调用函数</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//发送登录请求的请求</span></span><br><span class="line"><span class="keyword">import</span> &#123; accountLoginRequest &#125; <span class="keyword">from</span> <span class="string">&#x27;@/service/login/login&#x27;</span></span><br><span class="line">      <span class="keyword">const</span> name = account.<span class="property">name</span></span><br><span class="line">      <span class="keyword">const</span> password = account.<span class="property">password</span></span><br><span class="line">  <span class="title function_">accountLoginRequest</span>(&#123; name, password &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;res:&#x27;</span>, res)</span><br><span class="line">   &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>这部分我卡了六个小时，最后发现是coderwhy拼成了codewhy，可笑的是我在接口软件和终端调试请求时，用户名写的都是coderwhy，回到登录页面，每次一写的都是codewhy，太不应该了阿，也算是深刻的教训了</strong><br><img src="/postImgs/nievtcms/login6.png" alt="不要再拼写错了"></p>
<h3 id="网络请求放仓库，保存登录状态的"><a href="#网络请求放仓库，保存登录状态的" class="headerlink" title="网络请求放仓库，保存登录状态的"></a>网络请求放仓库，保存登录状态的</h3><p>在store&#x2F;login建useLoginStore，把用户登录请求放到这里<br>在账号登录组件pane-account里导入仓库，把要用的方法取出来，在表单校验成功后调用仓库的方法实现登录请求，请求成功<br><img src="/postImgs/nievtcms/login7.png" alt="网络请求放到登录仓库"><br>登录成功，把返回的结果保存到仓库</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> useLoginStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;login&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: (): <span class="function"><span class="params">ILoginState</span> =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">token</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">accountLoginAction</span>(<span class="params"><span class="attr">account</span>: &#123;name:<span class="built_in">string</span>, password:<span class="built_in">string</span>&#125;</span>) &#123;</span><br><span class="line">      <span class="comment">//1.拿到登录信息发送请求</span></span><br><span class="line">      <span class="comment">// 加上await不需要再写.then了</span></span><br><span class="line">      <span class="keyword">const</span> loginRes = <span class="keyword">await</span> <span class="title function_">accountLoginRequest</span>(account)</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;登录请求放在登录仓库，loginRes:&#x27;</span>, loginRes)</span><br><span class="line">      <span class="comment">//2.登录成功，把返回的结果保存到仓库</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">token</span> = loginRes.<span class="property">data</span>.<span class="property">data</span>.<span class="property">token</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">id</span> = loginRes.<span class="property">data</span>.<span class="property">data</span>.<span class="property">id</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">name</span> = loginRes.<span class="property">data</span>.<span class="property">data</span>.<span class="property">name</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;token&#x27;</span>, <span class="variable language_">this</span>.<span class="property">token</span>, <span class="variable language_">this</span>.<span class="property">id</span>, <span class="variable language_">this</span>.<span class="property">name</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>(开始我保存失败，因为我少了一个data.)<br><img src="/postImgs/nievtcms/login8.png" alt="网络请求放到登录仓库"></p>
<h3 id="永久保存用户token"><a href="#永久保存用户token" class="headerlink" title="永久保存用户token"></a>永久保存用户token</h3><p>两种方式都可以，看需求<br><code>localCache.setCache(&#39;token&#39;, this.token)</code><br><code>localCache.setCache(&#39;token&#39;, this.token)</code><br>记得把仓库里的<code>token:&quot;&quot;</code>也修改<br><code>token: localStorage.getItem(&#39;token&#39;) ?? &#39;&#39;,</code><br>成功后如下图，开始刷新之后token为空，现在刷新完也有值<br><img src="/postImgs/nievtcms/login9.png" alt="网络请求放到登录仓库"></p>
<h2 id="完善type文件定义数据类型"><a href="#完善type文件定义数据类型" class="headerlink" title="完善type文件定义数据类型"></a>完善type文件定义数据类型</h2><p>创建type.ts文件，放类型规则，这个文件可以放单独的type文件夹里，也可以发在要使用这些规则的功能文件夹下，放哪儿你写代码你来定 </p>
<h3 id="完善token，防止拼写错误（很多项目都这样做）"><a href="#完善token，防止拼写错误（很多项目都这样做）" class="headerlink" title="完善token，防止拼写错误（很多项目都这样做）"></a>完善token，防止拼写错误（很多项目都这样做）</h3><p><code>export const LOGIN_TOKEN = &#39;login/token&#39;</code><br><code>import &#123; LOGIN_TOKEN &#125; from &#39;@/types/constants&#39;</code><br><code> localCache.setCache(LOGIN_TOKEN, this.token)</code></p>
<h2 id="封装缓存工具类"><a href="#封装缓存工具类" class="headerlink" title="封装缓存工具类"></a>封装缓存工具类</h2><ol>
<li>定义 CacheType 枚举：区分两种缓存类型（local&#x2F;session）</li>
<li>创建 NieCache 类：封装通用的缓存操作方法（set&#x2F;get&#x2F;delete&#x2F;clear）</li>
<li>根据传入的 CacheType 决定使用 localStorage 还是 sessionStorage</li>
<li>提供 setCache &#x2F; getCache &#x2F; deleteCache &#x2F; clearCache 方法</li>
<li>创建两个实例：localCache 和 sessionCache</li>
<li>导出这两个实例，供其他模块使用<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">CacheType</span> &#123;</span><br><span class="line">  local = <span class="string">&#x27;local&#x27;</span>,</span><br><span class="line">  session = <span class="string">&#x27;session&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//localStorage：数据永久保存，除非手动清除。</span></span><br><span class="line"><span class="comment">//sessionStorage：数据只在当前会话有效，关闭浏览器后清除</span></span><br><span class="line"><span class="comment">// NieCache它封装了对浏览器本地存储的操作</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NieCache</span> &#123;</span><br><span class="line">  <span class="attr">storage</span>: <span class="title class_">Storage</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//构造函数 constructor 接收一个参数 type（也就是上面定义的 CacheType）</span></span><br><span class="line">  <span class="comment">//根据这个参数决定使用哪种存储方式</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">type</span>: <span class="title class_">CacheType</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">storage</span> = <span class="keyword">type</span> === <span class="title class_">CacheType</span>.<span class="property">local</span> ? <span class="variable language_">localStorage</span> : <span class="variable language_">sessionStorage</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setCache</span>(<span class="params"><span class="attr">key</span>: <span class="built_in">string</span>, <span class="attr">value</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">storage</span>.<span class="title function_">setItem</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getCache</span>(<span class="params"><span class="attr">key</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> value = <span class="variable language_">this</span>.<span class="property">storage</span>.<span class="title function_">getItem</span>(key)</span><br><span class="line">    <span class="keyword">if</span> (value) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">deleteCache</span>(<span class="params"><span class="attr">key</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">storage</span>.<span class="title function_">removeItem</span>(key)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">clearCache</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">storage</span>.<span class="title function_">clear</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建两个实例并导出</span></span><br><span class="line"><span class="keyword">const</span> localCache = <span class="keyword">new</span> <span class="title class_">NieCache</span>(<span class="title class_">CacheType</span>.<span class="property">local</span>)</span><br><span class="line"><span class="keyword">const</span> sessionCache = <span class="keyword">new</span> <span class="title class_">NieCache</span>(<span class="title class_">CacheType</span>.<span class="property">session</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; localCache, sessionCache &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="页面跳转"><a href="#页面跳转" class="headerlink" title="页面跳转"></a>页面跳转</h2><p>最简单：在store,actions后面添加<code>router.push(&#39;/main&#39;)</code></p>
<h3 id="导航守卫"><a href="#导航守卫" class="headerlink" title="导航守卫"></a>导航守卫</h3><p>router&#x2F;index.ts添加导航守卫</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导航守卫</span></span><br><span class="line"><span class="comment">// 参数: to(跳转到的位置)/from(从哪里跳转过来)</span></span><br><span class="line"><span class="comment">// 返回值: 返回值决定导航的路径(不返回或者返回undefined, 默认跳转)</span></span><br><span class="line"><span class="comment">// 举个栗子: / =&gt; /main</span></span><br><span class="line"><span class="comment">// to: /main from: / 返回值: /abc</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 只有登录成功(token), 才能真正进入到main页面</span></span><br><span class="line">  <span class="keyword">const</span> token = localCache.<span class="title function_">getCache</span>(<span class="variable constant_">LOGIN_TOKEN</span>)</span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">path</span>.<span class="title function_">startsWith</span>(<span class="string">&#x27;/main&#x27;</span>) &amp;&amp; !token) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;/login&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="添加记住密码功能"><a href="#添加记住密码功能" class="headerlink" title="添加记住密码功能"></a>添加记住密码功能</h2><ol>
<li><p>理解：<br>如果用户在登录时勾选“记住密码”，那么应该把用户输入的帐号密码记住，下次用户回到登录页面自动填充账号和密码</p>
<blockquote>
<p>现在浏览器右侧提示的记住账号和密码是浏览器本身的功能，不是网站本身的功能</p>
</blockquote>
</li>
<li><p>思路：<br>在登录组件中通过<code>isRemPwd</code>变量的值确定是否勾选记住密码，把这个值传递给帐号登录子组件的loginAction方法中，子组件方法接受，判断是否保存，如果不记住密码要把，同时修改默认的帐号密码定义</p>
</li>
<li><p>关键代码：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//登录页组件传值给子组件</span></span><br><span class="line"><span class="keyword">const</span> isRemPwd = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line">accountRef.<span class="property">value</span>?.<span class="title function_">loginAction</span>(isRemPwd.<span class="property">value</span>)</span><br><span class="line"><span class="comment">//子组件接受</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loginAction</span>(<span class="params"><span class="attr">isKeep</span>: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;子组件收到的参数,是否保存:&#x27;</span>, isKeep)</span><br><span class="line"><span class="comment">//判断是否要记住密码</span></span><br><span class="line">      <span class="keyword">if</span> (isKeep) &#123;</span><br><span class="line">        localCache.<span class="title function_">setCache</span>(<span class="string">&#x27;name&#x27;</span>, name)</span><br><span class="line">        localCache.<span class="title function_">setCache</span>(<span class="string">&#x27;password&#x27;</span>, password)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        localCache.<span class="title function_">deleteCache</span>(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        localCache.<span class="title function_">deleteCache</span>(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line"><span class="comment">//记住密码--如果cache里有保存用户的数据，用用户的数据填空，否则再用&#x27;&#x27;</span></span><br><span class="line"><span class="comment">// ?? 非空断言</span></span><br><span class="line"><span class="keyword">const</span> account = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: localCache.<span class="title function_">getCache</span>(<span class="string">&#x27;name&#x27;</span>) ?? <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">password</span>: localCache.<span class="title function_">getCache</span>(<span class="string">&#x27;password&#x27;</span>) ?? <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>选择记住密码后重新回到login页面，页面自动填写帐号密码<br><img src="/postImgs/nievtcms/login10.png" alt="记住密码成功"></p>
</li>
</ol>
<h4 id="进阶：记住密码按钮状态保持"><a href="#进阶：记住密码按钮状态保持" class="headerlink" title="进阶：记住密码按钮状态保持"></a>进阶：记住密码按钮状态保持</h4><p>如果用户上一次登录勾选了“记住密码”那么下一次进入登录页面，“记住密码”选项默认被勾选，如果用户上一次登录没有勾选“记住密码”，那么下一次进入登录页默认不勾选</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isRemPwd = ref&lt;<span class="built_in">boolean</span>&gt;(localCache.<span class="title function_">getCache</span>(<span class="string">&#x27;isRemPwd&#x27;</span>) ?? <span class="literal">false</span>)</span><br><span class="line"><span class="title function_">watch</span>(isRemPwd, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">  localCache.<span class="title function_">setCache</span>(<span class="string">&#x27;isRemPwd&#x27;</span>, newValue)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="用户权限管理与缓存（基于用户的访问控制）"><a href="#用户权限管理与缓存（基于用户的访问控制）" class="headerlink" title="用户权限管理与缓存（基于用户的访问控制）"></a>用户权限管理与缓存（基于用户的访问控制）</h2><h3 id="获取用户权限"><a href="#获取用户权限" class="headerlink" title="获取用户权限"></a>获取用户权限</h3><p>根据登录用户不同，呈现不同的后台管理系统内容（具备不同的操作权限）<br>目前用户登录后，从登录接口能拿到token,用户id，用户name<br>再根据id，发送请求获取用户详情（用户角色等详细信息）<br>查看接口文档，会发现这个操作需要授权（要有token）<br>应该把token放到header里，可以在请求时写</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getUserDetailById</span>(<span class="params"><span class="attr">id</span>: <span class="built_in">number</span></span>) &#123; </span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">HyRequest</span>.<span class="title function_">get</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/users/&#x27;<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="title class_">Authorization</span>: localCache.<span class="title function_">getCache</span>(<span class="variable constant_">LOGIN_TOKEN</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是开发中我们希望每个接口发送请求 都携带token，每次都单独放一个太重复了这时候要<strong>放到拦截器里</strong>帮我们在请求中携带，在每个请求的config里都帮我们携带</p>
<h3 id="用拦截器给每个请求携带token"><a href="#用拦截器给每个请求携带token" class="headerlink" title="用拦截器给每个请求携带token"></a>用拦截器给每个请求携带token</h3><p>(拦截器使用老师封装好的代码，我只进行了使用)</p>
<ol>
<li>流程理解：<br> 用户登录成功后，后端返回token<br> token被存储在本地缓存中（使用 localCache.setCache(LOGIN_TOKEN, token) ）<br> 之后的每次请求，这个拦截器都会自动运行<br> 拦截器从缓存中获取token，并添加到请求头中<br> 服务器接收到带有token的请求，验证用户身份</li>
</ol>
<blockquote>
<p>这种方式的优点：<br>自动化：不需要在每个请求中手动添加token<br>统一管理：所有的token处理逻辑都在一个地方<br>类型安全：使用TypeScript确保类型安全<br>可维护性：易于修改和维护token的处理逻辑<br>2. 拦截器代码：</p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hyRequest = <span class="keyword">new</span> <span class="title class_">HYRequest</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="variable constant_">BASE_URL</span>,</span><br><span class="line">  <span class="comment">//如果请求超过这个时间还没有响应，就会自动失败</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="variable constant_">TIME_OUT</span>,</span><br><span class="line">  <span class="comment">//interceptors拦截器配置</span></span><br><span class="line">  <span class="attr">interceptors</span>: &#123;</span><br><span class="line">    <span class="comment">//requestSuccessFn是一个请求成功的拦截器函数，</span></span><br><span class="line">    <span class="comment">//它的作用是在每个请求发送之前自动添加认证头token</span></span><br><span class="line">    <span class="attr">requestSuccessFn</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 每一个请求都自动携带token</span></span><br><span class="line">      <span class="keyword">const</span> token = localCache.<span class="title function_">getCache</span>(<span class="variable constant_">LOGIN_TOKEN</span>)</span><br><span class="line">      <span class="comment">//如果请求头存在且token也存在，就将token添加到请求头中</span></span><br><span class="line">      <span class="keyword">if</span> (config.<span class="property">headers</span> &amp;&amp; token) &#123;</span><br><span class="line">        <span class="comment">// 类型缩小，确保每个里面都有值</span></span><br><span class="line">        <span class="comment">//使用 Bearer 认证方式，这是一种常见的JSON Web Token认证方式</span></span><br><span class="line">        config.<span class="property">headers</span>.<span class="property">Authorization</span> = <span class="string">&#x27;Bearer &#x27;</span> + token</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> config</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>获取coderwhy的用户信息成功<br><img src="/postImgs/nievtcms/login11.png" alt="获取用户信息成功"></p>
<h3 id="如何指定state类型"><a href="#如何指定state类型" class="headerlink" title="如何指定state类型"></a>如何指定state类型</h3><p>使用泛型+箭头函数</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">ILoginState</span> &#123;</span><br><span class="line">  <span class="attr">token</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">userInfo</span>: <span class="built_in">any</span></span><br><span class="line">  <span class="attr">userMenus</span>: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useLoginStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;login&#x27;</span>, &#123;</span><br><span class="line">  <span class="comment">// 如何制定state的类型</span></span><br><span class="line">  <span class="attr">state</span>: (): <span class="function"><span class="params">ILoginState</span> =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">token</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">userInfo</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">userMenus</span>: []</span><br><span class="line">  &#125;),</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="获取用户菜单信息"><a href="#获取用户菜单信息" class="headerlink" title="获取用户菜单信息"></a>获取用户菜单信息</h3><p>类似获取用户详细信息<br>先根据用户id获取用户详细信息，从用户详细信息中得到用户角色，再根据用户角色获取该角色的菜单信息（根据角色获取权限）</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5.根据role的id获取菜单</span></span><br><span class="line">  <span class="keyword">const</span> roleId = userInfo.<span class="property">data</span>.<span class="property">role</span>.<span class="property">id</span></span><br><span class="line">  <span class="keyword">const</span> userMenusResult = <span class="keyword">await</span> <span class="title function_">getRoleMenus</span>(roleId)</span><br><span class="line">  <span class="keyword">const</span> userMenus = userMenusResult.<span class="property">data</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">userMenus</span> = userMenus</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;userMenus&#x27;</span>, userMenus)</span><br></pre></td></tr></table></figure>
<p><img src="/postImgs/nievtcms/login12.png" alt="获取用户菜单信息成功"></p>
<h3 id="本地缓存个人信息和菜单信息"><a href="#本地缓存个人信息和菜单信息" class="headerlink" title="本地缓存个人信息和菜单信息"></a>本地缓存个人信息和菜单信息</h3><p>放到store中的数据是一种内存缓存，刷新会消失，期望一直存在需要进行本地缓存<br>store&#x2F;login.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//6. 保存结果到本地缓存</span></span><br><span class="line"><span class="comment">//下面这一行要放在上面，因为下面两个请求需要token要，不能为了好看把这个也放下去</span></span><br><span class="line">localCache.<span class="title function_">setCache</span>(<span class="variable constant_">LOGIN_TOKEN</span>, <span class="variable language_">this</span>.<span class="property">token</span>)</span><br><span class="line"></span><br><span class="line">localCache.<span class="title function_">setCache</span>(<span class="string">&#x27;useInfo&#x27;</span>, <span class="variable language_">this</span>.<span class="property">userInfo</span>)</span><br><span class="line">localCache.<span class="title function_">setCache</span>(<span class="string">&#x27;userMenus&#x27;</span>, userMenus)</span><br></pre></td></tr></table></figure>
<p>同时修改state中对数据的定义</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">state</span>: (): <span class="function"><span class="params">ILoginState</span> =&gt;</span> (&#123;</span><br><span class="line">  <span class="comment">//进行本地缓存后，改为这样</span></span><br><span class="line">  <span class="attr">token</span>: <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>) ?? <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">userInfo</span>: localCache.<span class="title function_">getCache</span>(<span class="string">&#x27;userInfo&#x27;</span>) ?? &#123;&#125;,</span><br><span class="line">  <span class="attr">userMenus</span>: localCache.<span class="title function_">getCache</span>(<span class="string">&#x27;userMenus&#x27;</span>) ?? []</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure>
<p><img src="/postImgs/nievtcms/login13(1).png" alt="本地缓存信息成功"><br><img src="/postImgs/nievtcms/login13.png" alt="本地缓存信息成功"></p>
<h3 id="store为什么看不见呢（细节）"><a href="#store为什么看不见呢（细节）" class="headerlink" title="store为什么看不见呢（细节）"></a>store为什么看不见呢（细节）</h3><p>在main页面中，明明之前保存了但是开始看不到store，为什么呢<br>原因是刚开始开发这个页面，还没写ts,而pinia中有很多个store，在你没有使用的时候它不会出现，需要在mian页面使用（导入拿到）一下它，这样就能看到了</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useLoginStore <span class="keyword">from</span> <span class="string">&#x27;@/store/login/login&#x27;</span></span><br><span class="line"><span class="keyword">const</span> loginStore = <span class="title function_">useLoginStore</span>()</span><br><span class="line"><span class="comment">//获取菜单，同时使用loginStore了，现在页面的pinia里有菜单的数据</span></span><br><span class="line"><span class="keyword">const</span> userMenus = loginStore.<span class="property">userMenus</span></span><br></pre></td></tr></table></figure>
<h1 id="首页"><a href="#首页" class="headerlink" title="首页"></a>首页</h1><h2 id="首页布局"><a href="#首页布局" class="headerlink" title="首页布局"></a>首页布局</h2><p>先把结构搭出来，在和后端给的数据做对比，如果返回数据很乱，用一个映射的工具函数把很乱的数据处理成自己想要的格式，再把数据放进界面展示</p>
<h3 id="搭架子"><a href="#搭架子" class="headerlink" title="搭架子"></a>搭架子</h3><p>用element-ui的布局组件，（Basic基础组件&#x2F;布局容器&#x2F;常见布局页面<br><img src="/postImgs/nievtcms/main1.png" alt="组件选取"><br>在main.vue先搭架子，然后放组件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">el-container</span> <span class="attr">class</span>=<span class="string">&quot;main-content&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">el-aside</span> <span class="attr">width</span>=<span class="string">&quot;200px&quot;</span>&gt;</span>Aside<span class="tag">&lt;/<span class="name">el-aside</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">el-container</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-header</span>&gt;</span>Header<span class="tag">&lt;/<span class="name">el-header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-main</span>&gt;</span>Main<span class="tag">&lt;/<span class="name">el-main</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="comment">//放组件</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="首页–左侧菜单栏布局"><a href="#首页–左侧菜单栏布局" class="headerlink" title="首页–左侧菜单栏布局"></a>首页–左侧菜单栏布局</h3><ol>
<li>选取组件<br>element-ui的导航组件（导航&#x2F;菜单&#x2F;侧栏）<br>注意复制的代码是el-menu部分，没用到的爆红的先删掉，用到再加<br><img src="/postImgs/nievtcms/main2.png" alt="菜单栏选取"><br>理解菜单组件代码<br><img src="/postImgs/nievtcms/main3.png" alt="菜单栏选取"></li>
<li>先手动搭建目标菜单<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;menu&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-menu</span> <span class="attr">text-color</span>=<span class="string">&quot;#b7bdc3&quot;</span> <span class="attr">active-text-color</span>=<span class="string">&quot;#fff&quot;</span> <span class="attr">background-color</span>=<span class="string">&quot;#001529&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1.系统总览 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-sub-menu</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> #<span class="attr">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-icon</span>&gt;</span><span class="tag">&lt;<span class="name">Monitor</span> /&gt;</span><span class="tag">&lt;/<span class="name">el-icon</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>系统总览<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-menu-item</span>&gt;</span>核心技术<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-menu-item</span>&gt;</span>商品统计<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-sub-menu</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 2.系统管理 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-sub-menu</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> #<span class="attr">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-icon</span>&gt;</span><span class="tag">&lt;<span class="name">Setting</span> /&gt;</span><span class="tag">&lt;/<span class="name">el-icon</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>系统管理<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-menu-item</span>&gt;</span>用户管理<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-menu-item</span>&gt;</span>部门管理<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-menu-item</span>&gt;</span>菜单管理<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-menu-item</span>&gt;</span>角色管理<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-sub-menu</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 3.商品中心 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-sub-menu</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> #<span class="attr">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-icon</span>&gt;</span><span class="tag">&lt;<span class="name">ShoppingBag</span> /&gt;</span><span class="tag">&lt;/<span class="name">el-icon</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>商品中心<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-menu-item</span>&gt;</span>商品类别<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-menu-item</span>&gt;</span>商品信息<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-sub-menu</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 4.随便聊聊 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-sub-menu</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> #<span class="attr">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-icon</span>&gt;</span><span class="tag">&lt;<span class="name">Monitor</span> /&gt;</span><span class="tag">&lt;/<span class="name">el-icon</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>随便聊聊<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-menu-item</span>&gt;</span>你的故事<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-menu-item</span>&gt;</span>故事列表<span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-sub-menu</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-menu</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>动态获取菜单–获取菜单名<br>在这里我卡了会儿，原因是没有仔细看数据格式<br>应该是<code>v-for=&quot;item in userMenus.data&quot;</code>，开始写成了<code>v-for=&quot;item in userMenus&quot;</code>，少了<code>.data</code><br><img src="/postImgs/nievtcms/menu1.png" alt="动态获取菜单名"></li>
<li>动态组件展示图标<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> &lt;!-- 字符串: el-icon-<span class="function"><span class="params">monitor</span> =&gt;</span> 组件 component动态组件 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">el-icon</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;item.icon.split(&#x27;-icon-&#x27;)[1]&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">el-icon</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<img src="/postImgs/nievtcms/menu2.png" alt="动态获取菜单名"></li>
<li>完整菜单代码<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 菜单栏内容 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;menu&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-menu</span></span></span><br><span class="line"><span class="tag">    <span class="attr">default-active</span>=<span class="string">&quot;3&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:collapse</span>=<span class="string">&quot;isFold&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">text-color</span>=<span class="string">&quot;#b7bdc3&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">active-text-color</span>=<span class="string">&quot;#fff&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">background-color</span>=<span class="string">&quot;#001529&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 动态获取菜单：先遍历整个菜单，用id作为Key， --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;item in userMenus.data&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 加上 :index=&quot;item.id + &#x27;&#x27;&quot; 这样就知道要展开哪个，不会全部展开了 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-sub-menu</span> <span class="attr">:index</span>=<span class="string">&quot;item.id + &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> #<span class="attr">title</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 字符串: el-icon-monitor =&gt; 组件 component动态组件 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-icon</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;item.icon.split(&#x27;-icon-&#x27;)[1]&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-icon</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 继续获取子菜单 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;subitem in item.children&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;subitem.id&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">:index</span>=<span class="string">&quot;subitem.path&quot;</span>&gt;</span></span><br><span class="line">            &#123;&#123; subitem.name &#125;&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-menu-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-sub-menu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-menu</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="首页–头部布局"><a href="#首页–头部布局" class="headerlink" title="首页–头部布局"></a>首页–头部布局</h3><h4 id="菜单栏折叠功能搭建"><a href="#菜单栏折叠功能搭建" class="headerlink" title="菜单栏折叠功能搭建"></a>菜单栏折叠功能搭建</h4><p><img src="/postImgs/nievtcms/%E9%9D%A2%E5%8C%85%E5%B1%91.png" alt="面包屑"></p>
<ol>
<li>选取控制折叠组件<br>最开始的状态：两个动态的图标都展示<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;main-header&quot;&gt;</span><br><span class="line">    &lt;!-- 首页头部面包屑 --&gt;</span><br><span class="line">    &lt;div class=&quot;menu-icon&quot; @click=&quot;handleMenuIconClick&quot;&gt;</span><br><span class="line">      &lt;!-- 希望展开状态下展示第一个，折叠状态展示第二个 --&gt;</span><br><span class="line">      &lt;el-icon size=&quot;28px&quot;&gt;&lt;Fold /&gt;&lt;/el-icon&gt;</span><br><span class="line">      &lt;el-icon size=&quot;28px&quot;&gt;&lt;Expand /&gt; &lt;/el-icon&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;content&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;breadcrumb&quot;&gt;面包屑，左侧两个图标随切换展示&lt;/div&gt;</span><br><span class="line">      &lt;header-info /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure></li>
<li>动态组件切换折叠状态<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;main-header&quot;&gt;</span><br><span class="line">    &lt;!-- 首页头部面包屑 --&gt;</span><br><span class="line">    &lt;div class=&quot;menu-icon&quot; @click=&quot;handleMenuIconClick&quot;&gt;</span><br><span class="line">      &lt;el-icon size=&quot;28px&quot;&gt;</span><br><span class="line">        &lt;component :is=&quot;isFold ? &#x27;Expand&#x27; : &#x27;Fold&#x27;&quot; /&gt;</span><br><span class="line">      &lt;/el-icon&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;content&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;breadcrumb&quot;&gt;面包屑&lt;/div&gt;</span><br><span class="line">      &lt;header-info /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mport &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">const</span> isFold = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleMenuIconClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//切换是否折叠状态isFold,配合动态组件使用</span></span><br><span class="line">  isFold.<span class="property">value</span> = !isFold.<span class="property">value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
切换是否折叠状态isFold<br><img src="/postImgs/nievtcms/%E9%9D%A2%E5%8C%85%E5%B1%912.png" alt="面包屑"></li>
</ol>
<h4 id="折叠菜单切换（组件通信）"><a href="#折叠菜单切换（组件通信）" class="headerlink" title="折叠菜单切换（组件通信）"></a>折叠菜单切换（组件通信）</h4><p>通过面包屑的点击来切换左侧菜单栏是否折叠,折叠要改变两部分：菜单栏内容和菜单栏宽度</p>
<ol>
<li>菜单栏折叠<br>在element-ui的菜单组件中，有规定通过属性collapse的true&#x2F;false来控制菜单栏是否折叠</li>
<li>让父组件改变宽度<br>左侧菜单栏和顶部面包屑都是父组件main.vue的子组件<br>子组件<code>main-header</code>内部改变，要把事件和状态传递给父组件<br>父组件接受子组件的事件和状态，改变父组件中设置宽度的值<code>&lt;el-aside :width=&quot;isFold ? &#39;60px&#39; : &#39;210px&#39;&quot;&gt;</code></li>
</ol>
<p><img src="/postImgs/nievtcms/menu3.png" alt="关键代码"></p>
<ol start="3">
<li>让兄弟组件改变折叠状态<br>父组件把是否折叠传递给菜单子组件，决定菜单是否折叠，文字是否显示<br><code>&lt;main-menu :is-fold=&quot;isFold&quot; &gt;&lt;/main-menu&gt;</code><br><code>&lt;h2 class=&quot;title&quot; v-show=&quot;!isFold&quot;&gt;聂聂管理系统&lt;/h2&gt;</code><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接受父组件传递的数组决定是否折叠菜单</span></span><br><span class="line"><span class="title function_">defineProps</span>(&#123;</span><br><span class="line">  <span class="attr">isFold</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<img src="/postImgs/nievtcms/menu4.png" alt="菜单折叠与否展示"></li>
</ol>
<h4 id="头部内容"><a href="#头部内容" class="headerlink" title="头部内容"></a>头部内容</h4><p>从组件库找对应的组件一点点搭建<br><img src="/postImgs/nievtcms/menu5.png" alt="菜单折叠与否展示"></p>
<p>style中子组件的根元素可以被父组件直接选中，不需要加deep；子组件背包包裹的其他父组件不能选中</p>
<h2 id="路由配置（有缺陷方法）"><a href="#路由配置（有缺陷方法）" class="headerlink" title="路由配置（有缺陷方法）"></a>路由配置（有缺陷方法）</h2><ol>
<li>先创建页面，再根据路径和关系配路由<br>在哪里创建动态路由的文件，怎么命名，看后端返回的数据命名<br>我这里先在views&#x2F;main下建analysis文件夹和system文件夹，下面放main页面标签里对应展示的页面</li>
<li>再在router里给所有页面配置路由<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/main&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/main/main.vue&#x27;</span>),</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;/main/analysis/overview&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="function">() =&gt;</span></span><br><span class="line">            <span class="keyword">import</span>(<span class="string">&#x27;../views/main/analysis/overview/overview.vue&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;/main/analysis/dashboard&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="function">() =&gt;</span></span><br><span class="line">            <span class="keyword">import</span>(<span class="string">&#x27;../views/main/analysis/dashboard/dashboard.vue&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;/main/system/user&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/main/system/user/user.vue&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;/main/system/role&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/main/system/role/role.vue&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="弊端"><a href="#弊端" class="headerlink" title="弊端"></a>弊端</h4><p>这样实现在地址栏输入地址即可跳转，让本不该有权限能访问对应页面的人也能够根据地址跳转</p>
<blockquote>
<p>那么如果没有权限的人进入页面，他能看到数据吗<br>应该是需要用token验证才能展示数据，看后端是否会验证<br>但是作为前端，不能取决于后端是否验证，开始就不该让用户进去</p>
</blockquote>
<h4 id="菜单点击实现路由跳转（重要）"><a href="#菜单点击实现路由跳转（重要）" class="headerlink" title="菜单点击实现路由跳转（重要）"></a>菜单点击实现路由跳转（重要）</h4><p>   在左侧导航菜单中，根据点击的子菜单不同，获取到不同子菜单的url，直接用router.push跳转</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 添加@click=&quot;handleItemClick(subitem)点击实现路由跳转 --&gt;</span><br><span class="line"> &lt;template v-for=&quot;subitem in item.children&quot; :key=&quot;subitem.id&quot;&gt;</span><br><span class="line">     &lt;el-menu-item :index=&quot;subitem.id + &#x27;&#x27;&quot; @click=&quot;handleItemClick(subitem)&quot;&gt;</span><br><span class="line">        &#123;&#123; subitem.name &#125;&#125;</span><br><span class="line">      &lt;/el-menu-item&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleItemClick</span>(<span class="params"><span class="attr">item</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> url = item.<span class="property">url</span></span><br><span class="line">  router.<span class="title function_">push</span>(url)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="动态路由（重难点）"><a href="#动态路由（重难点）" class="headerlink" title="动态路由（重难点）"></a>动态路由（重难点）</h2><p>根据用户角色的权限信息，动态地添加路由<br>登录的接口中请求三个内容：token,用户信息（包含角色信息role对象），菜单信息</p>
<h3 id="基于角色的动态路由管理"><a href="#基于角色的动态路由管理" class="headerlink" title="基于角色的动态路由管理"></a>基于角色的动态路由管理</h3><ol>
<li>用一个枚举类型包含所有的路由<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">consy roles  = &#123; </span><br><span class="line"><span class="string">&quot;superAdmin&quot;</span>:[所有的路由].=&gt;router.<span class="property">main</span>.<span class="property">children</span>,</span><br><span class="line"><span class="string">&quot;admin&quot;</span>:[一部分路由].=&gt;router.<span class="property">main</span>.<span class="property">children</span>,</span><br><span class="line"><span class="string">&quot;sericer&quot;</span>:[少部分路由].=&gt;router.<span class="property">main</span>.<span class="property">children</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>弊端<br>每增加一个角色类型，都要增加一个key&#x2F;value改变代码（前端来做修改代码需要重新发布，后端动态添加需要组织好json数据，后端很难写），所以做的很难，用的少</li>
</ol>
<h3 id="基于菜单的动态路由管理（重要）"><a href="#基于菜单的动态路由管理（重要）" class="headerlink" title="基于菜单的动态路由管理（重要）"></a>基于菜单的动态路由管理（重要）</h3><ol>
<li>思路：根据userMenus包含的菜单，添加到路由里，映射成路由</li>
<li>先创建文件<br>根据后端返回的菜单地址数据的结构，建立文件夹,和views中的文件嵌套关系保持一致：在router&#x2F;main文件夹中创建analysis文件夹里 包含若干文件夹和文件，都是可能的每一个路由</li>
</ol>
<p>比如dashboard.ts文件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/main/analysis/dashboard&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;@/views/main/analysis/dashboard/dashboard.vue&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>goods.ts文件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">goods</span> = (<span class="params"></span>) =&gt; <span class="keyword">import</span>(<span class="string">&#x27;@/views/main/product/goods/goods.vue&#x27;</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/main/product/goods&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;goods&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: goods,</span><br><span class="line">  <span class="attr">children</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/postImgs/nievtcms/router1.png" alt="文件创建"></p>
<blockquote>
<p>也可以用coderwhy老师的自动添加页面工具生成（目前没明白）<br>建文件位置对应好方便后续写一些自动化工具<br><code>npm instiall coderwhy -g</code><br><code>coderwhy ad3page_setup departent -d ser/views/main/system/department</code><br><code>coderwhy ad3page_setup category -d ser/views/main/system/category</code><br><code>coderwhy ad3page_setup chat -d ser/views/main/story.chat</code></p>
</blockquote>
<ol start="3">
<li>根据菜单，动态地添加路由对象（独立的文件中）</li>
</ol>
<ul>
<li>从store获取用户菜单信息userMenus（在store&#x2F;login&#x2F;login.ts中）</li>
<li>动态获取路由对象，放到数组中<br>路由对象都在独立的文件中<br>从文件中将所有路由对象先读取到数组中</li>
<li>根据菜单去匹配正确的路由加到main路由里<br>router.addRoute(‘main’,xxx)</li>
</ul>
<ol start="4">
<li>封装map-menus文件，菜单映射路由<br>在utils文件夹创建文件，负责把用户菜单里的路径映射成路由<br>最终store&#x2F;login&#x2F;login.ts中调用文件中的方法，传递用户菜单过去，返回路由，再把映射回来的路由添加到main路由里<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//动态添加路由,这里开始卡住，因为传的少了.data</span></span><br><span class="line"><span class="keyword">const</span> routes = <span class="title function_">mapMenusToRoutes</span>(userMenus.<span class="property">data</span>)</span><br><span class="line">routes.<span class="title function_">forEach</span>(<span class="function">(<span class="params">route</span>) =&gt;</span> router.<span class="title function_">addRoute</span>(<span class="string">&#x27;main&#x27;</span>, route))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里我犯了个错，开始进入main页面无法动态加载路由，控制台报警告。原因是我的router中<strong>没有给main路由配置name属性</strong>，导致动态添加的路由找不到main无法添加成为main的子路由<br>Vue Router 在动态添加路由时，需要通过 name 属性来识别父路由<br>router.addRoute(‘main’, route) 中的 ‘main’ 参数需要与父路由的 name 属性匹配<br><img src="/postImgs/nievtcms/router2.png" alt="动态添加路由对象成功"></p>
</blockquote>
</li>
</ol>
<p>动态路由功能成功，点击菜单可以调换到对应路由页面<br><img src="/postImgs/nievtcms/router3.png" alt="点击菜单可以调换到对应路由页面"></p>
<h4 id="解决刷新页面路由丢失问题"><a href="#解决刷新页面路由丢失问题" class="headerlink" title="解决刷新页面路由丢失问题"></a>解决刷新页面路由丢失问题</h4><p>刷新main页面时应该保存动态路由的状态<br>问题如下图，此时虽然完成了基于菜单的动态路由管理，但是用户登录后<strong>刷新页面</strong>，路由会丢失，router里只剩下默认的main,login,404路由<br><img src="/postImgs/nievtcms/router4.png" alt="解决刷新页面路由丢失问题"><br>关键代码：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = <span class="title function_">mapMenusToRoutes</span>(userMenus.<span class="property">data</span>)</span><br><span class="line">routes.<span class="title function_">forEach</span>(<span class="function">(<span class="params">route</span>) =&gt;</span> router.<span class="title function_">addRoute</span>(<span class="string">&#x27;main&#x27;</span>, route))</span><br></pre></td></tr></table></figure>
<p>原因是：目前这段动态添加路由的代码只会在用户登录时被执行<br>解决思路：让用户刷新页面时也执行一遍动态添加路由的代码<br><strong>不光登录时要映射一次动态路由，刷新的时候也要映射一次</strong><br>还是在store&#x2F;login&#x2F;login.ts中添加</p>
<p>用户在进行刷新时，判断用户是否登录，是否拥有菜单<br>再细一点，如果用户在login页面刷新不需要判断，在main页面刷新要判断<br>继续理解，如果用户要从cache里读取userMenus时，也要动态加载路由（而不只是登录 时动态加载）</p>
<p>这里代码一点点写完了自己检查也没问题，但功能实现不了，拜托AI老师帮我检查代码，<strong>发现use，user拼写错误，说明用常量声明key真的很重要</strong><br><img src="/postImgs/nievtcms/error1.png" alt="拼写错误"></p>
<p>改着改着userMenus的数据又出问题了，对我来说最喜欢的解决办法是都在控制台答应出来然后一个个检查改，这里问AI反而没解决，我觉得是因为他不知道后端给我传的数据是什么样子的<br>而且我不该这样起名，仓库里有userMenu，函数中还用userMenu接受.data后的数据，后续代码多了发现自己会乱掉，直接改命名为userMenuResData</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//检查数据</span></span><br><span class="line"><span class="keyword">const</span> roleId = userInfo.<span class="property">data</span>.<span class="property">role</span>.<span class="property">id</span></span><br><span class="line">      <span class="keyword">const</span> userMenusResult = <span class="keyword">await</span> <span class="title function_">getRoleMenus</span>(roleId)</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;userMenusResult&#x27;</span>, userMenusResult)</span><br><span class="line">      <span class="keyword">const</span> userMenus = userMenusResult.<span class="property">data</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;userMenus（ userMenusResult.data）&#x27;</span>, userMenus)</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;userMenus.data（ userMenusResult.data.data）&#x27;</span>, userMenus.<span class="property">data</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/postImgs/nievtcms/error2.png" alt=".data问题"><br>成功解决（详细的注释在代码里score&#x2F;login.ts）：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> roleId = userInfo.<span class="property">data</span>.<span class="property">role</span>.<span class="property">id</span></span><br><span class="line">     <span class="keyword">const</span> userMenusResult = <span class="keyword">await</span> <span class="title function_">getRoleMenus</span>(roleId)</span><br><span class="line">     <span class="keyword">const</span> userMenusData = userMenusResult.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;userMenusData&#x27;</span>, userMenusData)<span class="comment">//这个是期望保存的数据</span></span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">userMenus</span> = userMenusData</span><br><span class="line"></span><br><span class="line">     localCache.<span class="title function_">setCache</span>(<span class="string">&#x27;userInfo&#x27;</span>, <span class="variable language_">this</span>.<span class="property">userInfo</span>)</span><br><span class="line">     localCache.<span class="title function_">setCache</span>(<span class="string">&#x27;userMenus&#x27;</span>, <span class="variable language_">this</span>.<span class="property">userMenus</span>)</span><br></pre></td></tr></table></figure>
<p>下图.data问题和刷新重新加载路由解决：<br><img src="/postImgs/nievtcms/error3.png" alt=".data问题和刷新重新加载路由解决"><br>因为这里的userMenus比之前多加了层.data，所以在左侧菜单列表中脱一层.data<br><code>template v-for=&quot;item in userMenus.data&quot; :key=&quot;item.id&quot;&gt;</code><br>变为<code>template v-for=&quot;item in userMenus&quot; :key=&quot;item.id&quot;&gt;</code></p>
<h4 id="动态路由第一次进入main页面自动匹配子路由（听着容易做很难）"><a href="#动态路由第一次进入main页面自动匹配子路由（听着容易做很难）" class="headerlink" title="动态路由第一次进入main页面自动匹配子路由（听着容易做很难）"></a>动态路由第一次进入main页面自动匹配子路由（听着容易做很难）</h4><p>登录成功时，要给用户展示一个页面，第一次进入的页面应该是动态路由注册的<strong>所有页面中的第一个页面</strong>（不同用户拥有的路由不一样，所以第一个页面也不一样）<br>再梳理一下思路</p>
<blockquote>
<ol>
<li>当用户登录成功后，后端会返回该用户的权限菜单列表</li>
<li>mapMenusToRoutes 函数会：</li>
</ol>
<ul>
<li>加载本地所有路由配置</li>
<li>将用户菜单与本地路由进行匹配</li>
<li>记录第一个匹配到的菜单项到 firstMenu</li>
<li>为一级菜单添加重定向到其第一个子菜单</li>
<li>添加所有匹配的二级菜单路由</li>
</ul>
<ol start="3">
<li>当用户访问 &#x2F;main 路径时</li>
</ol>
<ul>
<li>路由守卫会检查到路径是 &#x2F;main</li>
<li>自动重定向到 firstMenu.url （第一个匹配到的菜单路径）</li>
<li>这样就实现了进入主页面时自动跳转到第一个子菜单页面</li>
</ul>
<ol start="4">
<li>这样的设计可以：<br>确保用户总能看到一个有效的页面内容<br>避免 &#x2F;main 路径下显示空白页面<br>提供更好的用户体验</li>
</ol>
</blockquote>
<p>封装方法在utils&#x2F;map-menus-to-routes.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// firstMenu记录第一个被匹配到的菜单项</span></span><br><span class="line"><span class="comment">// 用于实现进入 /main 路径时的自动重定向</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> <span class="attr">firstMenu</span>: <span class="built_in">any</span> = <span class="literal">null</span></span><br><span class="line"><span class="comment">//userMenus是用户的菜单列表数组</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">mapMenusToRoutes</span>(<span class="params"><span class="attr">userMenus</span>: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">  <span class="comment">// 1.加载本地路由</span></span><br><span class="line">  <span class="keyword">const</span> localRoutes = <span class="title function_">loadLocalRoutes</span>()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.根据菜单去匹配正确的路由</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">routes</span>: <span class="title class_">RouteRecordRaw</span>[] = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> menu <span class="keyword">of</span> userMenus) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> submenu <span class="keyword">of</span> menu.<span class="property">children</span>) &#123;</span><br><span class="line">      <span class="comment">//用户菜单中的url和本地路由的path进行匹配，如果本地路由地址和用户菜单地址一样</span></span><br><span class="line">      <span class="comment">//那么就把这个菜单对应的路由添加到数组routes中</span></span><br><span class="line">      <span class="keyword">const</span> route = localRoutes.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">path</span> === submenu.<span class="property">url</span>)</span><br><span class="line">      <span class="comment">//如果用户菜单中的 URL 和本地路由的 path 相匹配</span></span><br><span class="line">      <span class="keyword">if</span> (route) &#123;</span><br><span class="line">        <span class="comment">// 1.给route的顶层菜单增加重定向功能(但是只需要添加一次即可)</span></span><br><span class="line">        <span class="comment">//检查是否已经为当前一级菜单设置了重定向，如果没有设置过，就添加一个重定向配置</span></span><br><span class="line">        <span class="comment">//一级菜单重定向</span></span><br><span class="line">        <span class="keyword">if</span> (!routes.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">path</span> === menu.<span class="property">url</span>)) &#123;</span><br><span class="line">          routes.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: menu.<span class="property">url</span>, <span class="attr">redirect</span>: route.<span class="property">path</span> &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 添加二级菜单路由</span></span><br><span class="line">        <span class="comment">//直接将匹配到的路由配置添加到路由数组中</span></span><br><span class="line">        routes.<span class="title function_">push</span>(route)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 记录第一个被匹配到的菜单，这个 firstMenu 会用于进入 /main 路径时的自动重定向</span></span><br><span class="line">      <span class="comment">//如果 firstMenu 还没有值，并且找到了匹配的路由，就把当前的子菜单记录为第一个菜单</span></span><br><span class="line">      <span class="keyword">if</span> (!firstMenu &amp;&amp; route) firstMenu = submenu</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> routes</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在router&#x2F;index.ts中添加</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; firstMenu &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/map-menus&#x27;</span></span><br><span class="line">   <span class="comment">// 如果是进入到main，如果firstMenu 存在</span></span><br><span class="line">  <span class="comment">// 返回firstMenu的url属性作为重定向目标，自动跳转到第一个子菜单页面</span></span><br><span class="line">  <span class="keyword">if</span> (to.<span class="property">path</span> === <span class="string">&#x27;/main&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> firstMenu?.<span class="property">url</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>上述都完成后，进入main页面刷新后样式：<br><img src="/postImgs/nievtcms/router5.png" alt="当前页面样式"></p>
<h4 id="main页面刷新–根据路径匹配menu（停留在刷新前页面-子菜单）"><a href="#main页面刷新–根据路径匹配menu（停留在刷新前页面-子菜单）" class="headerlink" title="main页面刷新–根据路径匹配menu（停留在刷新前页面+子菜单）"></a>main页面刷新–根据路径匹配menu（停留在刷新前页面+子菜单）</h4><ol>
<li>理解：<br>刚才完成了第一次进入main页面进入的是用户第一个匹配到的菜单路由，但是用户在页面点击刷新，希望刷新之后显示的依旧是刷新时的路由页面，而不是默认的firstMenu</li>
<li>思路：根据路径匹配菜单<br>根据刷新前的url路径去匹配对应的菜单，这个方法mapPathToMenu()还是封装在utils&#x2F;map-menus-to-routes.ts中，在main-menu.vue中调用<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据路径去匹配需要显示的菜单</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> path 需要匹配的路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userMenus 所有的菜单</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">mapPathToMenu</span>(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span>, <span class="attr">userMenus</span>: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> menu <span class="keyword">of</span> userMenus) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> submenu <span class="keyword">of</span> menu.<span class="property">children</span>) &#123;</span><br><span class="line">      <span class="comment">//子菜单的路径等于要匹配的路径，返回这个子菜单给main-menu.vue</span></span><br><span class="line">      <span class="keyword">if</span> (submenu.<span class="property">url</span> === path) &#123;</span><br><span class="line">        <span class="keyword">return</span> submenu</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
在main-menu.vue中调用：<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3.ElMenu的默认菜单</span></span><br><span class="line"><span class="keyword">const</span> route = <span class="title function_">useRoute</span>()</span><br><span class="line"><span class="keyword">const</span> defaultActive = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> pathMenu = <span class="title function_">mapPathToMenu</span>(route.<span class="property">path</span>, userMenus)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pathMenu&#x27;</span>, pathMenu)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;pathMenu.id + &#x27;&#x27;&quot;</span>, pathMenu.<span class="property">id</span> + <span class="string">&#x27;&#x27;</span>) <span class="comment">//返回一个数字字符串,给菜单的:default-active=&quot;defaultActive&quot;和</span></span><br><span class="line">  <span class="keyword">return</span> pathMenu.<span class="property">id</span> + <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
这里才意识到，之前到现在我的被选中的菜单栏子菜单一直没有高亮，原因是:index属性的属性值错误<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- &lt;el-menu-item :index=&quot;subitem.path&quot; @click=&quot;handleItemClick(subitem)&quot;&gt; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 被选中子菜单不高亮展示的原因：上边错误代码，下面正确代码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-menu-item</span> <span class="attr">:index</span>=<span class="string">&quot;subitem.id + &#x27;&#x27;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleItemClick(subitem)&quot;</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<img src="/postImgs/nievtcms/error4.png" alt=".data问题和刷新重新加载路由解决"></li>
</ol>
<h2 id="面包屑实现"><a href="#面包屑实现" class="headerlink" title="面包屑实现"></a>面包屑实现</h2><p>上面布局的时候用了组件占了放面包屑的位置，现在具体实现<br>element-ui&#x2F;导航&#x2F;面包屑组件，我选的“图标分隔符”的面包屑，单独封装一个组件（main-header&#x2F;c-cpns&#x2F;header-crumb.vue），放进之前给面包屑留位置的div里</p>
<p>面包屑需要拿到当前子菜单和它父级的名字，在<code>utils/map-menus.ts</code>中封装方法返回面包屑需要的数据</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IBreadcrumbs</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">path</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">mapPathToBreadcrumbs</span>(<span class="params"><span class="attr">path</span>: <span class="built_in">string</span>, <span class="attr">userMenus</span>: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">  <span class="comment">// 1.定义面包屑</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">breadcrumbs</span>: <span class="title class_">IBreadcrumbs</span>[] = []</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.遍历获取面包屑层级</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> menu <span class="keyword">of</span> userMenus) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> submenu <span class="keyword">of</span> menu.<span class="property">children</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (submenu.<span class="property">url</span> === path) &#123;</span><br><span class="line">        <span class="comment">// 面包屑里先加父级菜单</span></span><br><span class="line">        breadcrumbs.<span class="title function_">push</span>(&#123; <span class="attr">name</span>: menu.<span class="property">name</span>, <span class="attr">path</span>: menu.<span class="property">url</span> &#125;)</span><br><span class="line">        <span class="comment">// 再加子菜单</span></span><br><span class="line">        breadcrumbs.<span class="title function_">push</span>(&#123; <span class="attr">name</span>: submenu.<span class="property">name</span>, <span class="attr">path</span>: submenu.<span class="property">url</span> &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> breadcrumbs</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在面包屑组件中调用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> breadcrumbs = <span class="title function_">mapPathToBreadcrumbs</span>(route.<span class="property">path</span>, userMenus)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>路径怎么办呢，看官方文档<br><img src="/postImgs/nievtcms/%E9%9D%A2%E5%8C%85%E5%B1%913.png" alt="面包屑路径"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;curmb&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--el-breadcrumb最外层包裹面包屑的di --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-breadcrumb</span> <span class="attr">separator-icon</span>=<span class="string">&quot;CaretRight&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;item in breadcrumbs&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.name&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 每一节小面包 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-breadcrumb-item</span> <span class="attr">:to</span>=<span class="string">&quot;item.path&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123; item.name &#125;&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-breadcrumb-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-breadcrumb</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="面包屑实时更新（用计算属性）"><a href="#面包屑实时更新（用计算属性）" class="headerlink" title="面包屑实时更新（用计算属性）"></a>面包屑实时更新（用计算属性）</h3><p>现在完成的面包屑是静态的（只获取了一次地址），在切换菜单路径变化后没有重新调用方法更新面包屑<br><mark>这时候要用计算属性，当里面依赖的数据改变时，会自动刷新调用方法</mark></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> breadcrumbs = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">mapPathToBreadcrumbs</span>(route.<span class="property">path</span>, userMenus)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/postImgs/nievtcms/%E9%9D%A2%E5%8C%85%E5%B1%914.png" alt="面包屑路径"></p>
<h3 id="点击父菜单跳转完善（仔细理解）"><a href="#点击父菜单跳转完善（仔细理解）" class="headerlink" title="点击父菜单跳转完善（仔细理解）"></a>点击父菜单跳转完善（仔细理解）</h3><p>比如上图，在点击父分类“随便聊聊”时，找到的是404页面，因为父路径没有东西<br>解决方法：只要点击父路径都进入到里面的第一个子菜单<br>在map-menys.ts封装菜单转路由的方法中完善</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (route) &#123;</span><br><span class="line">        <span class="comment">// 1.给route的顶层菜单增加重定向功能(但是只需要添加一次即可)</span></span><br><span class="line">        <span class="comment">//检查是否已经为当前一级菜单设置了重定向，如果没有设置过，就添加一个重定向配置</span></span><br><span class="line">        <span class="comment">//一级菜单重定向</span></span><br><span class="line">        <span class="keyword">if</span> (!routes.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="property">path</span> === menu.<span class="property">url</span>)) &#123;</span><br><span class="line">          routes.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: menu.<span class="property">url</span>, <span class="attr">redirect</span>: route.<span class="property">path</span> &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 添加二级菜单路由</span></span><br><span class="line">        <span class="comment">//直接将匹配到的路由配置添加到路由数组中</span></span><br><span class="line">        routes.<span class="title function_">push</span>(route)</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p>在main-menu.vue中，也把获取菜单的方法变成计算属性</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> route = <span class="title function_">useRoute</span>()</span><br><span class="line"><span class="keyword">const</span> defaultActive = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> pathMenu = <span class="title function_">mapPathToMenu</span>(route.<span class="property">path</span>, userMenus)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pathMenu&#x27;</span>, pathMenu)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;pathMenu.id + &#x27;&#x27;&quot;</span>, pathMenu.<span class="property">id</span> + <span class="string">&#x27;&#x27;</span>) <span class="comment">//返回一个数字字符串</span></span><br><span class="line">  <span class="keyword">return</span> pathMenu.<span class="property">id</span> + <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="用户管理页面"><a href="#用户管理页面" class="headerlink" title="用户管理页面"></a>用户管理页面</h1><h2 id="查询信息功能部分"><a href="#查询信息功能部分" class="headerlink" title="查询信息功能部分"></a>查询信息功能部分</h2><h3 id="查询布局–element布局"><a href="#查询布局–element布局" class="headerlink" title="查询布局–element布局"></a>查询布局–element布局</h3><p>放在user文件夹&#x2F;c-cpns文件夹&#x2F;user-search.vue中<br>使用组件&#x2F;layout布局，看下图理解<br><img src="/postImgs/nievtcms/user1.png" alt="layout布局"><br>查询部分表单如下：<br>这里写一行20，但是前三个8已经占满了一行，那么后面的几个8会自动另起一行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form</span> <span class="attr">:model</span>=<span class="string">&quot;searchForm&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;formRef&quot;</span> <span class="attr">label-width</span>=<span class="string">&quot;80px&quot;</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">:gutter</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;8&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;用户名&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;searchForm.name&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入查询的用户名&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;8&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;真实姓名&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;searchForm.realname&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入查询的真实姓名&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;8&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;手机号码&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;searchForm.cellphone&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入查询的手机号码&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;8&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;状态&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-select</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-model</span>=<span class="string">&quot;searchForm.enable&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">placeholder</span>=<span class="string">&quot;请选择查询的状态&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">style</span>=<span class="string">&quot;width: 100%&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;启用&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">label</span>=<span class="string">&quot;禁用&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;8&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;创建时间&quot;</span> &gt;</span></span><br><span class="line">        <span class="comment">&lt;!--type=&quot;daterange&quot; 显示时间范围,有它选两个日期没它选一个--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-date-picker</span></span></span><br><span class="line"><span class="tag">          <span class="attr">v-model</span>=<span class="string">&quot;searchForm.createAt&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">type</span>=<span class="string">&quot;daterange&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">range-separator</span>=<span class="string">&quot;-&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">start-placeholder</span>=<span class="string">&quot;开始时间&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">end-placeholder</span>=<span class="string">&quot;结束时间&quot;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="查询和重置按钮布局"><a href="#查询和重置按钮布局" class="headerlink" title="查询和重置按钮布局"></a>查询和重置按钮布局</h3><p>放在user文件夹&#x2F;c-cpns文件夹&#x2F;user-search.vue中<br>组件&#x2F;Button按钮和icon小组件一起用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btns&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">icon</span>=<span class="string">&quot;Refresh&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleResetClick&quot;</span>&gt;</span>重置<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">icon</span>=<span class="string">&quot;Search&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleQueryClick&quot;</span>&gt;</span>查询<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>样式慢慢改</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.search</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.el-form-item</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">20px</span> <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.btns</span> &#123;</span><br><span class="line">    <span class="attribute">text-align</span>: right;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">50px</span> <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="selector-class">.el-button--primary</span> &#123;</span><br><span class="line">      <span class="attr">--el-button-bg-color</span>: rgb(98, 106, 239);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.el-button</span> &#123;</span><br><span class="line">      <span class="attribute">height</span>: <span class="number">36px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/postImgs/nievtcms/user2.png" alt="layout布局"></p>
<h3 id="重置功能实现"><a href="#重置功能实现" class="headerlink" title="重置功能实现"></a>重置功能实现</h3><p>在表单 组件中给每一个子表单添加prop属性，和searchForm中的名称对应，方便重置找到属性，比如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;8&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;用户名&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;searchForm.name&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入查询的用户名&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;8&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;手机号码&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;cellphone&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;searchForm.cellphone&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入查询的手机号码&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ElForm</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> searchForm = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">realname</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">cellphone</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">enable</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">createAt</span>: []</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重置操作</span></span><br><span class="line"><span class="keyword">const</span> formRef = ref&lt;<span class="title class_">InstanceType</span>&lt;<span class="keyword">typeof</span> <span class="title class_">ElForm</span>&gt;&gt;()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleResetClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  formRef.<span class="property">value</span>?.<span class="title function_">resetFields</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//查询操作（还没接后端接口）</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleQueryClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;handleQueryClick&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="element组件内容中文化"><a href="#element组件内容中文化" class="headerlink" title="element组件内容中文化"></a>element组件内容中文化</h3><p>在使用时间选择组件时，月份星期显示都为英文，想要把它改成中文<br>element-plus组件显示的英文变中文：<br>右上角指南&#x2F;左侧进阶&#x2F;国际化，我用的是下图代码<br><img src="/postImgs/nievtcms/%E4%B8%AD%E6%96%87%E5%8C%961.png" alt="改为中文"><br>在App.vue中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import router from &#x27;./router&#x27;</span><br><span class="line">import &#123; ElConfigProvider &#125; from &#x27;element-plus&#x27;</span><br><span class="line">import zhCn from &#x27;element-plus/es/locale/lang/zh-cn&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-config-provider :locale=&quot;zhCn&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;app&quot;&gt;</span><br><span class="line">      Hello小聂同学</span><br><span class="line">      &lt;!-- &lt;router-link to=&quot;/main&quot;&gt;去main页面&lt;/router-link&gt;--&gt;</span><br><span class="line">      &lt;router-link to=&quot;/login&quot;&gt;去login页面&lt;/router-link&gt;</span><br><span class="line">      &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/el-config-provider&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<p>成功，现在组件中默认英文的地方都变成了中文</p>
<h2 id="用户信息功能部分"><a href="#用户信息功能部分" class="headerlink" title="用户信息功能部分"></a>用户信息功能部分</h2><p>写在user文件夹&#x2F;c-cpns文件夹&#x2F;user-content.vue中<br>这里不光要展示服务器的用户列表，还会展示上面自查询返回的用户数据，所以不再是简单的数据，用Post请求</p>
<h3 id="获取用户列表"><a href="#获取用户列表" class="headerlink" title="获取用户列表"></a>获取用户列表</h3><ol>
<li>用户信息展示分为：<br>头部（说明列表，添加用户按钮+功能）<br>中间（展示用户数据列表）<br>底部（分页）</li>
<li>发送数据请求<br>发送数据请求放在store&#x2F;main&#x2F;system&#x2F;system.ts中，组件中调用<br>先看看是否能拿到数据<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; postUsersListData &#125; <span class="keyword">from</span> <span class="string">&#x27;@/service/main/system/system&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ISystemState</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./type&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useSystemStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;system&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: (): <span class="function"><span class="params">ISystemState</span> =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">usersList</span>: [],</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">postUsersListAction</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> usersListResult = <span class="keyword">await</span> <span class="title function_">postUsersListData</span>()</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(usersListResult)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useSystemStore</span><br></pre></td></tr></table></figure>
组件中调用，获取数据<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useSystemStore <span class="keyword">from</span> <span class="string">&#x27;@/store/main/system/system&#x27;</span></span><br><span class="line"><span class="comment">// 1.调用仓库的查询数据请求，发起action，请求usersList的数据</span></span><br><span class="line"><span class="keyword">const</span> systemStore = <span class="title function_">useSystemStore</span>()</span><br><span class="line">systemStore.<span class="title function_">postUsersListAction</span>()</span><br></pre></td></tr></table></figure>
看控制台，成功拿到用户数据<br><img src="/postImgs/nievtcms/user3.png" alt="获取数据成功"></li>
</ol>
<h3 id="表格展示数据"><a href="#表格展示数据" class="headerlink" title="表格展示数据"></a>表格展示数据</h3><p>把获取到的数据展示到页面列表中</p>
<ol>
<li>数据类型规范<br>控制台看到的后端数据是json格式，要把它转换成ts数据，还是用到之前的<code>json to ts</code>转换网址（直接搜就能用）<br>把转化后的的单独放到store&#x2F;main&#x2F;system&#x2F;types.ts中<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">IUser</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">realname</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">cellphone</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">enable</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">departmentId</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">roleId</span>: <span class="built_in">number</span></span><br><span class="line">  <span class="attr">createAt</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">updateAt</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ISystemState</span> &#123;</span><br><span class="line">  <span class="attr">usersList</span>: <span class="title class_">IUser</span>[]</span><br><span class="line">  <span class="attr">usersTotalCount</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>把数据放进仓库<br>store&#x2F;main&#x2F;system&#x2F;system.ts中,给刚获取到的数据.data再.data，控制台看，把目标数据存到仓库state里<br>数据的规范使用刚才<code>type.ts</code>文件中的数据类型<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; postUsersListData &#125; <span class="keyword">from</span> <span class="string">&#x27;@/service/main/system/system&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">ISystemState</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./type&#x27;</span><span class="comment">//类型规范</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useSystemStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;system&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: (): <span class="function"><span class="params">ISystemState</span> =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">usersList</span>: [],</span><br><span class="line">    <span class="attr">usersTotalCount</span>: <span class="number">0</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">postUsersListAction</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> usersListResult = <span class="keyword">await</span> <span class="title function_">postUsersListData</span>()</span><br><span class="line">      <span class="comment">//console.log(usersListResult)</span></span><br><span class="line">      <span class="comment">// console.log(&#x27;usersListResult.data&#x27;, usersListResult.data)</span></span><br><span class="line">      <span class="comment">// console.log(usersListResult.data.data)</span></span><br><span class="line">      <span class="comment">//console.log(usersListResult.data.data.list)</span></span><br><span class="line">      <span class="keyword">const</span> &#123; totalCount, list &#125; = usersListResult.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">usersTotalCount</span> = totalCount</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">usersList</span> = list</span><br><span class="line">      <span class="comment">//console.log(this.usersTotalCount)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useSystemStore</span><br></pre></td></tr></table></figure></li>
<li>组件展示数据<br>user-content.vue中获取把仓库的数据放到表格中<br>表格还是用组件element-plus&#x2F;Datas数据展示&#x2F;Table表格&#x2F;带边框表格<br>仔细读代码：<br>组件表格中的数据使用<code>:data=&quot;tableData&quot;</code>填充，用prop属性和data中的数据绑定，width属性指定这一列的宽度，如果没有规定宽度，那么没有规定宽度的列会平均分配剩下的宽度<br>布置好组件表格<code>:data=&quot;usersList&quot;</code>，ts中<code>const &#123; usersList &#125; = storeToRefs(systemStore)</code>展示数据</li>
<li>添加多选框列和序号列<br>多选功能在组件库中也有，还是Table表格&#x2F;多选，把代表多选框的列拿进代码<br><code>&lt;el-table-column type=&quot;selection&quot; width=&quot;50px&quot; /&gt;</code><br>序号列也从组件库找，找有序号的表格，把列那一行放进来<code>&lt;el-table-column type=&quot;index&quot; label=&quot;序号&quot; width=&quot;60px&quot; /&gt;</code></li>
<li>表格最后一列的删除和编辑按钮<br>组件&#x2F;button按钮，两个按钮放进最后一列<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">label</span>=<span class="string">&quot;操作&quot;</span> <span class="attr">width</span>=<span class="string">&quot;150px&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;Edit&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">text</span>&gt;</span> 编辑 <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">icon</span>=<span class="string">&quot;Delete&quot;</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> <span class="attr">text</span>&gt;</span> 删除 <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>目前完整代码展示<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;content&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">      &lt;h3 class=&quot;title&quot;&gt;用户列表&lt;/h3&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot;&gt;新建用户&lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;table&quot;&gt;</span><br><span class="line">      &lt;el-table :data=&quot;usersList&quot; border style=&quot;width: 100%&quot;&gt;</span><br><span class="line">        &lt;el-table-column align=&quot;center&quot; type=&quot;selection&quot; width=&quot;50px&quot; /&gt;</span><br><span class="line">        &lt;el-table-column align=&quot;center&quot; type=&quot;index&quot; label=&quot;序号&quot; width=&quot;60px&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-table-column align=&quot;center&quot; label=&quot;用户名&quot; prop=&quot;name&quot; width=&quot;150px&quot; /&gt;</span><br><span class="line">        &lt;el-table-column align=&quot;center&quot; label=&quot;真实姓名&quot; prop=&quot;realname&quot; width=&quot;150px&quot; /&gt;</span><br><span class="line">        &lt;el-table-column align=&quot;center&quot; label=&quot;手机号码&quot; prop=&quot;cellphone&quot; width=&quot;150px&quot; /&gt;</span><br><span class="line">        &lt;el-table-column align=&quot;center&quot; label=&quot;状态&quot; prop=&quot;enable&quot; width=&quot;100px&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-table-column align=&quot;center&quot; label=&quot;创建时间&quot; prop=&quot;createAt&quot; /&gt;</span><br><span class="line">        &lt;el-table-column align=&quot;center&quot; label=&quot;更新时间&quot; prop=&quot;updateAt&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-table-column align=&quot;center&quot; label=&quot;操作&quot; width=&quot;150px&quot;&gt;</span><br><span class="line">          &lt;el-button size=&quot;small&quot; icon=&quot;Edit&quot; type=&quot;primary&quot; text&gt; 编辑 &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button size=&quot;small&quot; icon=&quot;Delete&quot; type=&quot;danger&quot; text&gt; 删除 &lt;/el-button&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line">      &lt;/el-table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;pagination&quot;&gt;分页&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; storeToRefs &#125; from &#x27;pinia&#x27;</span><br><span class="line">import useSystemStore from &#x27;@/store/main/system/system&#x27;</span><br><span class="line"></span><br><span class="line">// 1.调用仓库的查询数据请求，发起action，请求usersList的数据</span><br><span class="line">const systemStore = useSystemStore()</span><br><span class="line">systemStore.postUsersListAction()</span><br><span class="line"></span><br><span class="line">// 2.获取usersList数据,进行展示</span><br><span class="line">const &#123; usersList &#125; = storeToRefs(systemStore)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
完成，效果如下图<br><img src="/postImgs/nievtcms/user4.png" alt="用户信息展示"></li>
</ol>
<h3 id="处理数据–状态列"><a href="#处理数据–状态列" class="headerlink" title="处理数据–状态列"></a>处理数据–状态列</h3><p>根据后端返回的值自定义展示数据：<br>比如后端返回的状态是1或0，期望状态列是具体的汉字表述而不是数字，那么要<strong>使用插槽</strong>自定义展示数据<br>先拿到数据然后用作用域插槽把数据放进去</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">label</span>=<span class="string">&quot;状态&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;enable&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100px&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 作用域插槽，原来只有上面，下面新增 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">      <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:type</span>=<span class="string">&quot;scope.row.enable ? &#x27;primary&#x27; : &#x27;danger&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">plain</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      &#123;&#123; scope.row.enable ? &#x27;启用&#x27; : &#x27;禁用&#x27; &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="处理数据–时间列"><a href="#处理数据–时间列" class="headerlink" title="处理数据–时间列"></a>处理数据–时间列</h3><p>时间格式化进行展示<br>Day.js库<code> pnpm add dayjs</code><br>utils文件夹建format.ts文件，定义时间格式化方法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> utc <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/utc&#x27;</span></span><br><span class="line"><span class="comment">// 上面这两行导入虽然爆红，但是不影响，时间已经被格式化了</span></span><br><span class="line">dayjs.<span class="title function_">extend</span>(utc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">formatUTC</span>(<span class="params"><span class="attr">utcString</span>: <span class="built_in">string</span>, <span class="attr">format</span>: <span class="built_in">string</span> = <span class="string">&#x27;YYYY/MM/DD HH:mm:ss&#x27;</span></span>) &#123;</span><br><span class="line">  <span class="comment">// 默认格式化后的时间是零时区，东八区要.utcOffset(8)加八个小时</span></span><br><span class="line">  <span class="comment">//也可以在形参上不规定 format: string = &#x27;YYYY/MM/DD HH:mm:ss&#x27;</span></span><br><span class="line">  <span class="comment">//在下面.format(&#x27;YYYY/MM/DD HH:mm:ss&#x27;)</span></span><br><span class="line">  <span class="comment">//现在的写法更优雅，上面注释掉的更顺着思路</span></span><br><span class="line">  <span class="keyword">const</span> resultTime = dayjs.<span class="title function_">utc</span>(utcString).<span class="title function_">utcOffset</span>(<span class="number">8</span>).<span class="title function_">format</span>(format)</span><br><span class="line">  <span class="keyword">return</span> resultTime</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>组件中导入<code>import &#123; formatUTC &#125; from &#39;@/utils/format&#39;</code>并使用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">label</span>=<span class="string">&quot;创建时间&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;createAt&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123; formatUTC(scope.row.createAt) &#125;&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">label</span>=<span class="string">&quot;更新时间&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;updateAt&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123; formatUTC(scope.row.updateAt) &#125;&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>完成，效果如下图<br><img src="/postImgs/nievtcms/user5.png" alt="数据处理"></p>
<h2 id="底部分页器功能部分（重难点）"><a href="#底部分页器功能部分（重难点）" class="headerlink" title="底部分页器功能部分（重难点）"></a>底部分页器功能部分（重难点）</h2><p>很常见的功能，刚学的时候很费劲，后面仔细看下面的代码和注解，应该能豁然开朗</p>
<ol>
<li>引入组件<br>还是组件库找分页组件，数据展示&#x2F;分页里面找组件代码放进去，读代码，修改，最终：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pagination&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-pagination</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model:current-page</span>=<span class="string">&quot;currentPage&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model:page-size</span>=<span class="string">&quot;pageSize&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:page-sizes</span>=<span class="string">&quot;[10, 20]&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">layout</span>=<span class="string">&quot;total, sizes, prev, pager, next, jumper&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">:total</span>=<span class="string">&quot;usersTotalCount&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">size-change</span>=<span class="string">&quot;handleSizeChange&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">current-change</span>=<span class="string">&quot;handleCurrentChange&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>查询用户列表post请求要增加查询信息queryInfo参数<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">postUsersListData</span>(<span class="params"><span class="attr">queryInfo</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> hyRequest.<span class="title function_">post</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/users/list&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: queryInfo</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>仓库接收用户信息，调用了postUsersListData()，要对应着给它加形参<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">postUsersListAction</span>(<span class="params"><span class="attr">queryInfo</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> usersListResult = <span class="keyword">await</span> <span class="title function_">postUsersListData</span>(queryInfo)</span><br><span class="line">  <span class="keyword">const</span> &#123; totalCount, list &#125; = usersListResult.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">usersTotalCount</span> = totalCount</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">usersList</span> = list</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>页面调用仓库中的方法时同样要传递参数，封装网络请求函数<br>现在一进页面要查询数据，分页数量变要查询，页码变要查询，总查询，所以给查询请求封装一个函数进行网络请求<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fetchUserListData</span>(<span class="params"><span class="attr">formData</span>: <span class="built_in">any</span> = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// size每页的数据数</span></span><br><span class="line">  <span class="keyword">const</span> size = pageSize.<span class="property">value</span></span><br><span class="line">  <span class="comment">//offset偏移量，第一页偏移0条数据，第二页偏移第一页展示的数据量以此类推</span></span><br><span class="line">  <span class="keyword">const</span> offset = (currentPage.<span class="property">value</span> - <span class="number">1</span>) * size</span><br><span class="line">  <span class="comment">//这两个参数都是接口文档规定的要传的参数</span></span><br><span class="line">  <span class="keyword">const</span> pageInfo = &#123; size, offset &#125;</span><br><span class="line">  <span class="comment">// 2.发送网络请求</span></span><br><span class="line">  systemStore.<span class="title function_">postUsersListAction</span>(pageInfo)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
功能实现，如下图<br><img src="/postImgs/nievtcms/user5.png" alt="底部分页器功能"></li>
</ol>
<h3 id="条件查询数据"><a href="#条件查询数据" class="headerlink" title="条件查询数据"></a>条件查询数据</h3><p>要实现条件查询获取数据再展示，<strong>查询的组件</strong>和<strong>展示数据的组件</strong>是兄弟关系，他们之间要通信借助父组件user.vue</p>
<blockquote>
<p>事件总线为什么不用<br>事件总线虽然能实现，但是数据也可能被别处获取使用，可能变得不可控<br>事件总线一般用于跨度大远距离的组件通信，现在是兄弟组件，距离不远，可以借助父组件，没必要用 </p>
</blockquote>
<ol>
<li>查询子组件向父组件传递数据<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发送给父组件，定义自定义事件</span></span><br><span class="line"><span class="keyword">const</span> emit = <span class="title function_">defineEmits</span>([<span class="string">&#x27;queryClick&#x27;</span>, <span class="string">&#x27;resetClick&#x27;</span>])</span><br><span class="line"><span class="keyword">const</span> searchForm = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">realname</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">cellphone</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">enable</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">createAt</span>: []</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//查询</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleQueryClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//console.log(&#x27;searchForm&#x27;, searchForm)</span></span><br><span class="line">  <span class="title function_">emit</span>(<span class="string">&#x27;queryClick&#x27;</span>, searchForm)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>父组件接收子组件传递的数据<br><code> &lt;user-search @query-click=&quot;handleQueryClick&quot; @reset-click=&quot;handleResetClick&quot; /&gt;</code></li>
<li>父组件要用content子组件的方法，需要content组件提供方法并暴露<br>content.vue<br>原来的fetchUserListData()方法要完善，不光要携带页码和分页两个参数，还要包含查询组件传过来的参数<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义事件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fetchUserListData</span>(<span class="params"><span class="attr">formData</span>: <span class="built_in">any</span> = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// size每页的数据数</span></span><br><span class="line">  <span class="keyword">const</span> size = pageSize.<span class="property">value</span></span><br><span class="line">  <span class="comment">//offset偏移量，第一页偏移0条数据，第二页偏移第一页展示的数据量以此类推</span></span><br><span class="line">  <span class="keyword">const</span> offset = (currentPage.<span class="property">value</span> - <span class="number">1</span>) * size</span><br><span class="line">  <span class="keyword">const</span> pageInfo = &#123; size, offset &#125;</span><br><span class="line">  <span class="comment">//queryInfo把两部分要传的参数综合起来</span></span><br><span class="line">  <span class="keyword">const</span> queryInfo = &#123; ...pageInfo, ...formData  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;queryInfo&#x27;</span>, queryInfo)</span><br><span class="line">  <span class="comment">// 发起网络请求</span></span><br><span class="line">  systemStore.<span class="title function_">postUsersListAction</span>(queryInfo)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//把这个方法暴露出去才能让父组件调用</span></span><br><span class="line"><span class="title function_">defineExpose</span>(&#123; fetchUserListData &#125;)</span><br></pre></td></tr></table></figure></li>
<li>父组件调用content子组件的方法<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先拿到content组件，再对content组件操作</span></span><br><span class="line"><span class="keyword">const</span> contentRef = ref&lt;<span class="title class_">InstanceType</span>&lt;<span class="keyword">typeof</span> <span class="title class_">UserContent</span>&gt;&gt;()</span><br><span class="line"><span class="comment">//把search传递的formData传给content组件的fetchUserListData()方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleQueryClick</span>(<span class="params"><span class="attr">formData</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;user.vue的formData&#x27;</span>, formData)</span><br><span class="line">  contentRef.<span class="property">value</span>?.<span class="title function_">fetchUserListData</span>(formData)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>跑一下，但是报错了呢<br><img src="/postImgs/nievtcms/error5.png" alt="条件查询"><br><img src="/postImgs/nievtcms/error6.png" alt="error"><br>为什么呢，打印的数据都正确，<br>我想条件查询用户名含有<code>o</code>的用户，手动固定参数查询试试看<br><code>fetchUserListData(formData: any = &#123;&#125;) </code>方法中的<br><code>const queryInfo = &#123; ...pageInfo, ...formData &#125;</code><br>我改成<code>const queryInfo = &#123; ...pageInfo, name: &#39;o&#39; &#125;</code><br>刷新页面，成功展示了所有带o的用户信息，看来问题出现在<code>...formData</code>这个参数上<br><img src="/postImgs/nievtcms/error7.png" alt="error"><br>找到问题了，在查询表单默认数据这里<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> searchForm = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">realname</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">cellphone</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">enable</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="comment">//createAt: [] 开始是这样，会出错，服务器会认为没有和空数组匹配的项，都不符合，不会返回数据，改成下面的空字符串就好了</span></span><br><span class="line">  <span class="attr">createAt</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
再试，成功<img src="/postImgs/nievtcms/error8.png" alt="error"></li>
</ol>
<h3 id="重置查询条件"><a href="#重置查询条件" class="headerlink" title="重置查询条件"></a>重置查询条件</h3><p>点击重置按钮不光要情况查询表单，还要让用户列表清单回到默认展示的效果，所以也需要触发兄弟组件的获取数据方法，和查询数据很多重复部分不重复记了</p>
<ol>
<li>查询组件 <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> emit = <span class="title function_">defineEmits</span>([<span class="string">&#x27;resetClick&#x27;</span>])</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleQueryClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;searchForm&#x27;</span>, searchForm)</span><br><span class="line">  <span class="title function_">emit</span>(<span class="string">&#x27;queryClick&#x27;</span>, searchForm)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>父组件<br><code>&lt;user-search @query-click=&quot;handleQueryClick&quot; @reset-click=&quot;handleResetClick&quot; /&gt;</code><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//重置操作</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleResetClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  contentRef.<span class="property">value</span>?.<span class="title function_">fetchUserListData</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="删除用户部分"><a href="#删除用户部分" class="headerlink" title="删除用户部分"></a>删除用户部分</h2><h3 id="插槽获取ID"><a href="#插槽获取ID" class="headerlink" title="插槽获取ID"></a>插槽获取ID</h3><p>先要知道点击的是那条数据的删除，要拿到数据的ID，用作用域插槽</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">             <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">icon</span>=<span class="string">&quot;Delete&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">text</span></span></span><br><span class="line"><span class="tag">             @<span class="attr">click</span>=<span class="string">&quot;handleDeleteBtnClick(scope.row.id)&quot;</span></span></span><br><span class="line"><span class="tag">           &gt;</span></span><br><span class="line">             删除</span><br><span class="line">           <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="delete请求"><a href="#delete请求" class="headerlink" title="delete请求"></a>delete请求</h3><p>后端接口文档这个是delete请求<br>service&#x2F;main&#x2F;sysystem&#x2F;system.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deleteUserById</span>(<span class="params"><span class="attr">id</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> hyRequest.<span class="title function_">delete</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/users/<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>store&#x2F;main&#x2F;system&#x2F;system.ts封装发送请求</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除用户数据请求</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">deleteUserByIdAction</span>(<span class="params"><span class="attr">id</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="comment">//调用service删除接口，记得先导入</span></span><br><span class="line">  <span class="keyword">const</span> deleteResult = <span class="keyword">await</span> <span class="title function_">deleteUserById</span>(id)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(deleteResult)</span><br><span class="line">  <span class="comment">// 删除后要重新请求新的数据，获取获取第一页数据</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">postUsersListAction</span>(&#123; <span class="attr">offset</span>: <span class="number">0</span>, <span class="attr">size</span>: <span class="number">10</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>组件调用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleDeleteBtnClick</span>(<span class="params"><span class="attr">id</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;触发ID&#x27;</span>, id)</span><br><span class="line">  systemStore.<span class="title function_">deleteUserByIdAction</span>(id)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>成功，截图如下<br><img src="/postImgs/nievtcms/user7.png" alt="删除成功"></p>
<h2 id="新建用户"><a href="#新建用户" class="headerlink" title="新建用户"></a>新建用户</h2><h3 id="弹出弹窗"><a href="#弹出弹窗" class="headerlink" title="弹出弹窗"></a>弹出弹窗</h3><p>新建会出现一个弹窗，这个弹窗编辑用户也能用，逻辑也很多，单独封装一个组件c&#x3D;cpns&#x2F;user-modal.vue<br>弹出的对话框从element组件里找，反馈组件&#x2F;对话框放进去，对话框内容部分换成表单，script里定义初始值<br>modal组件中添加显示表单与否方法，暴露出去，让父组件调用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dialogVisible = <span class="title function_">ref</span>(<span class="literal">false</span>)<span class="comment">//默认看不见，父组件调用再看见</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setModalVisible</span>(<span class="params"></span>)&#123;</span><br><span class="line">  dialogVisible.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">defineExpose</span>(&#123; setModalVisible &#125;)</span><br></pre></td></tr></table></figure>
<p>content.vue<br>给按钮添加点击事件，点击按钮触发事件发送求给父组件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> emit = <span class="title function_">defineEmits</span>([<span class="string">&#x27;newClick&#x27;</span>])</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleNewUserClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">emit</span>(<span class="string">&#x27;newClick&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>user.vue<br><code>&lt;user-content ref=&quot;contentRef&quot; @new-click=&quot;handleNewClick&quot; /&gt;</code></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> modalRef = ref&lt;<span class="title class_">InstanceType</span>&lt;<span class="keyword">typeof</span> <span class="title class_">UserModal</span>&gt;&gt;()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleNewClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  modalRef.<span class="property">value</span>?.<span class="title function_">setModalVisible</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="完善对话框–选项请求"><a href="#完善对话框–选项请求" class="headerlink" title="完善对话框–选项请求"></a>完善对话框–选项请求</h3><p>类似查询表单，这里也放表达，<br><code>选择用户角色</code>和<code>选择部门</code>的选项应该来自服务器</p>
<ol>
<li><p>创建请求方法<br>这个请求不应该属于单独的页面，多个地方都可能用这个请求，单独放一个文件service&#x2F;main&#x2F;建main.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hyRequest <span class="keyword">from</span> <span class="string">&#x27;..&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取所有用户角色</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getEntireRoles</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> hyRequest.<span class="title function_">post</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/role/list&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//获取所有部门信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getEntireDepartments</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> hyRequest.<span class="title function_">post</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/department/list&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>封装请求<br>放在store&#x2F;main&#x2F;main.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getEntireDepartments, getEntireRoles &#125; <span class="keyword">from</span> <span class="string">&#x27;@/service/main/main&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="comment">//获取用户角色和部门类别应该再用户登录后就发送请求获取信息</span></span><br><span class="line"><span class="comment">//记得在store/login中添加调用请求的代码</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IMainState</span> &#123;</span><br><span class="line">  <span class="attr">entireRoles</span>: <span class="built_in">any</span>[]</span><br><span class="line">  <span class="attr">entireDepartments</span>: <span class="built_in">any</span>[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useMainStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;main&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: (): <span class="function"><span class="params">IMainState</span> =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">entireRoles</span>: [],</span><br><span class="line">    <span class="attr">entireDepartments</span>: []</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">fetchEntireDataAction</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> rolesResult = <span class="keyword">await</span> <span class="title function_">getEntireRoles</span>()</span><br><span class="line">      <span class="keyword">const</span> departmentsResult = <span class="keyword">await</span> <span class="title function_">getEntireDepartments</span>()</span><br><span class="line">      <span class="comment">//console.log(&#x27;rolesResult&#x27;, rolesResult)</span></span><br><span class="line">      <span class="comment">//console.log(&#x27;departmentsResult&#x27;, departmentsResult)</span></span><br><span class="line">      <span class="comment">// 保存数据</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">entireRoles</span> = rolesResult.<span class="property">data</span>.<span class="property">data</span>.<span class="property">list</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">entireDepartments</span> = departmentsResult.<span class="property">data</span>.<span class="property">data</span>.<span class="property">list</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useMainStore</span><br></pre></td></tr></table></figure>
</li>
<li><p>登录时调用，刷新时再调用<br>不缓存因为要最新的更好一i点<br>store&#x2F;login&#x2F;login.ts的登录方法和刷新方法中都添加</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//8.请求所有roles/departments数据</span></span><br><span class="line"> <span class="keyword">const</span> mainStore = <span class="title function_">useMainStore</span>()</span><br><span class="line"> mainStore.<span class="title function_">fetchEntireDataAction</span>()</span><br></pre></td></tr></table></figure></li>
<li><p>对话框展示信息</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;选择角色&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;roleId&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.roleId&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择角色&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;item in entireRoles&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">:label</span>=<span class="string">&quot;item.name&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;item.id&quot;</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;选择部门&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;departmentId&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">&quot;formData.departmentId&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请选择部门&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;item in entireDepartments&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-option</span> <span class="attr">:label</span>=<span class="string">&quot;item.name&quot;</span> <span class="attr">:value</span>=<span class="string">&quot;item.id&quot;</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.获取roles/departments数据</span></span><br><span class="line"><span class="keyword">const</span> mainStore = <span class="title function_">useMainStore</span>()</span><br><span class="line"><span class="keyword">const</span> systemStore = <span class="title function_">useSystemStore</span>()</span><br><span class="line"><span class="keyword">const</span> &#123; entireRoles, entireDepartments &#125; = <span class="title function_">storeToRefs</span>(mainStore)</span><br></pre></td></tr></table></figure></li>
<li><p>成功截图<br><img src="/postImgs/nievtcms/user8.png" alt="获取用户角色和部门信息成功"></p>
</li>
</ol>
<h3 id="发送请求"><a href="#发送请求" class="headerlink" title="发送请求"></a>发送请求</h3><p>填表测试，数据有被拿到<br><img src="/postImgs/nievtcms/user9.png" alt="获取用户角色和部门信息成功"><br>service&#x2F;system.ts</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">newUserData</span>(<span class="params"><span class="attr">userInfo</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> hyRequest.<span class="title function_">post</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/users&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: userInfo</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>store，还是记得要导入newUserData</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">newUserDataAction</span>(<span class="params"><span class="attr">userInfo</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="comment">//发送简历新用户请求</span></span><br><span class="line">  <span class="keyword">const</span> newResult = <span class="keyword">await</span> <span class="title function_">newUserData</span>(userInfo)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(newResult)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重新获取数据</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">postUsersListAction</span>(&#123; <span class="attr">offset</span>: <span class="number">0</span>, <span class="attr">size</span>: <span class="number">10</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>组件中调用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击确定新建</span></span><br><span class="line"><span class="keyword">const</span> systemStore = <span class="title function_">useSystemStore</span>()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleConfirmClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  dialogVisible.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">    systemStore.<span class="title function_">newUserDataAction</span>(formData)</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>新增两条用户数据成功，截图如下<br><img src="/postImgs/nievtcms/user10.png" alt="新增用成功"></p>
<h2 id="编辑用户"><a href="#编辑用户" class="headerlink" title="编辑用户"></a>编辑用户</h2><p>对话框组件，根据父传过来的参数显示title</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-dialog</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-model</span>=<span class="string">&quot;dialogVisible&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:title</span>=<span class="string">&quot;isNewRef ? &#x27;新建用户&#x27; : &#x27;编辑用户&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">width</span>=<span class="string">&quot;30%&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">center</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br></pre></td></tr></table></figure>
<p>如果是编辑把原有数据添加进表单中</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 表单加载</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setModalVisible</span>(<span class="params"><span class="attr">isNew</span>: <span class="built_in">boolean</span> = <span class="literal">true</span>, itemData?: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  dialogVisible.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">  isNewRef.<span class="property">value</span> = isNew</span><br><span class="line">  <span class="keyword">if</span> (!isNew &amp;&amp; itemData) &#123;</span><br><span class="line">    <span class="comment">// 编辑数据</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> formData) &#123;</span><br><span class="line">      formData[key] = itemData[key]</span><br><span class="line">    &#125;</span><br><span class="line">    editData.<span class="property">value</span> = itemData</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 新建数据</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> formData) &#123;</span><br><span class="line">      formData[key] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    editData.<span class="property">value</span> = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>service,store,兄弟通信和前面大差不大，不赘述了<br>编辑成功截图（手机号码目前没修改成功）：<br><img src="/postImgs/nievtcms/user11.png" alt="编辑用户成功"><br><img src="/postImgs/nievtcms/user12.png" alt="编辑用户成功"></p>
<h1 id="封装用可复用的网路请求"><a href="#封装用可复用的网路请求" class="headerlink" title="封装用可复用的网路请求"></a>封装用可复用的网路请求</h1><p>其他页面的功能都和上面实现的用户功能相似，信息的增删查改<br>网络请求大致三个部分：页面触发增删查改；store封装请求；service发送请求<br>封装思路：<br>页面把页面的pageName和要做的增删查改操作发送给store，service再接收store传过来的pageName，拼接url发送请求<br>（如果接口不工整，前端应该手动封装工具把接口变得规整再实现复用）</p>
<h2 id="网络请求复用—部门管理查询部分为例"><a href="#网络请求复用—部门管理查询部分为例" class="headerlink" title="网络请求复用—部门管理查询部分为例"></a>网络请求复用—部门管理查询部分为例</h2><p><strong>先不复用，靠cv用户管理页面+手动修改实现了这部分的所有功能，然后再修改search部分代码实现可复用的代码</strong></p>
<ol>
<li>命名统一<br>看接口和页面名称，是统一工整的，那么就好操作了（如果接口不工整，前端应该手动封装工具把接口变得规整再实现复用）</li>
<li>service用pageName拼接地址<br>原来的url类似<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deleteUserById</span>(<span class="params"><span class="attr">id</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> hyRequest.<span class="title function_">delete</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/users/<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">  &#125;)&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">editUserData</span>(<span class="params"><span class="attr">id</span>: <span class="built_in">number</span>, <span class="attr">userInfo</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> hyRequest.<span class="title function_">patch</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/users/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">data</span>: userInfo</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
现在封装成下面这种<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">postPageListData</span>(<span class="params"><span class="attr">pageName</span>: <span class="built_in">string</span>, <span class="attr">queryInfo</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> hyRequest.<span class="title function_">post</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/<span class="subst">$&#123;pageName&#125;</span>/list`</span>,</span><br><span class="line">    <span class="attr">data</span>: queryInfo</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deletePageById</span>(<span class="params"><span class="attr">pageName</span>: <span class="built_in">string</span>, <span class="attr">id</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> hyRequest.<span class="title function_">delete</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/<span class="subst">$&#123;pageName&#125;</span>/<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>store封装请求<br>对应store的接收和发送也添加pageName，以查找和修改为例<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查找数据</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">postPageListAction</span>(<span class="params"><span class="attr">pageName</span>: <span class="built_in">string</span>, <span class="attr">queryInfo</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> pageListResult = <span class="keyword">await</span> <span class="title function_">postPageListData</span>(pageName, queryInfo)</span><br><span class="line">  <span class="keyword">const</span> &#123; totalCount, list &#125; = pageListResult.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">pageList</span> = list</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">pageTotalCount</span> = totalCount</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//编辑数据</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">editPageDataAction</span>(<span class="params"><span class="attr">pageName</span>: <span class="built_in">string</span>, <span class="attr">id</span>: <span class="built_in">number</span>, <span class="attr">pageInfo</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> editResult = <span class="keyword">await</span> <span class="title function_">editPageData</span>(pageName, id, pageInfo)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;editResult&#x27;</span>, editResult)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">postPageListAction</span>(pageName, &#123; <span class="attr">offset</span>: <span class="number">0</span>, <span class="attr">size</span>: <span class="number">10</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>组件发送pageName<br>通过config.ts传递pageName属性，发送请求带着它<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">const</span> queryInfo = &#123; ...pageInfo, ...formData &#125;</span><br><span class="line">  systemStore.<span class="title function_">postPageListAction</span>(pageName, queryInfo)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 5.删除/新建/编辑的操作</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleDeleteBtnClick</span>(<span class="params"><span class="attr">id</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  systemStore.<span class="title function_">deletePageByIdAction</span>(pageName, id)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>实现截图：新增部门成功<br><img src="/postImgs/nievtcms/user13.png" alt="新增部门成功"></li>
</ol>
<h2 id="网络请求复用–content部分"><a href="#网络请求复用–content部分" class="headerlink" title="网络请求复用–content部分"></a>网络请求复用–content部分</h2><p>前面以及把service和store改成了复用的部分，content部分网络请求复用只需要把写死的页面名变成config.ts中的pageName属性传入组件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//发送网络请求</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fetchPageListData</span>(<span class="params"><span class="attr">formData</span>: <span class="built_in">any</span> = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// 1.获取offset/size</span></span><br><span class="line">  <span class="keyword">const</span> size = pageSize.<span class="property">value</span></span><br><span class="line">  <span class="keyword">const</span> offset = (currentPage.<span class="property">value</span> - <span class="number">1</span>) * size</span><br><span class="line">  <span class="keyword">const</span> pageInfo = &#123; size, offset &#125;</span><br><span class="line">  <span class="keyword">const</span> queryInfo = &#123; ...pageInfo, ...formData &#125;</span><br><span class="line">  systemStore.<span class="title function_">postPageListAction</span>(props.<span class="property">contentConfig</span>.<span class="property">pageName</span>, queryInfo)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除/新建/编辑的操作</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleDeleteBtnClick</span>(<span class="params"><span class="attr">id</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  systemStore.<span class="title function_">deletePageByIdAction</span>(props.<span class="property">contentConfig</span>.<span class="property">pageName</span>, id)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>复用成功<br><img src="/postImgs/nievtcms/fuyong10.png" alt="修改代码"><br>（补充：在对页面进行新建和编辑操作之后，应该重新获取完整的信息）</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//重新获取完整的数据</span></span><br><span class="line">  <span class="keyword">const</span> mainStore = <span class="title function_">useMainStore</span>()</span><br><span class="line">  mainStore.<span class="title function_">fetchEntireDataAction</span>()</span><br></pre></td></tr></table></figure>
<h1 id="封装可复用的高阶组件快速搭建页面"><a href="#封装可复用的高阶组件快速搭建页面" class="headerlink" title="封装可复用的高阶组件快速搭建页面"></a>封装可复用的高阶组件快速搭建页面</h1><p>其他页面的和用户管理页面很相似，除了数据不同，要展示的样式都是上面搜索清单，下面展示信息表格，为了避免代码的重复和每一个新页面修改很多<br>写一个配置文件，封装一个可复用的页面，快速搭建页面<br>这些封装好的组件后来都放到了components文件夹下用文件夹包了起来</p>
<h2 id="search部分复用—部门管理为例"><a href="#search部分复用—部门管理为例" class="headerlink" title="search部分复用—部门管理为例"></a>search部分复用—部门管理为例</h2><p><strong>先不复用，靠cv用户管理页面+手动修改实现了这部分的所有功能，然后再修改search部分代码实现可复用的代码</strong></p>
<ol>
<li>建立专门针对页面的search部分进行配置的文件<br>部门管理内容在department文件夹中，在里面建config文件夹&#x2F;search.config.ts文件<br>先简单写数据，比如<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> searchConfig = &#123;</span><br><span class="line">  <span class="attr">xxx</span>:<span class="string">&quot;Nie&quot;</span></span><br><span class="line">  <span class="attr">yyy</span>:<span class="number">123</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> searchConfig</span><br></pre></td></tr></table></figure></li>
<li>在这部分页面的父组件department.vue中引入并传给search组件<br><code>import searchConfig from &#39;./config/search.config</code><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">page-search</span></span></span><br><span class="line"><span class="tag">  <span class="attr">:search-config</span>=<span class="string">&quot;searchConfig&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">query-click</span>=<span class="string">&quot;handleQueryClick&quot;</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">reset-click</span>=<span class="string">&quot;handleResetClick&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>在search组件接收，<strong>注意写法</strong><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IProps</span> &#123;</span><br><span class="line">  <span class="attr">searchConfig</span>:&#123;</span><br><span class="line">    <span class="comment">// 对象里的属性和config文件里的属性对应</span></span><br><span class="line">    <span class="attr">xxx</span>:<span class="built_in">string</span></span><br><span class="line">    <span class="attr">yyy</span>:<span class="built_in">number</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//这样指定props里包含一个searchConfig，和它对应的类型</span></span><br><span class="line"><span class="keyword">const</span> props = defineProps&lt;<span class="title class_">IProps</span>&gt;(&#123;&#125;)</span><br></pre></td></tr></table></figure></li>
<li>修改config内容成目标内容<br>观察搜索部分，想要动态展示的数据formItems是数组，把不确定的动态的东西放进数组里，比如下图的这种数据，让它自动生成<br><img src="/postImgs/nievtcms/fuyong1.png" alt="修改代码"><br>search.config.ts<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> searchConfig = &#123;</span><br><span class="line">  <span class="attr">formItems</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//这里增加类型因为不止有input类型，可能还有日期选择等</span></span><br><span class="line">      <span class="attr">prop</span>: <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;input&#x27;</span>,</span><br><span class="line">      <span class="attr">label</span>: <span class="string">&#x27;部门名称&#x27;</span>,</span><br><span class="line">      <span class="attr">placeholder</span>: <span class="string">&#x27;请输入查询的部门名称&#x27;</span>,</span><br><span class="line">      <span class="attr">initialValue</span>: <span class="string">&#x27;我是默认填进去的值&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;input&#x27;</span>,</span><br><span class="line">      <span class="attr">prop</span>: <span class="string">&#x27;leader&#x27;</span>,</span><br><span class="line">      <span class="attr">label</span>: <span class="string">&#x27;部门领导&#x27;</span>,</span><br><span class="line">      <span class="attr">placeholder</span>: <span class="string">&#x27;请输入查询的领导名称&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;date-picker&#x27;</span>,</span><br><span class="line">      <span class="attr">prop</span>: <span class="string">&#x27;createAt&#x27;</span>,</span><br><span class="line">      <span class="attr">label</span>: <span class="string">&#x27;创建时间&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> searchConfig</span><br></pre></td></tr></table></figure></li>
<li>search组件表单中获取数据<br>原来空架子<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form</span> <span class="attr">:model</span>=<span class="string">&quot;searchForm&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;formRef&quot;</span> <span class="attr">label-width</span>=<span class="string">&quot;80px&quot;</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">:gutter</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form</span> <span class="attr">:model</span>=<span class="string">&quot;searchForm&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;formRef&quot;</span> <span class="attr">label-width</span>=<span class="string">&quot;80px&quot;</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">:gutter</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;item in searchConfig.formItems&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.prop&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 这个span也能抽出去设置宽度 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">:label</span>=<span class="string">&quot;item.label&quot;</span> <span class="attr">:prop</span>=<span class="string">&quot;item.prop&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 这里不一定都是imput，用动态组件或者template+if判断</span></span><br><span class="line"><span class="comment">           我觉得动态组件拼接有些难，用后者 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;item.type === &#x27;input&#x27;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;searchForm[item.prop]&quot;</span> <span class="attr">:placeholder</span>=<span class="string">&quot;item.placeholder&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- type一共没几种，多写写 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;item.type === &#x27;date-picker&#x27;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-date-picker</span></span></span><br><span class="line"><span class="tag">              <span class="attr">v-model</span>=<span class="string">&quot;searchForm[item.prop]&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">type</span>=<span class="string">&quot;daterange&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">range-separator</span>=<span class="string">&quot;-&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">start-placeholder</span>=<span class="string">&quot;开始时间&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">end-placeholder</span>=<span class="string">&quot;结束时间&quot;</span></span></span><br><span class="line"><span class="tag">            /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>search组件ts获取数组<br>searchForm的数据不能写死，遍历config<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IProps</span> &#123;</span><br><span class="line">  <span class="attr">searchConfig</span>: &#123;</span><br><span class="line">    <span class="comment">// 对象里的属性和config文件里的属性对应</span></span><br><span class="line">    <span class="attr">formItems</span>: <span class="built_in">any</span>[]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//这样指定props里包含一个searchConfig，和它对应的类型</span></span><br><span class="line"><span class="keyword">const</span> props = defineProps&lt;<span class="title class_">IProps</span>&gt;(&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义form的数据</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">initialForm</span>: <span class="built_in">any</span> = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> props.<span class="property">searchConfig</span>.<span class="property">formItems</span>) &#123;</span><br><span class="line">  initialForm[item.<span class="property">prop</span>] = item.<span class="property">initialValue</span> ?? <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> searchForm = <span class="title function_">reactive</span>(initialForm)</span><br></pre></td></tr></table></figure></li>
<li>search部分复用成功截图<br><mark>之前的配色为了好区分，没有设计，现在重新搭配了页面颜色</mark></li>
</ol>
<p><img src="/postImgs/nievtcms/fuyong2.png" alt="search部分复用成功"><br>功能正常，能够查询<br><img src="/postImgs/nievtcms/fuyong3.png" alt="search部分复用成功"></p>
<h2 id="search部分复用—角色管理使用复用内容"><a href="#search部分复用—角色管理使用复用内容" class="headerlink" title="search部分复用—角色管理使用复用内容"></a>search部分复用—角色管理使用复用内容</h2><p><strong>（好神奇！！这样好方便！！！！）</strong><br>角色管理在departemnt&#x2F;role文件夹下，在role.vue中引入并使用组件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">PageSearch</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/page-search/page-search.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> searchConfig <span class="keyword">from</span> <span class="string">&#x27;./config/search.config&#x27;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;page-search :search-config=&quot;searchConfig&quot; /&gt;</code><br>再写个config文件，然后就成功啦！<br><img src="/postImgs/nievtcms/fuyong4.png" alt="search部分复用成功"><br>看效果<br><img src="/postImgs/nievtcms/fuyong5.png" alt="search部分复用成功"></p>
<h2 id="content表单复用—部门管理"><a href="#content表单复用—部门管理" class="headerlink" title="content表单复用—部门管理"></a>content表单复用—部门管理</h2><p>把写死的content部分改为可复用的组件<br><img src="/postImgs/nievtcms/fuyong6.png" alt="content表单复用-"></p>
<ol>
<li>分解<br>这部分是表格，分为表格头部（表格名和新建数据按钮）和表格内容两个部分，在content.config.ts中用listHeader和listBody两部分存自定义数据。<br>文件还是放在部分文件夹下的config文件夹里<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> contentConfig = &#123;</span><br><span class="line">  <span class="attr">pageName</span>:<span class="string">&quot;department&quot;</span></span><br><span class="line">  <span class="attr">listHeader</span>: &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;我是复用的部门列表&#x27;</span>,</span><br><span class="line">    <span class="attr">btnTitle</span>: <span class="string">&#x27;我是复用添加部门&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">listBody</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> contentConfig</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>在父组件中引入，传递给子组件<br><code> &lt;page-search :search-config=&quot;searchConfig&quot;/&gt;</code></li>
<li>子组件接收数据 <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Iprops</span> &#123;</span><br><span class="line">  <span class="attr">contentConfig</span>: &#123;</span><br><span class="line">    <span class="attr">pageName</span>: <span class="built_in">string</span></span><br><span class="line">    listHeader?: &#123;</span><br><span class="line">      title?: <span class="built_in">string</span></span><br><span class="line">      btnTitle?: <span class="built_in">string</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attr">listBody</span>: <span class="built_in">any</span>[]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> props = defineProps&lt;<span class="title class_">Iprops</span>&gt;()</span><br></pre></td></tr></table></figure></li>
<li>子组件使用数据–表单头部改复用<br>如果没有数据，给一个默认的展示数据<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>部门列表<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleNewUserClick&quot;</span>&gt;</span>新建部门<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 上面原来的改为下面的 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123; contentConfig?.listHeader?.title ?? &#x27;数据列表&#x27; &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleNewUserClick&quot;</span>&gt;</span>&#123;&#123;</span><br><span class="line">        contentConfig?.listHeader?.btnTitle ?? &#x27;新增数据&#x27;</span><br><span class="line">      &#125;&#125;<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<img src="/postImgs/nievtcms/fuyong8.png" alt="content表格头部复用"><br>按顺序做vscode有提示好写很多<br><img src="/postImgs/nievtcms/fuyong7.png" alt="content复用"></li>
<li>表单内容改复用<br>每一个el-table-column的内容都可能不一样，让每一列根据配置文件listBody对象数组动态生成，每一个对象就是每一列的数据<br>表格中v-for+v-if<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-table</span> <span class="attr">:data</span>=<span class="string">&quot;pageList&quot;</span> <span class="attr">border</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;item in contentConfig.listBody&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.prop&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;item.type === &#x27;timer&#x27;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">v-bind</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">              &#123;&#123; formatUTC(scope.row[item.prop]) &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-else-if</span>=<span class="string">&quot;item.type === &#x27;handler&#x27;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">v-bind</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">icon</span>=<span class="string">&quot;Edit&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">text</span></span></span><br><span class="line"><span class="tag">                @<span class="attr">click</span>=<span class="string">&quot;handleEditBtnClick(scope.row)&quot;</span></span></span><br><span class="line"><span class="tag">              &gt;</span></span><br><span class="line">                编辑</span><br><span class="line">              <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">el-button</span></span></span><br><span class="line"><span class="tag">                <span class="attr">size</span>=<span class="string">&quot;small&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">icon</span>=<span class="string">&quot;Delete&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">text</span></span></span><br><span class="line"><span class="tag">                @<span class="attr">click</span>=<span class="string">&quot;handleDeleteBtnClick(scope.row.id)&quot;</span></span></span><br><span class="line"><span class="tag">              &gt;</span></span><br><span class="line">                删除</span><br><span class="line">              <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-else-if</span>=<span class="string">&quot;item.type === &#x27;custom&#x27;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">v-bind</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">slot</span> <span class="attr">:name</span>=<span class="string">&quot;item.slotName&quot;</span> <span class="attr">v-bind</span>=<span class="string">&quot;scope&quot;</span> <span class="attr">:prop</span>=<span class="string">&quot;item.prop&quot;</span> <span class="attr">hName</span>=<span class="string">&quot;why&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span> <span class="attr">v-bind</span>=<span class="string">&quot;item&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<img src="/postImgs/nievtcms/fuyong9.png" alt="content表单复用-"></li>
</ol>
<h2 id="modal对话框复用"><a href="#modal对话框复用" class="headerlink" title="modal对话框复用"></a>modal对话框复用</h2><p>核心方法和前面一样，不重复做笔记了</p>
<h3 id="动态获取选项中的数据"><a href="#动态获取选项中的数据" class="headerlink" title="动态获取选项中的数据"></a>动态获取选项中的数据</h3><p>选项中想要有服务器返回的部门列表数据该怎么做，使用计算属性，获取放进仓库中的部门信息，放进oconfig里面，再传给组件展示数据</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> modalConfigRef = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> mainStore = <span class="title function_">useMainStore</span>()</span><br><span class="line">  <span class="keyword">const</span> departments = mainStore.<span class="property">entireDepartments</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">label</span>: item.<span class="property">name</span>, <span class="attr">value</span>: item.<span class="property">id</span> &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  modalConfig.<span class="property">formItems</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (item.<span class="property">prop</span> === <span class="string">&#x27;parentId&#x27;</span>) &#123;</span><br><span class="line">      item.<span class="property">options</span>.<span class="title function_">push</span>(...departments)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> modalConfig</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/postImgs/nievtcms/fuyong11.png" alt="module对话框复用"></p>
<h2 id="setup中相同逻辑的抽取"><a href="#setup中相同逻辑的抽取" class="headerlink" title="setup中相同逻辑的抽取"></a>setup中相同逻辑的抽取</h2><p>setup语法糖中有部分逻辑永远是相似的，可以进行抽取<br>在父组件department.vue中，帮助search组件和content组件兄弟通信的(重置，查询)代码，还有content组件和mocal组件兄弟通信的（新建，查询）代码，其他部分父组件也会用到，会出现重复，把这部分使用hooks进行抽取<br>想抽取部分：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击search, content的操作</span></span><br><span class="line"><span class="keyword">const</span> contentRef = ref&lt;<span class="title class_">InstanceType</span>&lt;<span class="keyword">typeof</span> <span class="title class_">PageContent</span>&gt;&gt;()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleQueryClick</span>(<span class="params"><span class="attr">queryInfo</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  contentRef.<span class="property">value</span>?.<span class="title function_">fetchPageListData</span>(queryInfo)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleResetClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  contentRef.<span class="property">value</span>?.<span class="title function_">fetchPageListData</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 点击content, modal的操作</span></span><br><span class="line"><span class="keyword">const</span> modalRef = ref&lt;<span class="title class_">InstanceType</span>&lt;<span class="keyword">typeof</span> <span class="title class_">PageModal</span>&gt;&gt;()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleNewClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  modalRef.<span class="property">value</span>?.<span class="title function_">setModalVisible</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleEditClick</span>(<span class="params"><span class="attr">itemData</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  modalRef.<span class="property">value</span>?.<span class="title function_">setModalVisible</span>(<span class="literal">false</span>, itemData)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在hooks文件夹下创建usePageContent.ts文件</p>
<h2 id="全用复用组件搭建角色管理页面"><a href="#全用复用组件搭建角色管理页面" class="headerlink" title="全用复用组件搭建角色管理页面"></a>全用复用组件搭建角色管理页面</h2><p>内容全部使用只用了一个vue和三个config文件，实现页面搭建和数据的获取与展示！！<br><img src="/postImgs/nievtcms/fuyong13.png" alt="module对话框复用"><br><img src="/postImgs/nievtcms/fuyong12.png" alt="module对话框复用"></p>
<h2 id="全用复用组件搭建菜单管理页面（完善content组件实现多级菜单展示效果）"><a href="#全用复用组件搭建菜单管理页面（完善content组件实现多级菜单展示效果）" class="headerlink" title="全用复用组件搭建菜单管理页面（完善content组件实现多级菜单展示效果）"></a>全用复用组件搭建菜单管理页面（完善content组件实现多级菜单展示效果）</h2><p>看接口返回的菜单数据，后端传递的每一种数据作为每一列，再config.ts文件中是对象数组的一个对象</p>
<blockquote>
<p>理解后端数据，用户的权限管理不光有路由的权限管理，还有按钮的权限管理（比如有的用户只有某个页面的查看权限，没有该部分的删除和编辑权限）,比如system:role:create; system:role:delete</p>
</blockquote>
<h3 id="展示一级菜单二级菜单"><a href="#展示一级菜单二级菜单" class="headerlink" title="展示一级菜单二级菜单"></a>展示一级菜单二级菜单</h3><p>菜单包含一级菜单和二级菜单，想要页面的展示效果是一级菜单下能展开二级菜单，该怎么做呢</p>
<ol>
<li>仔细读官方文档： element&#x2F;Table表格&#x2F;树形数据与懒加载<blockquote>
<p>当 row 中包含 children 字段时，被视为树形数据。 渲染嵌套数据需要 prop 的 row-key。 此外，子行数据可以异步加载。 设置 Table 的lazy属性为 true 与加载函数 load 。 通过指定 row 中的hasChildren字段来指定哪些行是包含子节点。 children 与hasChildren都可以通过 tree-props 配置。</p>
</blockquote>
</li>
<li>修改content复用组件<br>给el-table添加row-key&#x3D;””属性，treeProps属性，这两个属性放在config文件中更好</li>
<li>修改config.ts文件<br>想要用element组件库展开数据，那么config数据中不可以有type类型<br>因为再el-table每一列进行v-for,v-if,v-else时，最后的v-else有v-bind&#x3D;”item”，本来给el-table添加row-key属性会默认给这种列添加type，如果config里面写，会把本来要添加的type覆盖掉，导致不显示展开样式<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-table-column</span>  <span class="attr">v-bind</span>=<span class="string">&quot;item&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> contentConfig = &#123;</span><br><span class="line">  <span class="attr">pageName</span>: <span class="string">&#x27;menu&#x27;</span>,</span><br><span class="line">  <span class="attr">listHeader</span>: &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;菜单列表&#x27;</span>,</span><br><span class="line">    <span class="attr">btnTitle</span>: <span class="string">&#x27;新建菜单&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">listBody</span>: [</span><br><span class="line">    &#123; <span class="attr">label</span>: <span class="string">&#x27;菜单名称&#x27;</span>, <span class="attr">prop</span>: <span class="string">&#x27;name&#x27;</span>, <span class="attr">width</span>: <span class="string">&#x27;180px&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">label</span>: <span class="string">&#x27;级别&#x27;</span>, <span class="attr">prop</span>: <span class="string">&#x27;type&#x27;</span>, <span class="attr">width</span>: <span class="string">&#x27;120px&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">label</span>: <span class="string">&#x27;菜单url&#x27;</span>, <span class="attr">prop</span>: <span class="string">&#x27;url&#x27;</span>, <span class="attr">width</span>: <span class="string">&#x27;150px&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">label</span>: <span class="string">&#x27;菜单icon&#x27;</span>, <span class="attr">prop</span>: <span class="string">&#x27;icon&#x27;</span>, <span class="attr">width</span>: <span class="string">&#x27;200px&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">label</span>: <span class="string">&#x27;排序&#x27;</span>, <span class="attr">prop</span>: <span class="string">&#x27;sort&#x27;</span>, <span class="attr">width</span>: <span class="string">&#x27;120px&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">label</span>: <span class="string">&#x27;权限&#x27;</span>, <span class="attr">prop</span>: <span class="string">&#x27;permission&#x27;</span>, <span class="attr">width</span>: <span class="string">&#x27;150px&#x27;</span> &#125;,</span><br><span class="line"></span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;timer&#x27;</span>, <span class="attr">label</span>: <span class="string">&#x27;创建时间&#x27;</span>, <span class="attr">prop</span>: <span class="string">&#x27;createAt&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;timer&#x27;</span>, <span class="attr">label</span>: <span class="string">&#x27;更新时间&#x27;</span>, <span class="attr">prop</span>: <span class="string">&#x27;updateAt&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;handler&#x27;</span>, <span class="attr">label</span>: <span class="string">&#x27;操作&#x27;</span>, <span class="attr">width</span>: <span class="string">&#x27;150px&#x27;</span> &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">childrenTree</span>: &#123;</span><br><span class="line">    <span class="attr">rowKey</span>: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">    <span class="attr">treeProps</span>: &#123;</span><br><span class="line">      <span class="attr">children</span>: <span class="string">&#x27;children&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> contentConfig</span><br></pre></td></tr></table></figure></li>
<li>完善content复用组件<br>在el-table上绑定<code>v-bind=&quot;contentConfig.childrenTree&quot;</code><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table :data=<span class="string">&quot;pageList&quot;</span> border style=<span class="string">&quot;width: 100%&quot;</span> v-bind=<span class="string">&quot;contentConfig.childrenTree&quot;</span>&gt;</span><br></pre></td></tr></table></figure>
在IProps中添加可选的childrenTree属性<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IProps</span> &#123;</span><br><span class="line">  <span class="attr">contentConfig</span>: &#123;</span><br><span class="line">    <span class="attr">pageName</span>: <span class="built_in">string</span></span><br><span class="line">    listHeader?: &#123;</span><br><span class="line">      title?: <span class="built_in">string</span></span><br><span class="line">      btnTitle?: <span class="built_in">string</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attr">listBody</span>: <span class="built_in">any</span>[]</span><br><span class="line">    childrenTree?: <span class="built_in">any</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>成功截图<br><img src="/postImgs/nievtcms/fuyong13.png" alt="content实现多级惨淡展示效果"></li>
</ol>
<h2 id="完善复用组件–插槽实现自定义标签-展示树形菜单"><a href="#完善复用组件–插槽实现自定义标签-展示树形菜单" class="headerlink" title="完善复用组件–插槽实现自定义标签(展示树形菜单)"></a>完善复用组件–插槽实现自定义标签(展示树形菜单)</h2><p>想要在“添加菜单”modal中展示菜单列表让用户选择。自定义modal里可以放插槽，插槽里可以放任何东西，比如h2标签等</p>
<ol>
<li>简单例子<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;item.type === &#x27;custom&#x27;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">slot</span> <span class="attr">:name</span>=<span class="string">&quot;item.slotName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
父组件使用时<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">page-modal</span> <span class="attr">:modal-config</span>=<span class="string">&quot;modalconfig&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;modalRef&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>自定义span标签<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">btn</span>&gt;</span> <span class="tag">&lt;<span class="name">button</span>&gt;</span> 自定义button标签<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">template</span>&gt;</span><span class="tag">&lt;/<span class="name">page-modal</span>&gt;</span></span><br></pre></td></tr></table></figure>
在config中，多个自定义组件区分在<code>slotName</code>不同，type都为<code>custom</code></li>
<li>插槽实现自定义菜单列表（树形结构）<br>element组件库&#x2F;数据展示&#x2F;树形控件&#x2F;树节点的选择<br>在父组件role.vue使用树形结构<strong>注意:props</strong><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">page-modal</span> <span class="attr">:modal-config</span>=<span class="string">&quot;modalConfig&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;modalRef&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">menulist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-tree</span></span></span><br><span class="line"><span class="tag">      <span class="attr">ref</span>=<span class="string">&quot;treeRef&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:data</span>=<span class="string">&quot;entireMenus&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">show-checkbox</span></span></span><br><span class="line"><span class="tag">      <span class="attr">node-key</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:props</span>=<span class="string">&quot;&#123; children: &#x27;children&#x27;, label: &#x27;name&#x27; &#125;&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">page-modal</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>获取菜单<br>与前面获取部门和角色一样，在role.vue中使用<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取完整的菜单</span></span><br><span class="line"><span class="keyword">const</span> mainStore = <span class="title function_">useMainStore</span>()</span><br><span class="line"><span class="keyword">const</span> &#123; entireMenus &#125; = <span class="title function_">storeToRefs</span>(mainStore)</span><br></pre></td></tr></table></figure></li>
<li>实现截图<br><img src="/postImgs/nievtcms/role1.png" alt="content实现多级菜单展示效果"></li>
</ol>
<h2 id="完善：action触发后分页回到第一页"><a href="#完善：action触发后分页回到第一页" class="headerlink" title="完善：action触发后分页回到第一页"></a>完善：action触发后分页回到第一页</h2><p>在modal组件点击新建或编辑或删除之后，content页面应该回归到<code>1</code>页面<br>modal页面点击确定之后，content页面改变，兄弟组件通信，继续借助父组件<br>新增，编辑，删除的操作，都是在store&#x2F;system的actions里面，判断只要做了edit\delete\new操作，那么就进行页码回归（修改curretPage.value为1）<br>在page-content.vue中监听actions里的操作</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemStore.$onAction(<span class="function">(<span class="params">args</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;监听到actions&#x27;</span>, args)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/postImgs/nievtcms/jianting1.png" alt="用户权限"></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.发起action，请求usersList的数据</span></span><br><span class="line"><span class="keyword">const</span> systemStore = <span class="title function_">useSystemStore</span>()</span><br><span class="line"><span class="keyword">const</span> currentPage = <span class="title function_">ref</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> pageSize = <span class="title function_">ref</span>(<span class="number">10</span>)</span><br><span class="line"><span class="comment">//后面添加：监听store/stsyem中actions</span></span><br><span class="line"><span class="comment">//用actions参数，它本身接收一个回调，当action执行成功时触发</span></span><br><span class="line">systemStore.$onAction(<span class="function">(<span class="params">&#123; name, after &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">after</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      name === <span class="string">&#x27;deletePageByIdAction&#x27;</span> ||</span><br><span class="line">      name === <span class="string">&#x27;editPageDataAction&#x27;</span> ||</span><br><span class="line">      name === <span class="string">&#x27;newPageDataAction&#x27;</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      currentPage.<span class="property">value</span> = <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//获取页面数据</span></span><br><span class="line"><span class="title function_">fetchPageListData</span>()</span><br></pre></td></tr></table></figure>
<h2 id="完善：新建和编辑角色功能"><a href="#完善：新建和编辑角色功能" class="headerlink" title="完善：新建和编辑角色功能"></a>完善：新建和编辑角色功能</h2><h3 id="创建角色（树形结构组件）"><a href="#创建角色（树形结构组件）" class="headerlink" title="创建角色（树形结构组件）"></a>创建角色（树形结构组件）</h3><p>创建角色的modal要携带菜单数据<br>实现新建用户的请求，要拿到mentList数据<br>在element组件库&#x2F;树形控件<strong>往下翻有非常多的事件</strong>，用cheak事件<br>在el-tree里绑定<code>          @check=&quot;handleElTreeCheck&quot;</code><br>先看看里面的两个参数是什么</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleElTreeCheck</span>(<span class="params"><span class="attr">data1</span>: <span class="built_in">any</span>, <span class="attr">data2</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击了复选框，两个数据&#x27;</span>, data1, data2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/postImgs/nievtcms/role2.png" alt="获取多级菜单"><br>data1是点击的节点的信息（id,url,name,sort,type）<br>data2：checkedKeys点击节点的id；halfCheckedKeys半选是它父节点的id；halfCheckedNodes它父节点的对象<br>看结果得知，通过<code>checkedKeys</code>和<code>halfCheckedKeys</code>可以得到选择的菜单项的id<br> modal组件增加<code>otherInfo?: any</code><br> <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IModalProps</span> &#123;</span><br><span class="line">  <span class="attr">modalConfig</span>: &#123;</span><br><span class="line">    <span class="attr">pageName</span>: <span class="built_in">string</span></span><br><span class="line">    <span class="attr">header</span>: &#123;</span><br><span class="line">      <span class="attr">newTitle</span>: <span class="built_in">string</span></span><br><span class="line">      <span class="attr">editTitle</span>: <span class="built_in">string</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attr">formItems</span>: <span class="built_in">any</span>[]</span><br><span class="line">  &#125;</span><br><span class="line">  otherInfo?: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br> role.vue中绑定<code>otherInfo</code><br> <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">const</span> otherInfo = <span class="title function_">ref</span>(&#123;&#125;)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">handleElTreeCheck</span>(<span class="params"><span class="attr">data1</span>: <span class="built_in">any</span>, <span class="attr">data2</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> menuList = [...data2.<span class="property">checkedKeys</span>, ...data2.<span class="property">halfCheckedKeys</span>]</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data2.<span class="property">checkedKeys</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(menuList)</span><br><span class="line">    otherInfo.<span class="property">value</span> = &#123; menuList &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br> <img src="/postImgs/nievtcms/role3.png" alt="获取多级菜单"><br> 把数据绑定给<code>page-modal</code>组件:<code>:other-info=&quot;otherInfo&quot; </code><br> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">page-modal</span> <span class="attr">:modal-config</span>=<span class="string">&quot;modalConfig&quot;</span> <span class="attr">:other-info</span>=<span class="string">&quot;otherInfo&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;modalRef&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">menulist</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-tree</span></span></span><br><span class="line"><span class="tag">      <span class="attr">ref</span>=<span class="string">&quot;treeRef&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:data</span>=<span class="string">&quot;entireMenus&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">show-checkbox</span></span></span><br><span class="line"><span class="tag">      <span class="attr">node-key</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:props</span>=<span class="string">&quot;&#123; children: &#x27;children&#x27;, label: &#x27;name&#x27; &#125;&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">check</span>=<span class="string">&quot;handleElTreeCheck&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">page-modal</span>&gt;</span></span><br></pre></td></tr></table></figure><br>现在modal接收到了菜单数据，发送前进行判断otherInfo数据，有的话合并进去</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handleConfirmClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  dialogVisible.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> infoData = formData</span><br><span class="line">  <span class="keyword">if</span> (props.<span class="property">otherInfo</span>) &#123;</span><br><span class="line">    infoData = &#123; ...infoData, ...props.<span class="property">otherInfo</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!isNewRef.<span class="property">value</span> &amp;&amp; editData.<span class="property">value</span>) &#123;</span><br><span class="line">    <span class="comment">// 编辑用户的数据</span></span><br><span class="line">    systemStore.<span class="title function_">editPageDataAction</span>(props.<span class="property">modalConfig</span>.<span class="property">pageName</span>, editData.<span class="property">value</span>.<span class="property">id</span>, infoData)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 创建新的部门</span></span><br><span class="line">    systemStore.<span class="title function_">newPageDataAction</span>(props.<span class="property">modalConfig</span>.<span class="property">pageName</span>, infoData)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>新建角色成功<br> <img src="/postImgs/nievtcms/role4.png" alt="获取多级菜单"></p>
<h3 id="编辑角色（递归获取最底层id，菜单回显）"><a href="#编辑角色（递归获取最底层id，菜单回显）" class="headerlink" title="编辑角色（递归获取最底层id，菜单回显）"></a>编辑角色（递归获取最底层id，菜单回显）</h3><ol>
<li>思路<br>点击编辑按钮，弹出的modal对话框需要已经勾选了这个角色原来的菜单子菜单信息，这部分获取信息的操作之前封装在hooks&#x2F;usePageModal.ts中<br>还是官方文档，树形结构&#x2F;事件有<code>.setCheckedKeys()</code>方法，把菜单对应的id数组放进去可以展示</li>
<li>封装获取id工具<br>现在返回的数据是嵌套关系的，封装一个工具用来把里面的id取出来<code>utils/map-menys.ts</code>文件<br>目标是找到最底层的菜单对应的id，不要父菜单的id，因为选中父菜单的id会自动把它的子菜单全部选中<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 菜单映射到id的列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">menuList</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">mapMenuListToIds</span>(<span class="params"><span class="attr">menuList</span>: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">  <span class="comment">//要拿到所有的id组合的数组</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">ids</span>: <span class="built_in">number</span>[] = []</span><br><span class="line">  <span class="comment">//递归获取id</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">recurseGetId</span>(<span class="params"><span class="attr">menus</span>: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> menus) &#123;</span><br><span class="line">      <span class="keyword">if</span> (item.<span class="property">children</span>) &#123;</span><br><span class="line">        <span class="comment">//如果遍历的有子菜单，那么再遍历一次</span></span><br><span class="line">        <span class="title function_">recurseGetId</span>(item.<span class="property">children</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//如果遍历的没有子菜单，进入了最底部的id，把最底部的id取出来</span></span><br><span class="line">        <span class="comment">//目标是找到最底层的菜单对应的id，不要父菜单的id，</span></span><br><span class="line">        <span class="comment">//因为选中父菜单的id会自动把它的子菜单全部选中</span></span><br><span class="line">        ids.<span class="title function_">push</span>(item.<span class="property">id</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">recurseGetId</span>(menuList)</span><br><span class="line">  <span class="keyword">return</span> ids</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>父组件调用<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapMenuListToIds &#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/map-menus&#x27;</span></span><br><span class="line"><span class="keyword">const</span> treeRef = ref&lt;<span class="title class_">InstanceType</span>&lt;<span class="keyword">typeof</span> <span class="title class_">ElTree</span>&gt;&gt;()</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">editCallback</span>(<span class="params"><span class="attr">itemData</span>: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">  <span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> menuIds = <span class="title function_">mapMenuListToIds</span>(itemData.<span class="property">menuList</span>)</span><br><span class="line">    treeRef.<span class="property">value</span>?.<span class="title function_">setCheckedKeys</span>(menuIds)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>nextTick()是Vue3提供的一个方法，用于等待DOM更新完成，然后执行回调函数<br>以下内容来自官方文档<br>等待下一次 DOM 更新刷新的工具方法<br>当你在 Vue 中更改响应式状态时，最终的 DOM 更新并不是同步生效的，而是由 Vue 将它们缓存在一个队列中，直到下一个“tick”才一起执行。这样是为了确保每个组件无论发生多少状态改变，都仅执行一次更新。<br>nextTick() 可以在状态改变后立即使用，以等待 DOM 更新完成。你可以传递一个回调函数作为参数，或者 await 返回的 Promise。</p>
</blockquote>
</li>
<li>成功回显截图<br> <img src="/postImgs/nievtcms/role5.png" alt="获取多级菜单"></li>
</ol>
<h1 id="按钮权限管理"><a href="#按钮权限管理" class="headerlink" title="按钮权限管理"></a>按钮权限管理</h1><p>对页面中核心的增删改查功能进行权限管理</p>
<h2 id="按钮权限在哪里"><a href="#按钮权限在哪里" class="headerlink" title="按钮权限在哪里"></a>按钮权限在哪里</h2><p>关于增删改查操作的权限在菜单管理里面有对应的字段，”角色管理”可以对角色拥有的权限进行管理<br> <img src="/postImgs/nievtcms/quanxian1.png" alt="用户权限"><br>在请求userMenus数据时，已经包含了按钮权限数据<br>在第三级数据里<code>permission</code>字段，通过这个判断是有按钮权限<br> <img src="/postImgs/nievtcms/quanxian2.png" alt="用户权限"></p>
<h2 id="获取用户按钮权限数据保存到store中"><a href="#获取用户按钮权限数据保存到store中" class="headerlink" title="获取用户按钮权限数据保存到store中"></a>获取用户按钮权限数据保存到store中</h2><ol>
<li>在登录仓库中添加字段，调用方法<br>在获取userMents菜单信息的地方<code>store/login/login.ts</code>里，去获取登录用户的所有按钮权限数据，放到<code>permissions[]</code>数组里，在store中添加permissions字段，下面这两段不光在用户登录之后触发，在刷新之后也应该触发<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//9.按钮权限</span></span><br><span class="line"><span class="keyword">const</span> permissions = <span class="title function_">mapMenusToPermissions</span>(userMenusData)</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">permissions</span> = permissions</span><br></pre></td></tr></table></figure></li>
<li>封装映射关系方法<br>从userMenus里映射出permission，也是一种映射关系，<code>mapMenusToPermissions</code>方法也放utils&#x2F;map-menus.ts里<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从菜单里映射出按钮的权限</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> menuList 菜单的列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> 按钮权限的数组(字符串数组)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">mapMenusToPermissions</span>(<span class="params"><span class="attr">menuList</span>: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">permissions</span>: <span class="built_in">string</span>[] = []</span><br><span class="line">  <span class="comment">//用递归，遍历传进来的menus</span></span><br><span class="line">  <span class="comment">//在storage保存的json数据中，有关按钮权限的数据type=3</span></span><br><span class="line">  <span class="comment">//所以，在递归函数中，判断type=3，就push到permissions中</span></span><br><span class="line">  <span class="comment">//如果不是第三级，那么可能是第一级可能第二级，拿出来继续做递归</span></span><br><span class="line">  <span class="comment">//有的只有第二层，没有第三层，再找children为null</span></span><br><span class="line">  <span class="comment">//此时const item of null会报错，所以如果没有chidren用空数组代替</span></span><br><span class="line">  <span class="comment">//const item of [] 什么都不会做，相当于不遍历直接结束循环，不会报错</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">recurseGetPermission</span>(<span class="params"><span class="attr">menus</span>: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> menus) &#123;</span><br><span class="line">      <span class="keyword">if</span> (item.<span class="property">type</span> === <span class="number">3</span>) &#123;</span><br><span class="line">        permissions.<span class="title function_">push</span>(item.<span class="property">permission</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">recurseGetPermission</span>(item.<span class="property">children</span> ?? [])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">recurseGetPermission</span>(menuList)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> permissions</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>成功截图<br>看仓库，已经成功获取到了用户按钮权限信息<br><img src="/postImgs/nievtcms/quanxian3.png" alt="用户权限"></li>
</ol>
<h2 id="页面权限校验"><a href="#页面权限校验" class="headerlink" title="页面权限校验"></a>页面权限校验</h2><ol>
<li>content组件中判断<br>由于增删改都在page-content组件中，去这里判断<br>在一进入page-content组件时，判断当前的用户有没有增删改查四个权限,用v-if对应的布尔值判断是否展示对应的按钮，比如：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button v-if=&quot;isCreate&quot; type=&quot;primary&quot; @click=&quot;handleNewUserClick&quot;&gt;&#123;&#123;contentConfig?.listHeader?.btnTitle ?? &#x27;新增数据&#x27;</span><br><span class="line">&#125;&#125;&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>
如果编辑和删除都没有，那么整个列都不展示<br>对于查询操作，如果没有就不进行请求方法<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.定义函数, 用于发送网络请求</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fetchPageListData</span>(<span class="params"><span class="attr">formData</span>: <span class="built_in">any</span> = &#123;&#125;</span>) &#123;</span><br><span class="line">  <span class="comment">//判断有没有查询权限，没有直接return，不展示数据</span></span><br><span class="line">  <span class="keyword">if</span>(!isQuery) <span class="keyword">return</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
<li>动态获取权限，抽hooks<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loginStore = <span class="title function_">useLoginStore</span>()</span><br><span class="line"><span class="keyword">const</span> &#123;permissions&#125; = loginStore</span><br><span class="line"><span class="keyword">const</span> isCreate =permissions.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>)=&gt;</span>item.<span class="title function_">includes</span>($&#123;props.<span class="property">contentConfig</span>.<span class="property">pageName</span>&#125;:create))</span><br><span class="line">....</span><br></pre></td></tr></table></figure>
把这部分抽取出一个hook，usePermissions.ts<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useLoginStore <span class="keyword">from</span> <span class="string">&#x27;@/store/login/login&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">usePermissions</span>(<span class="params"><span class="attr">permissionID</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> loginStore = <span class="title function_">useLoginStore</span>()</span><br><span class="line">  <span class="keyword">const</span> &#123; permissions &#125; = loginStore</span><br><span class="line">  <span class="comment">//注意这里哦，想要发挥的一定是一个布尔类型</span></span><br><span class="line">  <span class="comment">//第一种方法</span></span><br><span class="line">  <span class="comment">//return Boolean(permissions.find((item) =&gt; item.includes(permissionID)))</span></span><br><span class="line">  <span class="comment">// 第二种方法：</span></span><br><span class="line">  <span class="comment">//两个感叹号，第一个感叹号取反，第二个再取反，转回对应的boolean类型</span></span><br><span class="line">  <span class="keyword">return</span> !!permissions.<span class="title function_">find</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> item.<span class="title function_">includes</span>(permissionID))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> usePermissions</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>content.vue页面调用<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> usePermissions <span class="keyword">from</span> <span class="string">&#x27;@/hooks/usePermissions&#x27;</span></span><br><span class="line"><span class="keyword">const</span> isCreate = <span class="title function_">usePermissions</span>(<span class="string">`<span class="subst">$&#123;props.contentConfig.pageName&#125;</span>:create`</span>)</span><br><span class="line"><span class="keyword">const</span> isDelete = <span class="title function_">usePermissions</span>(<span class="string">`<span class="subst">$&#123;props.contentConfig.pageName&#125;</span>:delete`</span>)</span><br><span class="line"><span class="keyword">const</span> isUpdate = <span class="title function_">usePermissions</span>(<span class="string">`<span class="subst">$&#123;props.contentConfig.pageName&#125;</span>:update`</span>)</span><br><span class="line"><span class="keyword">const</span> isQuery = <span class="title function_">usePermissions</span>(<span class="string">`<span class="subst">$&#123;props.contentConfig.pageName&#125;</span>:query`</span>)</span><br></pre></td></tr></table></figure></li>
<li>search组件中判断<br>思路一样，<code>const isQuery = usePermissions(`$&#123;props.searchConfig.pageName&#125;:query`)</code>，<code>&lt;div class=&quot;search&quot; v-if=&quot;isQuery&quot;&gt;</code></li>
</ol>
<h1 id="数据可视化页面"><a href="#数据可视化页面" class="headerlink" title="数据可视化页面"></a>数据可视化页面</h1><ol>
<li>先死数据写出样子，再封装组件，再放真实数据<br>  放在views&#x2F;main&#x2F;analysys&#x2F;dashboard&#x2F;dashboard。vue为父组件，analysys&#x2F;dashboard&#x2F;c-cpns&#x2F;下是页面的上下部分两个子组件</li>
</ol>
<ul>
<li>数据展示：递增动画实现方式：<br>1.countup: 数字增加动画库（比较轻量级）<br>2.专门的一些动画库: gsap（没有上面的轻量，如果需要多种动画效果再引入这个用）</li>
<li>鼠标放到右上角小图标上，能展示文字提示的气泡，用element-plus的反馈组件&#x2F;Tooltip文字提示组件<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;count-card&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>商品总销量<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-tooltip</span> <span class="attr">content</span>=<span class="string">&quot;所有商品的总销量&quot;</span><span class="attr">placement</span>=<span class="string">&quot;top&quot;</span> <span class="attr">effec</span>=<span class="string">&quot;light&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-icon</span>&gt;</span><span class="tag">&lt;<span class="name">Warning</span> /&gt;</span><span class="tag">&lt;/<span class="name">el-icon</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-tooltip</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li>从后端拿到数据<br>service&#x2F;main&#x2F;analysys&#x2F;analysis.ts<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hyRequest <span class="keyword">from</span> <span class="string">&#x27;@/service&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getAmountListData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> hyRequest.<span class="title function_">get</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/goods/amount/list&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
专门放一个store管理这部分数据<br>store&#x2F;main&#x2F;analysys&#x2F;analysis.ts<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IAnalysisState</span> &#123;</span><br><span class="line">  <span class="attr">amountList</span>: <span class="built_in">any</span>[]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> useAnalysisStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;analysis&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">state</span>: ():<span class="function"><span class="params">IAnalysisState</span> =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">amountList</span>: <span class="built_in">any</span>[]</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">actions</span>: &#123;</span><br><span class="line">   <span class="keyword">async</span> <span class="title function_">fetchAnalysisDataAction</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> amountResult = <span class="keyword">await</span> <span class="title function_">getAmountListData</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">amountList</span> = amountResult.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useAnalysisStore</span><br><span class="line"></span><br></pre></td></tr></table></figure>
dashboard.vue<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> useAnalysisStore <span class="keyword">from</span> <span class="string">&#x27;@/store/main/analysis/analysis&#x27;</span></span><br><span class="line"><span class="comment">// 一进页面发起数据的请求，数据保存到了store中</span></span><br><span class="line"><span class="keyword">const</span> analysisStore = <span class="title function_">useAnalysisStore</span>()</span><br><span class="line">analysisStore.<span class="title function_">fetchAnalysisDataAction</span>()</span><br><span class="line"><span class="comment">//从store中拿到数据,用storeToRefs变成响应式数据</span></span><br><span class="line"><span class="keyword">const</span> &#123; amountList &#125; = <span class="title function_">storeToRefs</span>(analysisStore)</span><br></pre></td></tr></table></figure></li>
<li>给组件使用数据<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1.顶部数字的数据展示 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-row</span> <span class="attr">:gutter</span>=<span class="string">&quot;10&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;item in amountList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.amount&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;6&quot;</span> <span class="attr">:xs</span>=<span class="string">&quot;24&quot;</span> <span class="attr">:sm</span>=<span class="string">&quot;12&quot;</span> <span class="attr">:md</span>=<span class="string">&quot;8&quot;</span> <span class="attr">:lg</span>=<span class="string">&quot;6&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 用v-bind的前提是json格式的数据和组件属性名保持一致 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">count-card</span> <span class="attr">v-bind</span>=<span class="string">&quot;item&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="数据增长动画"><a href="#数据增长动画" class="headerlink" title="数据增长动画"></a>数据增长动画</h2><ol>
<li><p>引入countup库<br><code>pnpm install countup.js</code><br> <code>pnpm add countup.js</code><br><a target="_blank" rel="noopener" href="https://inorganik.github.io/countUp.js/">CountUp.js库</a></p>
</li>
<li><p>使用库<br>从库中拿到类，创建实例对象<br><code>countUp()</code>方法:接收2-3个参数，参数一为执行动画的元素，参数二为结束数字，参数三为配置项（如startVal开始数字参数，perfix前缀参数）<br>dashboard.vue</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">ref</span>=<span class="string">&quot;count1Ref&quot;</span>&gt;</span>&#123;&#123;number1&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">const</span> count1Ref = ref&lt;<span class="title class_">HTMLelement</span>&gt;()</span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//加感叹号非空断言，表示值一定不为空</span></span><br><span class="line"><span class="keyword">const</span> countUp1 = <span class="keyword">new</span> <span class="title class_">CountUp</span>(count1Ref.<span class="property">value</span>!,props.<span class="property">number1</span>, &#123;</span><br><span class="line">  <span class="attr">startVal</span>:<span class="number">10000</span></span><br><span class="line">&#125;)</span><br><span class="line">countUp1.<span class="title function_">start</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>添加人民币符号（灵活）<br>添加一个销售额属性，当数字为销售额，添加人民币符号<br>CountUp()第三个参数中，有增加前缀的参数</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> countOption = &#123;</span><br><span class="line">  <span class="attr">prefix</span>: props.<span class="property">amount</span> === <span class="string">&#x27;saleroom&#x27;</span> ? <span class="string">&#x27;¥&#x27;</span> : <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> countup1 = <span class="keyword">new</span> <span class="title class_">CountUp</span>(count1Ref.<span class="property">value</span>!, props.<span class="property">number1</span>, countOption)</span><br><span class="line">  <span class="keyword">const</span> countup2 = <span class="keyword">new</span> <span class="title class_">CountUp</span>(count2Ref.<span class="property">value</span>!, props.<span class="property">number2</span>, countOption)</span><br><span class="line">  countup1.<span class="title function_">start</span>()</span><br><span class="line">  countup2.<span class="title function_">start</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>卡片展示效果<br>希望每部分数据都在一个单独的卡片上<br>element组件库&#x2F;数据展示&#x2F;卡片&#x2F;基础用法就够了 </p>
</li>
<li><p>成功截图<br><img src="/postImgs/nievtcms/look1.png" alt="数字动态可视化展示"></p>
</li>
</ol>
<h2 id="EChart图表展示"><a href="#EChart图表展示" class="headerlink" title="EChart图表展示"></a>EChart图表展示</h2><ol>
<li>在项目里集成ECharts,</li>
<li>导入 import * as  echarts from ‘echarts’,</li>
<li>echarts.init()初始化echarts实例</li>
<li>然后写配置Options，宽度默认 百分之百，一定要 自己添加高度</li>
</ol>
<h3 id="三层封装"><a href="#三层封装" class="headerlink" title="三层封装"></a>三层封装</h3><ol>
<li>封装page-echarts文件夹，&#x2F;src&#x2F;base-echart（第一层封装）</li>
<li>进行抽取，不同类型的echarts图表封装不同的子组件<br>比如饼图pie-echarts（第二层封装 ），在里面引入baseEchart<br>把整个配置文件options从base-echarts抽取出去，让别的组件（比如pie-echart）往里传<br>类型报错处理：<br><img src="/postImgs/nievtcms/look4.png" alt="EChart类型报错处理"><br>直接<code>&lt;base-echart :option=&quot;option&quot;/&gt;</code> 会报”option”类型错误，需要进行<code>import type&#123; EChartsOption&#125; from &#39;echarts&#39;</code><br>再给option明确指定类型<br><code>const option: EChartsOption=&#123;配置项&#125;</code></li>
<li>第三层封装－－抽离数据：把数据传入第二层封装的options里<br><strong>数据从service里面拿到，然后放到store里，再传到页面，页面再传递给它调用的组件里</strong><br>完善：刚开始数据是空的，后续拿到数据，数据会变化，所以用计算属性<code>const options = computed&lt;&gt;(()=&gt;&#123;&#125;)</code>这样可以拿到最新的数据<br>数据更新后，也要重新进行setOption<br><strong>使用watchEffect()监听</strong>,在setOption外面包裹即可<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watchEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">echartInstance.<span class="title function_">setOption</span>(props.<span class="property">option</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h3><p>一共用到五种echart图标，每一种封装一个组件components&#x2F;page-echarts&#x2F;src&#x2F;<br><img src="/postImgs/nievtcms/look2.png" alt="EChart图表展示"><br><img src="/postImgs/nievtcms/look3.png" alt="EChart图表展示"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Melon_Nie</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/04/15/23-nievuets/">http://example.com/2025/04/15/23-nievuets/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">Melon_Nie的月光橘海</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/vue/">vue</a><a class="post-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE/">项目</a></div><div class="post-share"><div class="social-share" data-image="/./myimg/qingmei.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/05/06/31-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%BA%93-axios%E5%BA%93/" title="网络请求--axios/fetch学习笔记和面试题"><img class="cover" src="/./myimg/lolcute6.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">网络请求--axios/fetch学习笔记和面试题</div></div><div class="info-2"><div class="info-item-1">axios库、fetch的学习；用typescript发送网络请求；相关问题</div></div></div></a><a class="pagination-related" href="/2025/04/13/29-jsAPI/" title="JavaScript高频API"><img class="cover" src="/./myimg/rabbit3.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">JavaScript高频API</div></div><div class="info-2"><div class="info-item-1">JavaScript常用API整理</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2024/10/01/10-vue2%E5%95%86%E5%9F%8E%E8%B4%AD%E7%89%A9%E9%A1%B9%E7%9B%AE/" title="vue2项目练习-购物商城项目"><img class="cover" src="/./myimg/jinli.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-01</div><div class="info-item-2">vue2项目练习-购物商城项目</div></div><div class="info-2"><div class="info-item-1">vue2项目练习-购物商城项目学习笔记（跟做黑马程序员vue2购物商城项目）</div></div></div></a><a class="pagination-related" href="/2024/11/12/13-vue3%E5%A4%A7%E4%BA%8B%E4%BB%B6%E9%A1%B9%E7%9B%AE/" title="vue3项目练习-大事件项目（完成3&#x2F;4）"><img class="cover" src="/./myimg/lolcute1.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-12</div><div class="info-item-2">vue3项目练习-大事件项目（完成3&#x2F;4）</div></div><div class="info-2"><div class="info-item-1">vue3项目练习-大事件项目学习笔记（跟做黑马程序员vue3大项目），未全部完成</div></div></div></a><a class="pagination-related" href="/2025/06/04/23-myselfUp/" title="项目篇-项目梳理（Vue3+TS实现后台管理系统）"><img class="cover" src="/./myimg/lolcute12.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-04</div><div class="info-item-2">项目篇-项目梳理（Vue3+TS实现后台管理系统）</div></div><div class="info-2"><div class="info-item-1">项目梳理回顾+用STAR法则讲解模块</div></div></div></a><a class="pagination-related" href="/2024/07/03/07-vue/" title="Vue--从vue2入门到了解"><img class="cover" src="/./myimg/pinkflower.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-03</div><div class="info-item-2">Vue--从vue2入门到了解</div></div><div class="info-2"><div class="info-item-1">学习Vue2的笔记整理</div></div></div></a><a class="pagination-related" href="/2025/04/01/11-vue3/" title="vue3学习篇（2025）"><img class="cover" src="/./myimg/lolcute10.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-01</div><div class="info-item-2">vue3学习篇（2025）</div></div><div class="info-2"><div class="info-item-1">OptionsAPI,CompositionAPI，模板语法，vite,vue-router</div></div></div></a><a class="pagination-related" href="/2024/10/23/12-pinia/" title="pinia学习篇"><img class="cover" src="/./myimg/lolcute1.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-23</div><div class="info-item-2">pinia学习篇</div></div><div class="info-2"><div class="info-item-1">vue进阶-pinia学习整理</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/./myimg/avatar1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Melon_Nie</div><div class="author-info-description">欢迎访问，祝你拥有美好的一天~</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">55</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Nie7-Melon"><i class="fab fa-github"></i><span>我的github</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Nie7-Melon" target="_blank" title="Github"><i class="fab fa-github" style="color: #fad701;"></i></a><a class="social-icon" href="https://gitee.com/melon-nie" target="_blank" title="Gitee"><i class="fa-solid fa-house" style="color: #fad701;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客，如果能对你有帮助就更好啦</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">项目简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">1.1.</span> <span class="toc-text">技术栈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E5%B1%95%E7%A4%BA"><span class="toc-number">1.2.</span> <span class="toc-text">运行展示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%A2%B3%E7%90%86"><span class="toc-number">1.3.</span> <span class="toc-text">项目梳理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E5%92%8C%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="toc-number">2.</span> <span class="toc-text">搭建和基础配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="toc-number">2.1.</span> <span class="toc-text">项目搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E7%9B%AE%E5%BD%95"><span class="toc-number">2.2.</span> <span class="toc-text">原始目录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%AB%E5%90%8D%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.1.</span> <span class="toc-text">@别名配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A9App%E8%A2%AB%E8%AF%86%E5%88%AB%E6%88%90%E7%BB%84%E4%BB%B6-%E5%8F%AF%E9%80%89"><span class="toc-number">2.2.2.</span> <span class="toc-text">让App被识别成组件(可选)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E8%B0%83%E6%95%B4"><span class="toc-number">2.2.3.</span> <span class="toc-text">目录调整</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83%E9%85%8D%E7%BD%AE"><span class="toc-number">2.3.</span> <span class="toc-text">代码规范配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E6%88%90editorconfig%E9%85%8D%E7%BD%AE"><span class="toc-number">2.3.1.</span> <span class="toc-text">集成editorconfig配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#prettier%E5%B7%A5%E5%85%B7"><span class="toc-number">2.3.2.</span> <span class="toc-text">prettier工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8ESLint%E6%A3%80%E6%B5%8B-%E6%88%91%E4%B9%8B%E5%89%8D%E5%81%9A%E8%BF%87%EF%BC%8C%E8%BF%99%E9%87%8C%E6%B2%A1%E6%9C%89%E6%8C%89%E7%85%A7%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">2.3.3.</span> <span class="toc-text">使用ESLint检测(我之前做过，这里没有按照配置说明配置)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#css%E6%A0%B7%E5%BC%8F%E9%87%8D%E7%BD%AE"><span class="toc-number">2.4.</span> <span class="toc-text">css样式重置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE"><span class="toc-number">2.5.</span> <span class="toc-text">路由配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%B7%AF%E7%94%B1%E5%AE%9E%E4%BE%8B"><span class="toc-number">2.5.1.</span> <span class="toc-text">创建路由实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BB%84%E4%BB%B6"><span class="toc-number">2.5.2.</span> <span class="toc-text">创建组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E7%BB%84%E4%BB%B6%E5%8D%95%E4%B8%AA%E5%8D%95%E8%AF%8D%E5%91%BD%E5%90%8D%E8%AD%A6%E5%91%8A%E9%97%AE%E9%A2%98"><span class="toc-number">2.5.2.1.</span> <span class="toc-text">解决组件单个单词命名警告问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5%EF%BC%88%E5%80%9F%E7%94%A8%E7%BD%91%E7%AB%99%EF%BC%89"><span class="toc-number">2.5.2.2.</span> <span class="toc-text">生成代码片段（借用网站）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1"><span class="toc-number">2.5.3.</span> <span class="toc-text">配置路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E8%B7%AF%E7%94%B1"><span class="toc-number">2.5.4.</span> <span class="toc-text">测试路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E5%96%84%E2%80%93notfound%E9%A1%B5%E9%9D%A2"><span class="toc-number">2.5.5.</span> <span class="toc-text">完善–notfound页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86pinia"><span class="toc-number">2.6.</span> <span class="toc-text">状态管理pinia</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E4%B8%AA%E4%BE%8B%E5%AD%90%E6%B5%8B%E8%AF%95"><span class="toc-number">2.6.1.</span> <span class="toc-text">写个例子测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#axios"><span class="toc-number">2.7.</span> <span class="toc-text">axios</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82"><span class="toc-number">2.7.1.</span> <span class="toc-text">测试网络请求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F%E5%92%8C%E7%94%9F%E4%BA%A7%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.8.</span> <span class="toc-text">开发模式和生产模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Element-Plus%E9%9B%86%E6%88%90"><span class="toc-number">2.9.</span> <span class="toc-text">Element-Plus集成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">2.9.1.</span> <span class="toc-text">使用方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8tsconfig-js%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE"><span class="toc-number">2.9.2.</span> <span class="toc-text">在tsconfig,js文件中添加配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E6%95%B4%E7%AA%97%E5%8F%A3%E5%A4%A7%E5%B0%8F"><span class="toc-number">2.10.</span> <span class="toc-text">调整窗口大小</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E9%A1%B5"><span class="toc-number">3.</span> <span class="toc-text">登录页</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E9%A1%B5%E5%B8%83%E5%B1%80"><span class="toc-number">3.1.</span> <span class="toc-text">登录页布局</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%A1%86%E7%BB%84%E4%BB%B6%E5%AF%BC%E5%85%A5"><span class="toc-number">3.1.1.</span> <span class="toc-text">登录框组件导入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%A1%86%E7%BB%84%E4%BB%B6%E5%B8%83%E5%B1%80%EF%BC%9A"><span class="toc-number">3.1.2.</span> <span class="toc-text">登录框组件布局：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%A1%86%E7%BB%84%E4%BB%B6%E9%80%BB%E8%BE%91"><span class="toc-number">3.2.</span> <span class="toc-text">登录框组件逻辑</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E5%B1%9E%E6%80%A7"><span class="toc-number">3.2.1.</span> <span class="toc-text">绑定属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C"><span class="toc-number">3.2.2.</span> <span class="toc-text">登录表单校验</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E8%AF%B7%E6%B1%82%E4%B8%8E%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C"><span class="toc-number">3.3.</span> <span class="toc-text">登录请求与表单校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%BE%E7%82%B9%E4%BB%A3%E7%A0%81%EF%BC%9A-ref"><span class="toc-number">3.3.1.</span> <span class="toc-text">难点代码： ref&lt;InstanceType&lt;typeof xxx&gt;&gt;()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C"><span class="toc-number">3.3.2.</span> <span class="toc-text">表单校验</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8Cwarning%E5%BC%B9%E7%AA%97"><span class="toc-number">3.3.2.1.</span> <span class="toc-text">表单校验warning弹窗</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E4%B8%8Etoken%E4%BF%9D%E5%AD%98"><span class="toc-number">3.4.</span> <span class="toc-text">网络请求与token保存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E6%94%BE%E4%BB%93%E5%BA%93%EF%BC%8C%E4%BF%9D%E5%AD%98%E7%99%BB%E5%BD%95%E7%8A%B6%E6%80%81%E7%9A%84"><span class="toc-number">3.4.1.</span> <span class="toc-text">网络请求放仓库，保存登录状态的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B0%B8%E4%B9%85%E4%BF%9D%E5%AD%98%E7%94%A8%E6%88%B7token"><span class="toc-number">3.4.2.</span> <span class="toc-text">永久保存用户token</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E5%96%84type%E6%96%87%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.5.</span> <span class="toc-text">完善type文件定义数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E5%96%84token%EF%BC%8C%E9%98%B2%E6%AD%A2%E6%8B%BC%E5%86%99%E9%94%99%E8%AF%AF%EF%BC%88%E5%BE%88%E5%A4%9A%E9%A1%B9%E7%9B%AE%E9%83%BD%E8%BF%99%E6%A0%B7%E5%81%9A%EF%BC%89"><span class="toc-number">3.5.1.</span> <span class="toc-text">完善token，防止拼写错误（很多项目都这样做）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E7%BC%93%E5%AD%98%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">3.6.</span> <span class="toc-text">封装缓存工具类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC"><span class="toc-number">3.7.</span> <span class="toc-text">页面跳转</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E8%88%AA%E5%AE%88%E5%8D%AB"><span class="toc-number">3.7.1.</span> <span class="toc-text">导航守卫</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%AE%B0%E4%BD%8F%E5%AF%86%E7%A0%81%E5%8A%9F%E8%83%BD"><span class="toc-number">3.8.</span> <span class="toc-text">添加记住密码功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%EF%BC%9A%E8%AE%B0%E4%BD%8F%E5%AF%86%E7%A0%81%E6%8C%89%E9%92%AE%E7%8A%B6%E6%80%81%E4%BF%9D%E6%8C%81"><span class="toc-number">3.8.0.1.</span> <span class="toc-text">进阶：记住密码按钮状态保持</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E4%B8%8E%E7%BC%93%E5%AD%98%EF%BC%88%E5%9F%BA%E4%BA%8E%E7%94%A8%E6%88%B7%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%EF%BC%89"><span class="toc-number">3.9.</span> <span class="toc-text">用户权限管理与缓存（基于用户的访问控制）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90"><span class="toc-number">3.9.1.</span> <span class="toc-text">获取用户权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%8B%A6%E6%88%AA%E5%99%A8%E7%BB%99%E6%AF%8F%E4%B8%AA%E8%AF%B7%E6%B1%82%E6%90%BA%E5%B8%A6token"><span class="toc-number">3.9.2.</span> <span class="toc-text">用拦截器给每个请求携带token</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%8C%87%E5%AE%9Astate%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.9.3.</span> <span class="toc-text">如何指定state类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E8%8F%9C%E5%8D%95%E4%BF%A1%E6%81%AF"><span class="toc-number">3.9.4.</span> <span class="toc-text">获取用户菜单信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E7%BC%93%E5%AD%98%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF%E5%92%8C%E8%8F%9C%E5%8D%95%E4%BF%A1%E6%81%AF"><span class="toc-number">3.9.5.</span> <span class="toc-text">本地缓存个人信息和菜单信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#store%E4%B8%BA%E4%BB%80%E4%B9%88%E7%9C%8B%E4%B8%8D%E8%A7%81%E5%91%A2%EF%BC%88%E7%BB%86%E8%8A%82%EF%BC%89"><span class="toc-number">3.9.6.</span> <span class="toc-text">store为什么看不见呢（细节）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5"><span class="toc-number">4.</span> <span class="toc-text">首页</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E5%B8%83%E5%B1%80"><span class="toc-number">4.1.</span> <span class="toc-text">首页布局</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E6%9E%B6%E5%AD%90"><span class="toc-number">4.1.1.</span> <span class="toc-text">搭架子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E2%80%93%E5%B7%A6%E4%BE%A7%E8%8F%9C%E5%8D%95%E6%A0%8F%E5%B8%83%E5%B1%80"><span class="toc-number">4.1.2.</span> <span class="toc-text">首页–左侧菜单栏布局</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E2%80%93%E5%A4%B4%E9%83%A8%E5%B8%83%E5%B1%80"><span class="toc-number">4.1.3.</span> <span class="toc-text">首页–头部布局</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8F%9C%E5%8D%95%E6%A0%8F%E6%8A%98%E5%8F%A0%E5%8A%9F%E8%83%BD%E6%90%AD%E5%BB%BA"><span class="toc-number">4.1.3.1.</span> <span class="toc-text">菜单栏折叠功能搭建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%98%E5%8F%A0%E8%8F%9C%E5%8D%95%E5%88%87%E6%8D%A2%EF%BC%88%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1%EF%BC%89"><span class="toc-number">4.1.3.2.</span> <span class="toc-text">折叠菜单切换（组件通信）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%B4%E9%83%A8%E5%86%85%E5%AE%B9"><span class="toc-number">4.1.3.3.</span> <span class="toc-text">头部内容</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE%EF%BC%88%E6%9C%89%E7%BC%BA%E9%99%B7%E6%96%B9%E6%B3%95%EF%BC%89"><span class="toc-number">4.2.</span> <span class="toc-text">路由配置（有缺陷方法）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%8A%E7%AB%AF"><span class="toc-number">4.2.0.1.</span> <span class="toc-text">弊端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8F%9C%E5%8D%95%E7%82%B9%E5%87%BB%E5%AE%9E%E7%8E%B0%E8%B7%AF%E7%94%B1%E8%B7%B3%E8%BD%AC%EF%BC%88%E9%87%8D%E8%A6%81%EF%BC%89"><span class="toc-number">4.2.0.2.</span> <span class="toc-text">菜单点击实现路由跳转（重要）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%EF%BC%88%E9%87%8D%E9%9A%BE%E7%82%B9%EF%BC%89"><span class="toc-number">4.3.</span> <span class="toc-text">动态路由（重难点）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%A7%92%E8%89%B2%E7%9A%84%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E7%AE%A1%E7%90%86"><span class="toc-number">4.3.1.</span> <span class="toc-text">基于角色的动态路由管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%8F%9C%E5%8D%95%E7%9A%84%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E7%AE%A1%E7%90%86%EF%BC%88%E9%87%8D%E8%A6%81%EF%BC%89"><span class="toc-number">4.3.2.</span> <span class="toc-text">基于菜单的动态路由管理（重要）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E5%88%B7%E6%96%B0%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1%E4%B8%A2%E5%A4%B1%E9%97%AE%E9%A2%98"><span class="toc-number">4.3.2.1.</span> <span class="toc-text">解决刷新页面路由丢失问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%BF%9B%E5%85%A5main%E9%A1%B5%E9%9D%A2%E8%87%AA%E5%8A%A8%E5%8C%B9%E9%85%8D%E5%AD%90%E8%B7%AF%E7%94%B1%EF%BC%88%E5%90%AC%E7%9D%80%E5%AE%B9%E6%98%93%E5%81%9A%E5%BE%88%E9%9A%BE%EF%BC%89"><span class="toc-number">4.3.2.2.</span> <span class="toc-text">动态路由第一次进入main页面自动匹配子路由（听着容易做很难）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#main%E9%A1%B5%E9%9D%A2%E5%88%B7%E6%96%B0%E2%80%93%E6%A0%B9%E6%8D%AE%E8%B7%AF%E5%BE%84%E5%8C%B9%E9%85%8Dmenu%EF%BC%88%E5%81%9C%E7%95%99%E5%9C%A8%E5%88%B7%E6%96%B0%E5%89%8D%E9%A1%B5%E9%9D%A2-%E5%AD%90%E8%8F%9C%E5%8D%95%EF%BC%89"><span class="toc-number">4.3.2.3.</span> <span class="toc-text">main页面刷新–根据路径匹配menu（停留在刷新前页面+子菜单）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E5%8C%85%E5%B1%91%E5%AE%9E%E7%8E%B0"><span class="toc-number">4.4.</span> <span class="toc-text">面包屑实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E5%8C%85%E5%B1%91%E5%AE%9E%E6%97%B6%E6%9B%B4%E6%96%B0%EF%BC%88%E7%94%A8%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7%EF%BC%89"><span class="toc-number">4.4.1.</span> <span class="toc-text">面包屑实时更新（用计算属性）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%87%BB%E7%88%B6%E8%8F%9C%E5%8D%95%E8%B7%B3%E8%BD%AC%E5%AE%8C%E5%96%84%EF%BC%88%E4%BB%94%E7%BB%86%E7%90%86%E8%A7%A3%EF%BC%89"><span class="toc-number">4.4.2.</span> <span class="toc-text">点击父菜单跳转完善（仔细理解）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2"><span class="toc-number">5.</span> <span class="toc-text">用户管理页面</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E4%BF%A1%E6%81%AF%E5%8A%9F%E8%83%BD%E9%83%A8%E5%88%86"><span class="toc-number">5.1.</span> <span class="toc-text">查询信息功能部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%B8%83%E5%B1%80%E2%80%93element%E5%B8%83%E5%B1%80"><span class="toc-number">5.1.1.</span> <span class="toc-text">查询布局–element布局</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%92%8C%E9%87%8D%E7%BD%AE%E6%8C%89%E9%92%AE%E5%B8%83%E5%B1%80"><span class="toc-number">5.1.2.</span> <span class="toc-text">查询和重置按钮布局</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E7%BD%AE%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.1.3.</span> <span class="toc-text">重置功能实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#element%E7%BB%84%E4%BB%B6%E5%86%85%E5%AE%B9%E4%B8%AD%E6%96%87%E5%8C%96"><span class="toc-number">5.1.4.</span> <span class="toc-text">element组件内容中文化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E5%8A%9F%E8%83%BD%E9%83%A8%E5%88%86"><span class="toc-number">5.2.</span> <span class="toc-text">用户信息功能部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8"><span class="toc-number">5.2.1.</span> <span class="toc-text">获取用户列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E6%A0%BC%E5%B1%95%E7%A4%BA%E6%95%B0%E6%8D%AE"><span class="toc-number">5.2.2.</span> <span class="toc-text">表格展示数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE%E2%80%93%E7%8A%B6%E6%80%81%E5%88%97"><span class="toc-number">5.2.3.</span> <span class="toc-text">处理数据–状态列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE%E2%80%93%E6%97%B6%E9%97%B4%E5%88%97"><span class="toc-number">5.2.4.</span> <span class="toc-text">处理数据–时间列</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%95%E9%83%A8%E5%88%86%E9%A1%B5%E5%99%A8%E5%8A%9F%E8%83%BD%E9%83%A8%E5%88%86%EF%BC%88%E9%87%8D%E9%9A%BE%E7%82%B9%EF%BC%89"><span class="toc-number">5.3.</span> <span class="toc-text">底部分页器功能部分（重难点）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE"><span class="toc-number">5.3.1.</span> <span class="toc-text">条件查询数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E7%BD%AE%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6"><span class="toc-number">5.3.2.</span> <span class="toc-text">重置查询条件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7%E9%83%A8%E5%88%86"><span class="toc-number">5.4.</span> <span class="toc-text">删除用户部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E6%A7%BD%E8%8E%B7%E5%8F%96ID"><span class="toc-number">5.4.1.</span> <span class="toc-text">插槽获取ID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delete%E8%AF%B7%E6%B1%82"><span class="toc-number">5.4.2.</span> <span class="toc-text">delete请求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E7%94%A8%E6%88%B7"><span class="toc-number">5.5.</span> <span class="toc-text">新建用户</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%B9%E5%87%BA%E5%BC%B9%E7%AA%97"><span class="toc-number">5.5.1.</span> <span class="toc-text">弹出弹窗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E5%96%84%E5%AF%B9%E8%AF%9D%E6%A1%86%E2%80%93%E9%80%89%E9%A1%B9%E8%AF%B7%E6%B1%82"><span class="toc-number">5.5.2.</span> <span class="toc-text">完善对话框–选项请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82"><span class="toc-number">5.5.3.</span> <span class="toc-text">发送请求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E7%94%A8%E6%88%B7"><span class="toc-number">5.6.</span> <span class="toc-text">编辑用户</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E7%94%A8%E5%8F%AF%E5%A4%8D%E7%94%A8%E7%9A%84%E7%BD%91%E8%B7%AF%E8%AF%B7%E6%B1%82"><span class="toc-number">6.</span> <span class="toc-text">封装用可复用的网路请求</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%A4%8D%E7%94%A8%E2%80%94%E9%83%A8%E9%97%A8%E7%AE%A1%E7%90%86%E6%9F%A5%E8%AF%A2%E9%83%A8%E5%88%86%E4%B8%BA%E4%BE%8B"><span class="toc-number">6.1.</span> <span class="toc-text">网络请求复用—部门管理查询部分为例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%A4%8D%E7%94%A8%E2%80%93content%E9%83%A8%E5%88%86"><span class="toc-number">6.2.</span> <span class="toc-text">网络请求复用–content部分</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%81%E8%A3%85%E5%8F%AF%E5%A4%8D%E7%94%A8%E7%9A%84%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E9%A1%B5%E9%9D%A2"><span class="toc-number">7.</span> <span class="toc-text">封装可复用的高阶组件快速搭建页面</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#search%E9%83%A8%E5%88%86%E5%A4%8D%E7%94%A8%E2%80%94%E9%83%A8%E9%97%A8%E7%AE%A1%E7%90%86%E4%B8%BA%E4%BE%8B"><span class="toc-number">7.1.</span> <span class="toc-text">search部分复用—部门管理为例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#search%E9%83%A8%E5%88%86%E5%A4%8D%E7%94%A8%E2%80%94%E8%A7%92%E8%89%B2%E7%AE%A1%E7%90%86%E4%BD%BF%E7%94%A8%E5%A4%8D%E7%94%A8%E5%86%85%E5%AE%B9"><span class="toc-number">7.2.</span> <span class="toc-text">search部分复用—角色管理使用复用内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#content%E8%A1%A8%E5%8D%95%E5%A4%8D%E7%94%A8%E2%80%94%E9%83%A8%E9%97%A8%E7%AE%A1%E7%90%86"><span class="toc-number">7.3.</span> <span class="toc-text">content表单复用—部门管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#modal%E5%AF%B9%E8%AF%9D%E6%A1%86%E5%A4%8D%E7%94%A8"><span class="toc-number">7.4.</span> <span class="toc-text">modal对话框复用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%8E%B7%E5%8F%96%E9%80%89%E9%A1%B9%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">7.4.1.</span> <span class="toc-text">动态获取选项中的数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#setup%E4%B8%AD%E7%9B%B8%E5%90%8C%E9%80%BB%E8%BE%91%E7%9A%84%E6%8A%BD%E5%8F%96"><span class="toc-number">7.5.</span> <span class="toc-text">setup中相同逻辑的抽取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E7%94%A8%E5%A4%8D%E7%94%A8%E7%BB%84%E4%BB%B6%E6%90%AD%E5%BB%BA%E8%A7%92%E8%89%B2%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2"><span class="toc-number">7.6.</span> <span class="toc-text">全用复用组件搭建角色管理页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E7%94%A8%E5%A4%8D%E7%94%A8%E7%BB%84%E4%BB%B6%E6%90%AD%E5%BB%BA%E8%8F%9C%E5%8D%95%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2%EF%BC%88%E5%AE%8C%E5%96%84content%E7%BB%84%E4%BB%B6%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BA%A7%E8%8F%9C%E5%8D%95%E5%B1%95%E7%A4%BA%E6%95%88%E6%9E%9C%EF%BC%89"><span class="toc-number">7.7.</span> <span class="toc-text">全用复用组件搭建菜单管理页面（完善content组件实现多级菜单展示效果）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%95%E7%A4%BA%E4%B8%80%E7%BA%A7%E8%8F%9C%E5%8D%95%E4%BA%8C%E7%BA%A7%E8%8F%9C%E5%8D%95"><span class="toc-number">7.7.1.</span> <span class="toc-text">展示一级菜单二级菜单</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E5%96%84%E5%A4%8D%E7%94%A8%E7%BB%84%E4%BB%B6%E2%80%93%E6%8F%92%E6%A7%BD%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%87%E7%AD%BE-%E5%B1%95%E7%A4%BA%E6%A0%91%E5%BD%A2%E8%8F%9C%E5%8D%95"><span class="toc-number">7.8.</span> <span class="toc-text">完善复用组件–插槽实现自定义标签(展示树形菜单)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E5%96%84%EF%BC%9Aaction%E8%A7%A6%E5%8F%91%E5%90%8E%E5%88%86%E9%A1%B5%E5%9B%9E%E5%88%B0%E7%AC%AC%E4%B8%80%E9%A1%B5"><span class="toc-number">7.9.</span> <span class="toc-text">完善：action触发后分页回到第一页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E5%96%84%EF%BC%9A%E6%96%B0%E5%BB%BA%E5%92%8C%E7%BC%96%E8%BE%91%E8%A7%92%E8%89%B2%E5%8A%9F%E8%83%BD"><span class="toc-number">7.10.</span> <span class="toc-text">完善：新建和编辑角色功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%92%E8%89%B2%EF%BC%88%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84%E7%BB%84%E4%BB%B6%EF%BC%89"><span class="toc-number">7.10.1.</span> <span class="toc-text">创建角色（树形结构组件）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E8%A7%92%E8%89%B2%EF%BC%88%E9%80%92%E5%BD%92%E8%8E%B7%E5%8F%96%E6%9C%80%E5%BA%95%E5%B1%82id%EF%BC%8C%E8%8F%9C%E5%8D%95%E5%9B%9E%E6%98%BE%EF%BC%89"><span class="toc-number">7.10.2.</span> <span class="toc-text">编辑角色（递归获取最底层id，菜单回显）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8C%89%E9%92%AE%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">8.</span> <span class="toc-text">按钮权限管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E9%92%AE%E6%9D%83%E9%99%90%E5%9C%A8%E5%93%AA%E9%87%8C"><span class="toc-number">8.1.</span> <span class="toc-text">按钮权限在哪里</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E6%8C%89%E9%92%AE%E6%9D%83%E9%99%90%E6%95%B0%E6%8D%AE%E4%BF%9D%E5%AD%98%E5%88%B0store%E4%B8%AD"><span class="toc-number">8.2.</span> <span class="toc-text">获取用户按钮权限数据保存到store中</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C"><span class="toc-number">8.3.</span> <span class="toc-text">页面权限校验</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E9%A1%B5%E9%9D%A2"><span class="toc-number">9.</span> <span class="toc-text">数据可视化页面</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A2%9E%E9%95%BF%E5%8A%A8%E7%94%BB"><span class="toc-number">9.1.</span> <span class="toc-text">数据增长动画</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EChart%E5%9B%BE%E8%A1%A8%E5%B1%95%E7%A4%BA"><span class="toc-number">9.2.</span> <span class="toc-text">EChart图表展示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E5%B1%82%E5%B0%81%E8%A3%85"><span class="toc-number">9.2.1.</span> <span class="toc-text">三层封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA"><span class="toc-number">9.2.2.</span> <span class="toc-text">效果展示</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/07/06/37-npm%E5%92%8C%E5%BA%93%E9%9D%A2%E8%AF%95%E9%A2%98/" title="npm和库"><img src="/./myimg/lolcute4.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="npm和库"/></a><div class="content"><a class="title" href="/2025/07/06/37-npm%E5%92%8C%E5%BA%93%E9%9D%A2%E8%AF%95%E9%A2%98/" title="npm和库">npm和库</a><time datetime="2025-07-06T15:09:52.000Z" title="发表于 2025-07-06 23:09:52">2025-07-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/02/45-antDesign/" title="实习小记"><img src="/./myimg/lolcute11.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="实习小记"/></a><div class="content"><a class="title" href="/2025/07/02/45-antDesign/" title="实习小记">实习小记</a><time datetime="2025-07-02T13:39:52.000Z" title="发表于 2025-07-02 21:39:52">2025-07-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/28/40-react/" title="react--学习笔记"><img src="/./myimg/lolcute1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="react--学习笔记"/></a><div class="content"><a class="title" href="/2025/06/28/40-react/" title="react--学习笔记">react--学习笔记</a><time datetime="2025-06-28T05:09:52.000Z" title="发表于 2025-06-28 13:09:52">2025-06-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/22/43-machine/" title="机器学习笔记"><img src="/./myimg/girl4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="机器学习笔记"/></a><div class="content"><a class="title" href="/2025/06/22/43-machine/" title="机器学习笔记">机器学习笔记</a><time datetime="2025-06-22T06:09:52.000Z" title="发表于 2025-06-22 14:09:52">2025-06-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/18/42-font-back/" title="前后端交互"><img src="/./myimg/lolcute1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="前后端交互"/></a><div class="content"><a class="title" href="/2025/06/18/42-font-back/" title="前后端交互">前后端交互</a><time datetime="2025-06-18T15:09:52.000Z" title="发表于 2025-06-18 23:09:52">2025-06-18</time></div></div></div></div></div></div></main><footer id="footer" style="background: linear-gradient(135deg,#FFE985 10%,#FA742B 100%);"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By Melon_Nie</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-vercel-nine-ashen.vercel.app',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoo-vercel-nine-ashen.vercel.app',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>